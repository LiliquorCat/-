<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GKVP3QRX9Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GKVP3QRX9Y');
    </script>

    <!-- 禁止移动端双指放大 -->
    <script>
    // 禁止移动端双指缩放
    document.addEventListener('touchstart', function(event) {
        if (event.touches.length > 1) {
            event.preventDefault();
        }
    }, { passive: false });

    // 禁止双指缩放
    document.addEventListener('gesturestart', function(event) {
        event.preventDefault();
    });

    document.addEventListener('gesturechange', function(event) {
        event.preventDefault();
    });

    document.addEventListener('gestureend', function(event) {
        event.preventDefault();
    });

    // 禁止双击缩放
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
    </script>

    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimum-scale=1.0, viewport-fit=cover">
    <title>海拉的钱包</title>
    <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.js"></script>
    <style>
        /* 设置整个网页背景 */
        body {
            background: #1a1a1a;
            margin: 0;
            padding: 0;
        }

        /* 禁止文本选择和缩放 */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* 允许输入框文本选择 */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* 顶部菜单栏样式 */
        .top-menu-bar {
        background: #2a2a2a;
        border-bottom: 2px solid #8B0000;
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 10000;
        }

        /* 弹窗模态框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #2a2a2a;
            border: 2px solid #333333;
            border-radius: 8px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), 
                        inset 0 0 0 1px rgba(255, 107, 107, 0.2);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: #333333;
            padding: 20px;
            border-bottom: 1px solid #444444;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .modal-body {
            padding: 25px;
            color: #CCCCCC;
            line-height: 1.6;
            overflow-y: auto;
            flex: 1;
            scrollbar-width: thin;
            scrollbar-color: #8B0000 #333333;
        }

        .modal-footer {
            padding: 15px 25px;
            background: #333333;
            border-top: 1px solid #444444;
            border-radius: 0 0 8px 8px;
            text-align: center;
            flex-shrink: 0;
        }

        /* 白天模式下的弹窗样式 */
        .light-mode .modal-overlay {
            background: rgba(0, 0, 0, 0.5) !important;
        }

        .light-mode .modal-content {
            background: #ffffff !important;
            border: 2px solid #d5dbdb !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15) !important;
        }

        /* 新增：修复白天模式下弹窗列表文字颜色 */
        .light-mode .modal-list li {
            color: #2c3e50 !important;
        }

        .light-mode .modal-section-title {
            color: #2c3e50 !important;
        }

        .light-mode .modal-highlight {
            color: #2980b9 !important;
        }

        .light-mode .modal-body p {
            color: #566573 !important;
        }

        .light-mode .modal-header {
            background: #2c3e50 !important;
            border-bottom: 1px solid #bdc3c7 !important;
        }

        .light-mode .modal-body {
            background: #ffffff !important;
            color: #566573 !important;
            scrollbar-color: #2980b9 #ecf0f1 !important;
        }

        .light-mode .modal-footer {
            background: #2c3e50 !important;
            border-top: 1px solid #bdc3c7 !important;
        }

        .light-mode .modal-title {
            color: #ecf0f1 !important;
        }

        .light-mode .modal-contact {
            color: #ecf0f1 !important;
        }

        /* Webkit浏览器自定义滚动条 (Chrome, Safari, Edge) - 应用到内容区域 */
        .modal-body::-webkit-scrollbar {
            width: 12px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 6px;
            margin: 5px 0;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8B0000, #FF4500);
            border-radius: 6px;
            border: 2px solid #2a2a2a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #FF4500, #FF6B6B);
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.5);
        }

        .modal-body::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #FF6B6B, #FF8C00);
        }

        .modal-body::-webkit-scrollbar-corner {
            background: #2a2a2a;
        }

        /* 白天模式下的滚动条样式 */
        .light-mode .modal-body::-webkit-scrollbar-track {
            background: #ecf0f1 !important;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #2980b9, #3498db) !important;
            border: 2px solid #ecf0f1 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
        }

        .light-mode .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #3498db, #5dade2) !important;
            box-shadow: 0 0 8px rgba(41, 128, 185, 0.5) !important;
        }

        .light-mode .modal-body::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #5dade2, #85c1e9) !important;
        }

        .light-mode .modal-body::-webkit-scrollbar-corner {
            background: #ecf0f1 !important;
        }

        /* 移除modal-content的滚动条样式，因为现在内容区域单独滚动 */
        .modal-content::-webkit-scrollbar {
            display: none; /* 隐藏外层滚动条 */
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #FF4500, #FF6B6B); /* 悬停时更亮 */
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.5);
        }

        .modal-content::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #FF6B6B, #FF8C00); /* 点击时最亮 */
        }

        .modal-content::-webkit-scrollbar-corner {
            background: #2a2a2a; /* 滚动条角落背景 */
        }

        /* 为弹窗内容区域也添加滚动条样式 */
        .modal-body {
            padding: 25px;
            color: #CCCCCC;
            line-height: 1.6;
            overflow-y: auto; /* 内容区域单独滚动 */
            flex: 1; /* 占据剩余空间 */
            
            /* 自定义滚动条 */
            scrollbar-width: thin;
            scrollbar-color: #8B0000 #333333;
        }

        .modal-body::-webkit-scrollbar {
            width: 10px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 5px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8B0000, #FF4500);
            border-radius: 5px;
            border: 2px solid #2a2a2a;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #FF4500, #FF6B6B);
        }

        /* 添加锁链装饰元素 */
        .modal-content::after {
            content: "⛓️";
            position: absolute;
            top: -10px;
            right: 10px;
            font-size: 16px;
            color: #8B0000; /* 深红色 */
            opacity: 0.7;
        }

        .modal-header {
            background: #333333; /* 深灰色背景 */
            padding: 20px;
            border-bottom: 1px solid #444444;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; /* 改为sticky定位 */
            top: 0;
            z-index: 10;
            flex-shrink: 0; /* 防止标题栏被压缩 */
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); /* 添加阴影增强层次感 */
        }
        .modal-title {
            color: #FF6B6B; /* 亮红色 */
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #FF6B6B;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #3a3a3a;
            color: #FF4500;
        }

        .modal-body {
            padding: 25px;
            color: #CCCCCC;
            line-height: 1.6;
        }

        .modal-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #333333; /* 深灰色背景 */
            border-radius: 6px;
            border-left: 4px solid #FF4500; /* 橙红色边框 */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }

        .modal-section-title {
            color: #FF6B6B; /* 亮红色 */
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .modal-list {
            margin: 10px 0;
            padding-left: 20px;
        }

        .modal-list li {
            margin-bottom: 8px;
            color: #CCCCCC;
        }

        .modal-highlight {
            color: #FF4500; /* 橙红色 */
            font-weight: bold;
        }

        .modal-footer {
            padding: 15px 25px;
            background: #333333; /* 深灰色背景 */
            border-top: 1px solid #444444;
            border-radius: 0 0 8px 8px;
            text-align: center;
            flex-shrink: 0; /* 防止底部被压缩 */
        }

        .modal-contact {
            color: #FF6B6B;
            font-weight: bold;
            margin-top: 10px;
        }

        /* 移动端弹窗适配 */
        @media (max-width: 768px) {
            /* 防止移动端布局溢出 */            
            .potential-section.card {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
            }
            
            .section-content {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }
            
            /* 确保所有子元素不超出容器 */
            .section-content > * {
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            .modal-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-title {
                font-size: 18px;
            }
        }

        .menu-title {
            color: #FF6B6B; /* 亮红色 */
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .menu-right {
            display: flex;
            gap: 15px;
            margin-left: auto;
        }

        .menu-btn {
            background: #333333; /* 深灰色背景 */
            color: #FF6B6B; /* 亮红色 */
            border: 1px solid #555555;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .menu-btn:hover {
            background: #3a3a3a;
            border-color: #FF4500;
            color: #FF4500; /* 橙红色悬停 */
        }

        /* 基础样式 - 修改颜色方案 */
        .gacha-calculator {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: transparent;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
            margin-top: 70px;
        }

        .pie-canvas {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: -o-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            -ms-interpolation-mode: nearest-neighbor;
        }

        /* 添加栅栏效果背景 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(90deg, rgba(139, 0, 0, 0.1) 1px, transparent 1px),
                linear-gradient(0deg, rgba(139, 0, 0, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            z-index: -1;
        }

        .calculator-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
            position: relative;
            z-index: 1;
        }

        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 0px; /* 所有模块的上下间距 */
        }

        .card {
            background: #2a2a2a; /* 深灰色背景 */
            padding: 20px;
            border-radius: 8px; /* 减少圆角，更硬朗 */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), 
                        inset 0 0 0 1px rgba(255, 107, 107, 0.2); /* 厚重阴影和红色内边框 */
            border: 2px solid #333333; /* 厚重边框 */
            position: relative;
        }

        /* 添加锁链装饰元素 */
        .card::after {
            content: "⛓️";
            position: absolute;
            top: -10px;
            right: 10px;
            font-size: 16px;
            color: #8B0000; /* 深红色 */
            opacity: 0.7;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #FF6B6B; /* 亮红色文字 */
            margin-bottom: 15px;
            font-size: 18px;
            user-select: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .section-header:hover {
            color: #FF4500; /* 橙红色悬停 */
        }

        .collapse-icon {
            font-weight: bold;
            font-size: 16px;
            color: #FF6B6B; /* 亮红色 */
        }

        .section-content {
            margin-top: 10px;
        }

        h1 {
            text-align: center;
            color: #FF6B6B; /* 亮红色 */
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border-bottom: 2px solid #8B0000; /* 深红色下划线 */
            padding-bottom: 10px;
        }

        h2 {
            color: #FF6B6B; /* 亮红色 */
            margin-bottom: 15px;
            font-size: 18px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .sub-section {
            margin: 20px 0;
            padding: 15px;
            background: #333333; /* 深灰色背景 */
            border-radius: 6px;
            border-left: 4px solid #FF4500; /* 橙红色边框 */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }

        .sub-title {
            color: #FF6B6B; /* 亮红色 */
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* 更强大的固定定位方案 */
        .sticky-panel {
            position: sticky;
            top: 90px; /* 增加顶部距离，避免被菜单栏遮挡 */
            align-self: flex-start;
            z-index: 1000;
            background: #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }

        /* 防止父元素overflow隐藏 */
        .calculator-layout {
            overflow: visible !important;
        }

        .gacha-calculator {
            overflow: visible !important;
        }

        /* 当前库存垂直布局 */
        .resource-vertical {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .resource-input-vertical {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #333333; /* 深灰色背景 */
            border-radius: 6px;
            border: 1px solid #444444; /* 深色边框 */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .resource-input-vertical label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            min-width: 120px;
            margin-bottom: 0;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .resource-input-vertical input {
            padding: 8px;
            border: 1px solid #555555;
            border-radius: 5px;
            width: 100px;
            text-align: center;
            background: #2a2a2a;
            color: #FFFFFF;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        /* 皮肤预留一行显示 - 修改按键布局 */
        .skin-reserve-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .skin-item.compact {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 12px;
            background: #333333; /* 深灰色背景 */
            border-radius: 6px;
            border: 1px solid #444444;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .skin-item.compact .skin-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .skin-item.compact .skin-price {
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .skin-item.compact .skin-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .skin-item.compact .skin-count {
            color: #FF4500; /* 橙红色 */
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .skin-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #555555;
            background: #2a2a2a;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF6B6B;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .skin-btn:hover {
            background: #3a3a3a;
            border-color: #FF4500;
        }

        .skin-btn:active {
            background: #1a1a1a;
            transform: translateY(1px);
        }

        /* 角色养成按钮样式 */
        .character-development-controls input {
            padding: 8px;
            border: 1px solid #555555;
            border-radius: 5px;
            width: 70px;
            text-align: center;
            font-size: 14px;
            min-width: 0;
            background: #2a2a2a;
            color: #FFFFFF;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .character-dev-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #555555;
            background: #2a2a2a;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF6B6B;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .character-dev-btn:hover {
            background: #3a3a3a;
            border-color: #FF4500;
        }

        .character-dev-btn:active {
            background: #1a1a1a;
            transform: translateY(1px);
        }

        .character-dev-count {
            color: #FF4500; /* 橙红色 */
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* 派遣声望按钮样式 */
        .dispatch-buttons {
            margin-top: 10px;
        }

        .dispatch-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .dispatch-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dispatch-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .dispatch-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .dispatch-btn.active {
            border-color: #FF4500;
            background: #8B0000;
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        /* 暗域开关组样式 */
        .dark-zone-switches {
            display: flex;
            gap: 15px;
        }

        /* 新增模块按钮样式 */
        .main-story-buttons {
            margin-top: 10px;
        }

        .main-story-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .main-story-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .main-story-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .main-story-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .main-story-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        /* 狄斯暗影（EX）按钮样式 */
        .ex-buttons {
            margin-top: 10px;
        }

        .ex-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .ex-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ex-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .ex-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .ex-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        .memory-storm-buttons,
        .pollution-nest-buttons,
        .cleanup-operation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .memory-storm-btn,
        .pollution-nest-btn,
        .cleanup-operation-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .memory-storm-btn:hover,
        .pollution-nest-btn:hover,
        .cleanup-operation-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .memory-storm-btn.active,
        .pollution-nest-btn.active,
        .cleanup-operation-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        .palma-ruins-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .palma-ruins-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .palma-ruins-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .palma-ruins-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .palma-ruins-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        /* 资源图标样式 */
        .resource-icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin: 0 2px;
        }

        .resource-icon.small {
            width: 16px;
            height: 16px;
        }

        /* 其他原有样式 */
        .resource-input {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        .resource-input label {
            width: 120px;
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .resource-input input {
            padding: 8px;
            border: 1px solid #555555;
            border-radius: 5px;
            width: 120px;
            background: #2a2a2a;
            color: #FFFFFF;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .custom-adjust {
            margin-top: 10px;
        }

        .custom-tip {
            font-size: 12px;
            color: #FF4500; /* 橙红色 */
            margin-top: 5px;
            font-style: italic;
        }

        .accumulation-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: #333333; /* 深灰色背景 */
            border-radius: 5px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .item-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .item-title {
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            min-width: 120px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .item-subtitle {
            color: #CCCCCC;
            min-width: 80px;
            font-size: 14px;
        }

        .item-value {
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 2px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .switch-group {
            display: flex;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        .switch-group.small {
            margin: 0 0 0 10px;
        }

        .switch {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555555;
            transition: .4s;
            border-radius: 20px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #8B0000; /* 深红色 */
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .switch-label {
            font-size: 12px;
            margin-left: 5px;
            color: #CCCCCC;
        }

        /* 在这里添加开关标签高亮样式 */
        .switch-label.active {
            color: #FF4500; /* 橙红色 */
            font-weight: bold;
        }

        .switch-label.inactive {
            color: #666666;
        }

        .time-options {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        .time-option {
            flex: 1;
            padding: 12px;
            min-width: 0;
            background: #333333; /* 深灰色背景 */
            border: 2px solid #444444;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .time-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
            gap: 5px;
        }

        .time-title {
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
            color: #FF6B6B; /* 亮红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .time-days {
            font-size: 14px;
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            flex-shrink: 0;
            white-space: nowrap;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .time-date {
            font-size: 12px;
            color: #CCCCCC;
            text-align: center;
        }

        .time-option.active {
            border-color: #FF4500;
            background: #3a3a3a;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.3);
        }

        .result {
            background: #333333; /* 深灰色背景 */
            padding: 20px;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 16px;
            color: #CCCCCC;
        }

        .result-item.simple {
            font-size: 18px;
        }

        .result-item.highlight {
            font-weight: bold;
            font-size: 20px;
            border-top: 1px solid #444444;
            padding-top: 10px;
            margin-top: 15px;
            color: #FF4500; /* 橙红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .summary-section {
            margin: 15px 0;
            padding: 15px;
            background: #333333; /* 深灰色背景 */
            border-radius: 8px;
            border-left: 4px solid #FF4500; /* 橙红色边框 */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 16px;
            color: #CCCCCC;
        }

        .summary-label {
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .summary-value {
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .shop-section {
            margin-top: 15px;
            padding: 15px;
            background: #2a2a2a; /* 深灰色背景 */
            border-radius: 8px;
            border: 1px solid #444444;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .shop-title {
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            margin-bottom: 10px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .certification-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .certification-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #555555;
            background: #333333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF6B6B;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .certification-btn:hover {
            background: #3a3a3a;
            border-color: #FF4500;
        }

        .certification-count {
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            min-width: 80px;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
            background: #333333;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #555555;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .training-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .training-btn {
            padding: 12px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .training-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .training-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        .nightmare-score {
            margin-bottom: 20px;
            padding: 15px;
            background: #333333; /* 深灰色背景 */
            border-radius: 8px;
            border: 1px solid #444444;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .score-title {
            font-size: 14px;
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            margin-bottom: 10px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            color: #CCCCCC;
        }

        /* 无尽梦魇滑块样式（大范围） */
        .score-slider {
            width: 100%;
            height: 20px;
            border-radius: 3px;
            background: #2a2a2a; /* 深灰色背景 */
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8B0000; /* 深红色 */
            cursor: pointer;
            border: 2px solid #FF4500; /* 橙红色边框 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .score-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8B0000; /* 深红色 */
            cursor: pointer;
            border: 2px solid #FF4500; /* 橙红色边框 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .score-slider::-webkit-slider-track {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555555;
            margin: 7px 0;
        }

        .score-slider::-moz-range-track {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555555;
            border: none;
        }

        /* 监察密令滑块样式（小范围） */
        .inspection-slider {
            width: 100%;
            height: 20px;
            border-radius: 3px;
            background: #2a2a2a; /* 深灰色背景 */
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        .inspection-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8B0000; /* 深红色 */
            cursor: pointer;
            border: 2px solid #FF4500; /* 橙红色边框 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .inspection-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8B0000; /* 深红色 */
            cursor: pointer;
            border: 2px solid #FF4500; /* 橙红色边框 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .inspection-slider::-webkit-slider-track {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555555;
            margin: 7px 0;
        }

        .inspection-slider::-moz-range-track {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555555;
            border: none;
        }

        /* 滑块禁用状态样式 */
        .inspection-slider:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .inspection-slider:disabled::-webkit-slider-thumb {
            background: #444444;
            cursor: not-allowed;
        }
        
        .inspection-slider:disabled::-moz-range-thumb {
            background: #444444;
            cursor: not-allowed;
        }

        .slider-value {
            text-align: center;
            font-size: 12px;
            color: #FF4500; /* 橙红色 */
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .score-rewards {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reward-label {
            font-size: 13px;
            color: #CCCCCC;
        }

        .reward-value {
            font-size: 13px;
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* 禁用状态样式 */
        .disabled-section {
            opacity: 0.6;
            pointer-events: none;
        }

        .disabled-section .skin-btn {
            background: #333333;
            color: #666666;
            cursor: not-allowed;
        }

        .disabled-section .skin-btn:hover {
            background: #333333;
        }

        .disabled-section .skin-btn:active {
            background: #333333;
        }

        /* 零镜系统按钮样式 */
        .zero-mirror-buttons {
            margin-top: 10px;
        }

        .zero-mirror-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .zero-mirror-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .zero-mirror-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .zero-mirror-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .zero-mirror-btn.active {
            border-color: #FF4500;
            background: #8B0000;
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        /* 晶源特供（非首充）响应式布局 */
        .crystal-supply-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .price-tag {
            white-space: normal !important;
            min-width: 30px !important;
            display: inline-block !important;
            text-align: center !important;
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .card {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .section-content {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
            }
            
            /* 防止flex布局导致溢出 */
            .calculator-layout {
                min-width: 0 !important;
                max-width: 100% !important;
            }
            
            .right-panel {
                min-width: 0 !important;
                max-width: 100% !important;
            }

            .zero-mirror-columns {
                grid-template-columns: 1fr;
            }

            .zero-mirror-btn {
                font-size: 11px;
                padding: 8px 6px;
            }

            .crystal-supply-buttons {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .crystal-supply-btn-wrapper {
                max-width: 100% !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .training-btn.crystal-supply-btn {
                min-width: 0 !important;
                flex: 1 !important;
                max-width: calc(100% - 70px) !important; /* 为输入框留出空间 */
            }
            
            /* 晶源特供按钮移动端适配 */
            .crystal-supply-left,
            .crystal-supply-right {
                min-width: 0 !important;
                flex-shrink: 1 !important;
            }
            
            .crystal-supply-left .price-tag,
            .crystal-supply-right span {
                font-size: 11px !important;
                white-space: nowrap !important;
            }
            
            /* 只调整价格字体大小，保持原有布局 */
            .crystal-supply-btn-wrapper > div > div:last-child > div:last-child {
                font-size: 11px !important;
                margin-top: 4px !important;
                line-height: 1.2 !important;
            }
            
            /* 修复氪金资源模块在移动端变宽的问题 */
            .crystal-supply-btn-wrapper > div {
                max-width: 100% !important;
                width: 100% !important;
                box-sizing: border-box !important;
                display: flex !important;
                align-items: stretch !important;
                flex-wrap: nowrap !important;
            }
            
            /* 确保输入框容器固定宽度 */
            .crystal-supply-btn-wrapper > div > div:last-child {
                min-width: 60px !important;
                max-width: 60px !important;
                flex-shrink: 0 !important;
            }
            
            /* 新增：防止flex子元素溢出 */
            .crystal-supply-btn-wrapper > div > * {
                flex-shrink: 1 !important;
                min-width: 0 !important;
            }

        }

        @media (max-width: 480px) {
            .zero-mirror-btn {
                font-size: 10px;
                padding: 6px 4px;
            }

            .crystal-supply-buttons {
                gap: 6px !important;
            }
            
            .crystal-supply-btn-wrapper > div {
                gap: 6px !important;
            }
            
            .training-btn.crystal-supply-btn {
                padding: 10px 6px !important;
            }
            
            .crystal-supply-left .price-tag,
            .crystal-supply-right span {
                font-size: 10px !important;
            }
            
            /* 输入框在小屏幕上稍微调小 */
            .crystal-supply-btn-wrapper input[type="number"] {
                width: 45px !important;
                padding: 6px 4px !important; /* 保持原有padding */
                font-size: 13px !important;
            }
            
            .crystal-supply-btn-wrapper > div > div:last-child {
                min-width: 55px !important;
            }
            
            /* 小屏幕价格字体稍微缩小 */
            .crystal-supply-btn-wrapper > div > div:last-child > div:last-child {
                font-size: 10px !important;
            }      

            /* 修复小屏幕上氪金资源模块的布局 */
            .crystal-supply-btn-wrapper > div {
                flex-wrap: nowrap !important;
                justify-content: space-between !important;
                gap: 6px !important;
            }
            
            .training-btn.crystal-supply-btn {
                min-width: 0 !important;
                flex: 1 !important;
                max-width: calc(100% - 66px) !important;
                padding: 10px 6px !important;
            }
            
            .crystal-supply-btn-wrapper > div > div:last-child {
                min-width: 60px !important;
                max-width: 60px !important;
                flex-shrink: 0 !important;
            }
            
            /* 新增：强制限制文本不换行 */
            .crystal-supply-left .price-tag,
            .crystal-supply-right span {
                font-size: 10px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* 新增：确保按钮内容不溢出 */
            .training-btn.crystal-supply-btn {
                white-space: nowrap !important;
                overflow: hidden !important;
            }

        }

        /* 新增角色养成模块样式 */
        .character-development-input {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 6px 0;
            padding: 8px 12px;
            background: #333333; /* 深灰色背景 */
            border-radius: 6px;
            border: 1px solid #444444;
            gap: 15px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .character-development-label {
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            flex-wrap: nowrap;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .character-development-value {
            font-weight: bold;
            color: #FF4500; /* 橙红色 */
            display: flex;
            align-items: center;
            gap: 2px;
            margin-left: 8px;
            white-space: nowrap;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .character-development-controls input {
            padding: 8px;
            border: 1px solid #555555;
            border-radius: 5px;
            width: 70px;
            text-align: center;
            font-size: 14px;
            min-width: 0;
            flex-shrink: 0;
            background: #2a2a2a;
            color: #FFFFFF;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .character-development-btn {
            width: 100%;
            padding: 10px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            margin-top: 10px;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .character-development-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .character-development-btn.active {
            border-color: #FF4500;
            background: #8B0000; /* 深红色 */
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        /* 饼状图样式 */
        .pie-chart-section {
            background: #2a2a2a; /* 深灰色背景 */
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #333333;
            margin-bottom: 20px;
            position: relative;
            min-height: 320px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), 
                        inset 0 0 0 1px rgba(255, 107, 107, 0.2);
        }

        /* 饼状图容器布局 */
        .pie-chart-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* 饼状图画布包装器 */
        .pie-canvas-wrapper {
            position: relative;
            width: 60%;
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 饼状图画布 */
        .pie-canvas {
            cursor: pointer;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.2s ease;
        }

        .pie-canvas:hover {
            transform: scale(1.02);
        }

        /* 饼状图提示框 */
        .pie-tooltip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            pointer-events: none;
            text-align: center;
            min-width: 120px;
            border: 1px solid #FF4500;
        }

        .tooltip-details {
            font-size: 11px;
            margin-top: 4px;
            color: #FF6B6B;
        }

        /* 饼状图图例 */
        .pie-legend {
            flex: 1;
            padding: 12px;
            background: #333333; /* 深灰色背景 */
            border-radius: 8px;
            border: 1px solid #444444;
            max-height: 250px;
            overflow-y: auto;
            box-sizing: border-box;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            transform: translateX(5px);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .legend-text {
            font-size: 12px;
            color: #CCCCCC;
        }

        .legend-total {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444444;
            font-size: 13px;
            font-weight: bold;
            color: #FF6B6B; /* 亮红色 */
            text-align: left;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            /* 顶部菜单栏移动端适配 */
            .top-menu-bar {
                padding: 10px 15px;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 10000;
            }
            
            .gacha-calculator {
                margin-top: 60px;
                padding: 10px;
                background: transparent;
            }
            
            .menu-title {
                font-size: 20px;
                position: static;
                transform: none;
                text-align: center;
                flex: 1;
            }
            
            .menu-right {
                gap: 10px;
            }
            
            .menu-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* 弹窗移动端适配 */
            .modal-content {
                width: 95%;
                max-height: 85vh;
                margin: 10px;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .modal-title {
                font-size: 18px;
            }
            
            .modal-section {
                padding: 12px;
                margin-bottom: 15px;
            }
            /* 新增：异方晶修正输入框移动端适配 */
            .resource-input {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 8px !important;
            }
            
            .resource-input label {
                min-width: auto !important;
                margin-bottom: 5px !important;
            }
            
            .resource-input input {
                width: 100% !important;
                max-width: 120px !important;
            }
            
            /* 专门针对异方晶修正输入框的样式 */
            .custom-adjust .resource-input input {
                max-width: 120px !important;
            }

            .gacha-calculator {
                padding: 10px;
            }
            
            .calculator-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .sticky-panel {
                position: sticky;
                top: 70px; /* 移动端也增加顶部距离 */
                z-index: 100;
                background: #2a2a2a;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                margin-bottom: 15px;
            }

            /* 其他移动端样式保持不变，只调整颜色 */
            .time-options {
                flex-direction: row;
                gap: 8px;
            }

            .time-option {
                padding: 10px;
            }

            .time-title {
                font-size: 13px;
            }

            .time-date {
                font-size: 11px;
            }

            .time-days {
                font-size: 13px;
            }

            .time-weeks {
                font-size: 11px;
            }
            
            .card {
                padding: 15px;
            }
            
            .resource-vertical {
                gap: 10px;
            }
            
            .resource-input-vertical {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .resource-input-vertical label {
                min-width: auto;
            }
            
            .resource-input-vertical input {
                width: 100%;
                max-width: 120px;
            }
            
            .skin-reserve-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .dark-zone-switches {
                flex-direction: column;
                gap: 8px;
                width: 100%;
                margin-top: 8px;
            }
            
            .target-buttons {
                grid-template-columns: 1fr;
            }
            
            .rating-buttons {
                grid-template-columns: 1fr;
            }
            
            .target-btn, .rating-btn {
                font-size: 12px;
                padding: 8px 6px;
            }

            /* 新增模块移动端适配 */
            .main-story-columns {
                grid-template-columns: 1fr;
            }

            .main-story-btn {
                font-size: 11px;
                padding: 8px 6px;
            }

            /* 狄斯暗影（EX）移动端适配 */
            .ex-columns {
                grid-template-columns: 1fr;
            }

            .ex-btn {
                font-size: 11px;
                padding: 8px 6px;
            }

            .memory-storm-buttons,
            .pollution-nest-buttons,
            .cleanup-operation-buttons {
                grid-template-columns: 1fr;
            }

            .memory-storm-btn,
            .pollution-nest-btn,
            .cleanup-operation-btn {
                font-size: 12px;
                padding: 8px 6px;
            }

            .palma-ruins-row {
                grid-template-columns: 1fr;
            }

            .palma-ruins-btn {
                font-size: 12px;
                padding: 8px 6px;
            }
            
            .resource-input {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .resource-input label {
                width: auto;
                margin-bottom: 5px;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .accumulation-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .switch-group.small {
                margin: 5px 0 0 0;
            }
            
            .item-info {
                width: 100%;
                margin-bottom: 8px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            .certification-controls {
                margin-top: 8px;
                width: 100%;
                justify-content: center;
            }
                    
            .training-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            /* 专门针对活动模块中的复刻按钮调整 */
            .accumulation-item .training-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-top: 10px;
            }
            
            .accumulation-item .training-btn {
                font-size: 12px;
                padding: 10px 6px;
                min-height: auto;
                white-space: normal;
                line-height: 1.3;
            }
            
            .summary-section {
                padding: 10px;
            }
            
            .summary-item {
                font-size: 14px;
            }
            
            .resource-icon {
                width: 22px;
                height: 22px;
            }
            
            .resource-icon.small {
                width: 18px;
                height: 18px;
            }

            /* 移动端适配 */
            @media (max-width: 768px) {
                .dispatch-columns {
                    grid-template-columns: 1fr;
                }

                .dispatch-btn {
                    font-size: 11px;
                    padding: 8px 6px;
                }
            }

            @media (max-width: 480px) {
                .dispatch-btn {
                    font-size: 10px;
                    padding: 6px 4px;
                }
            }

            /* 角色养成模块移动端适配 */
            .character-development-input {
                flex-direction: row;
                align-items: center;
                gap: 10px;
                padding: 10px;
            }

            .character-development-label {
                display: flex;
                align-items: center;
                gap: 4px;
                flex: 1;
                flex-wrap: wrap;
            }

            .character-development-value {
                margin-left: 4px;
                white-space: nowrap;
            }

            .character-development-controls {
                align-self: center;
                flex-shrink: 0;
            }

            .character-development-controls input {
                width: 65px;
            }

            /* 饼状图768px适配样式 - 修改图例为2列显示并放大字体 */
            .pie-chart-container {
                flex-direction: column !important;
                gap: 15px !important;
                align-items: center !important;
            }

            .pie-canvas-wrapper {
                width: 100% !important;
                height: 200px !important;
            }

            .pie-legend {
                width: 100% !important;
                max-height: 180px !important; /* 增加高度适应更大字体 */
                margin-top: 10px !important;
                justify-content: flex-start !important;
                padding: 12px !important; /* 增加内边距 */
            }

            .pie-canvas {
                width: 100% !important;
                height: 100% !important;
            }

            /* 图例项改为2列网格布局 */
            .legend-items {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important; /* 2列布局 */
                gap: 10px !important; /* 增加间距 */
            }

            .legend-item {
                margin-bottom: 8px !important; /* 增加间距 */
                display: flex !important;
                align-items: center !important;
                min-height: 20px !important; /* 确保有足够高度 */
            }

            .legend-text {
                font-size: 13px !important; /* 放大字体 */
                line-height: 1.3 !important; /* 增加行高 */
                font-weight: 500 !important; /* 稍微加粗 */
            }

            .legend-color {
                width: 14px !important; /* 增大颜色块 */
                height: 14px !important; /* 增大颜色块 */
                margin-right: 8px !important; /* 增加右边距 */
            }

            .character-development-label {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 8px;
                flex-direction: row;
            }

            .character-development-controls {
                align-self: center;
            }

            .module-toggle {
                margin-left: 0;
                margin-top: 5px;
            }

            /* 饼状图768px适配样式 */
            .pie-chart-container {
                flex-direction: column !important;
                gap: 15px !important;
                align-items: center !important;
            }

            .pie-canvas-wrapper {
                width: 100% !important;
                height: 200px !important;
            }

            .pie-legend {
                width: 100% !important;
                max-height: 150px !important;
                margin-top: 10px !important;
                justify-content: flex-start !important;
            }

            .pie-canvas-wrapper {
                width: 100% !important;
                height: 200px !important;
            }

            .pie-canvas {
                width: 100% !important;
                height: 100% !important;
            }

            .pie-legend {
                width: 100% !important;
                padding: 10px !important;
            }

            .legend-items {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 8px !important;
            }

            .legend-item {
                margin-bottom: 5px !important;
            }

            .legend-text {
                font-size: 11px !important;
            }
        }

        @media (max-width: 480px) {

            /* 新增：小屏幕异方晶修正输入框适配 */
            .custom-adjust .resource-input input {
                max-width: 100px !important;
                font-size: 14px !important;
            }
            
            .custom-adjust .resource-input label {
                font-size: 14px !important;
            }

            .training-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
            }
            
            /* 专门针对活动模块中的复刻按钮调整 */
            .accumulation-item .training-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
                margin-top: 8px;
            }
            
            .accumulation-item .training-btn {
                font-size: 11px;
                padding: 8px 4px;
                min-height: auto;
                white-space: normal;
                line-height: 1.2;
            }
            
            /* 调整复刻按钮中的图标大小 */
            .accumulation-item .training-btn .resource-icon {
                width: 16px;
                height: 16px;
            }

            .character-development-input {
                padding: 8px 10px;
                gap: 8px;
            }

            .character-development-label {
                font-size: 13px;
                gap: 3px;
            }

            .character-development-value {
                font-size: 13px;
                margin-left: 3px;
            }

            .character-development-controls input {
                width: 60px;
                padding: 6px;
                font-size: 13px;
            }

            .resource-icon {
                width: 18px;
                height: 18px;
            }

            .gacha-calculator {
                padding: 5px;
                margin-top: 55px;
                background: transparent;
            }
            
            .sticky-panel {
                top: 65px; /* 更小屏幕调整顶部距离 */
                max-height: calc(100vh - 75px);
            }
            
            .card {
                padding: 10px;
            }
            
            .time-title {
                font-size: 12px;
            }
            
            .time-date {
                font-size: 10px;
            }
            
            .time-days {
                font-size: 12px;
            }
            
            .time-weeks {
                font-size: 10px;
            }
            
            .time-option {
                padding: 8px;
            }

            .resource-input input {
                width: 100%;
            }
            
            .switch-group {
                flex-wrap: wrap;
            }
            
            .result-item.simple {
                font-size: 16px;
            }
            
            .result-item.highlight {
                font-size: 18px;
            }
            
            .sub-section {
                padding: 10px;
            }
            
            .summary-item {
                font-size: 13px;
            }
            
            .resource-input-vertical label {
                font-size: 13px;
            }
            
            .skin-item.compact {
                padding: 8px;
            }
            
            .target-btn, .rating-btn {
                font-size: 11px;
                padding: 6px 4px;
            }

            /* 新增模块小屏幕适配 */
            .main-story-btn {
                font-size: 10px;
                padding: 6px 4px;
            }

            /* 饼状图480px适配样式 */
            .pie-chart-section {
                padding: 8px !important;
                min-height: 250px !important;
            }

            .pie-chart-section h3 {
                font-size: 14px !important;
                margin-bottom: 8px !important;
            }

            .pie-canvas-wrapper {
                height: 180px !important;
            }

            .legend-items {
                grid-template-columns: 1fr !important;
            }

            .legend-text {
                font-size: 10px !important;
            }

            .legend-total {
                font-size: 12px !important;
            }

            /* 狄斯暗影（EX）小屏幕适配 */
            .ex-btn {
                font-size: 10px;
                padding: 6px 4px;
            }

            .memory-storm-btn,
            .pollution-nest-btn,
            .cleanup-operation-btn,
            .palma-ruins-btn {
                font-size: 11px;
                padding: 6px 4px;
            }
            
            .resource-icon {
                width: 20px;
                height: 20px;
            }
            
            .resource-icon.small {
                width: 16px;
                height: 16px;
            }

            /* 饼状图480px适配样式 */
            .pie-chart-section {
                padding: 8px !important;
                min-height: 250px !important;
            }

            .pie-canvas-wrapper {
                height: 180px !important;
            }

            .legend-items {
                grid-template-columns: 1fr !important;
            }

            .legend-text {
                font-size: 10px !important;
            }

            .legend-total {
                font-size: 12px !important;
            }
    
            /* 新增：小屏幕饼状图图例优化 */
            .pie-legend {
                max-height: 160px !important; /* 适当增加高度 */
                padding: 8px !important; /* 增加内边距 */
            }

            .legend-items {
                grid-template-columns: 1fr 1fr !important; /* 保持2列布局 */
                gap: 6px !important; /* 适当间距 */
            }

            .legend-item {
                margin-bottom: 4px !important;
                padding: 2px 4px !important; /* 增加内边距 */
            }

            .legend-text {
                font-size: 11px !important; /* 比原来大，但比768px的小 */
                line-height: 1.2 !important;
            }

            .legend-color {
                width: 12px !important;
                height: 12px !important;
                margin-right: 6px !important;
            }
            
            .legend-total {
                font-size: 12px !important; /* 放大字体 */
                margin-top: 12px !important; /* 增加上边距 */
                padding-top: 8px !important; /* 增加上内边距 */
                font-weight: bold !important; /* 加粗 */
                grid-column: 1 / -1 !important; /* 跨两列显示 */
                text-align: center !important; /* 居中对齐 */
            }
        }

        @media (max-width: 360px) {
            .pie-chart-container {
                flex-direction: column !important;
                gap: 10px !important;
            }
        }

        /* 饼状图canvas样式 */
        .pie-chart-section canvas {
            transition: transform 0.2s ease;
        }

        .pie-chart-section canvas:hover {
            transform: scale(1.02);
        }

        /* 监狱风格白天模式 - 精简版 */
        .light-mode {
            background: #f5f7fa !important;
        }

        .light-mode .gacha-calculator {
            background: transparent !important;
        }

        /* 顶部菜单 - 监狱铁门风格 */
        .light-mode .top-menu-bar {
            background: #2c3e50 !important;
            border-bottom: 3px solid #34495e !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }

        .light-mode .menu-title {
            color: #ecf0f1 !important;
            font-weight: bold;
        }

        .light-mode .menu-btn {
            background: #34495e !important;
            color: #bdc3c7 !important;
            border: 1px solid #4a6572 !important;
            border-radius: 3px !important;
        }

        .light-mode .menu-btn:hover {
            background: #3d566e !important;
            border-color: #5d6d7e !important;
            color: #ecf0f1 !important;
        }

        /* 卡片 - 牢房风格 */
        .light-mode .card {
            background: #ffffff !important;
            border: 2px solid #d5dbdb !important;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08) !important;
            border-radius: 8px !important;
        }

        .light-mode .card::after {
            color: #2c3e50 !important;
        }

        /* 区域标题 - 监狱标识风格 */
        .light-mode .section-header {
            color: #2c3e50 !important;
            font-weight: 600;
        }

        .light-mode .section-header:hover {
            color: #34495e !important;
        }

        .light-mode .collapse-icon {
            color: #2c3e50 !important;
        }

        /* 子区域 - 监狱分区风格 */
        .light-mode .sub-section {
            background: #f8f9f9 !important;
            border-left: 4px solid #95a5a6 !important;
        }

        .light-mode .sub-title {
            color: #2c3e50 !important;
            font-weight: 600;
        }

        /* 内容区域 */
        .light-mode .section-content,
        .light-mode .modal-body,
        .light-mode .result-item,
        .light-mode .item-subtitle,
        .light-mode .custom-tip,
        .light-mode .slider-labels,
        .light-mode .reward-label {
            color: #566573 !important;
        }

        /* 输入框 - 监狱表格风格 */
        .light-mode input,
        .light-mode .resource-input-vertical input,
        .light-mode .character-development-controls input {
            color: #2c3e50 !important;
            background: #fdfefe !important;
            border: 1px solid #d5dbdb !important;
            border-radius: 2px !important;
        }

        .light-mode .slider-value {
            color: #2980b9 !important;
            font-weight: 600;
        }

        /* 按钮组 - 监狱控制面板风格 */
        .light-mode .training-btn, 
        .light-mode .dispatch-btn,
        .light-mode .main-story-btn,
        .light-mode .ex-btn,
        .light-mode .memory-storm-btn,
        .light-mode .pollution-nest-btn,
        .light-mode .cleanup-operation-btn,
        .light-mode .palma-ruins-btn,
        .light-mode .target-btn,
        .light-mode .rating-btn,
        .light-mode .zero-mirror-btn,
        .light-mode .skin-btn,
        .light-mode .character-dev-btn,
        .light-mode .character-development-btn {
            background: #ecf0f1 !important;
            border: 2px solid #bdc3c7 !important;
            color: #2c3e50 !important;
            border-radius: 3px !important;
        }

        .light-mode .training-btn:hover, 
        .light-mode .dispatch-btn:hover,
        .light-mode .main-story-btn:hover,
        .light-mode .ex-btn:hover,
        .light-mode .memory-storm-btn:hover,
        .light-mode .pollution-nest-btn:hover,
        .light-mode .cleanup-operation-btn:hover,
        .light-mode .palma-ruins-btn:hover,
        .light-mode .target-btn:hover,
        .light-mode .rating-btn:hover,
        .light-mode .zero-mirror-btn:hover,
        .light-mode .skin-btn:hover,
        .light-mode .character-dev-btn:hover,
        .light-mode .character-development-btn:hover {
            border-color: #95a5a6 !important;
            background: #d5dbdb !important;
            color: #2c3e50 !important;
        }

        .light-mode .training-btn.active, 
        .light-mode .dispatch-btn.active,
        .light-mode .main-story-btn.active,
        .light-mode .ex-btn.active,
        .light-mode .memory-storm-btn.active,
        .light-mode .pollution-nest-btn.active,
        .light-mode .cleanup-operation-btn.active,
        .light-mode .palma-ruins-btn.active,
        .light-mode .target-btn.active,
        .light-mode .rating-btn.active,
        .light-mode .zero-mirror-btn.active,
        .light-mode .character-dev-btn.active,
        .light-mode .character-development-btn.active {
            border-color: #2980b9 !important;
            background: #2980b9 !important;
            color: white !important;
        }

        /* 开关和滑块 */
        .light-mode .switch-group .switch-label {
            color: #566573 !important;
        }

        .light-mode .switch-group .switch-label.active {
            color: #2980b9 !important;
        }

        .light-mode .slider {
            background-color: #bdc3c7 !important;
        }

        .light-mode input:checked + .slider {
            background-color: #2980b9 !important;
        }

        /* 模态框 */
        .light-mode .modal-content {
            background: #ffffff !important;
            border: 2px solid #d5dbdb !important;
        }

        .light-mode .modal-header {
            background: #2c3e50 !important;
        }

        .light-mode .modal-title {
            color: #ecf0f1 !important;
        }

        .light-mode .modal-section {
            background: #f8f9f9 !important;
            border-left: 4px solid #95a5a6 !important;
        }

        /* 滚动条 */
        .light-mode .modal-body::-webkit-scrollbar-track {
            background: #ecf0f1 !important;
        }

        .light-mode .modal-body::-webkit-scrollbar-thumb {
            background: #95a5a6 !important;
        }

        /* 特殊模块 */
        .light-mode .summary-section {
            background: #f8f9f9 !important;
            border-left: 4px solid #2980b9 !important;
        }

        .light-mode .summary-label {
            color: #2c3e50 !important;
        }

        .light-mode .summary-value {
            color: #2980b9 !important;
        }

        .light-mode .shop-section {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
        }

        /* 确保所有文本颜色一致 */
        .light-mode .section-content { color: #566573 !important; }
        .light-mode .modal-body { color: #566573 !important; }
        .light-mode .result-item { color: #566573 !important; }
        .light-mode input { color: #2c3e50 !important; }

        /* 修复所有背景色 */
        .light-mode .nightmare-score {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
        }

        .light-mode .action-summary .summary-header,
        .light-mode .permanent-activity .summary-header {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
        }

        .light-mode .data-gap-subsection {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
        }

        /* 修复内联样式 - 行动纪要头部 */
        .action-summary-header {
            background: #2a2a2a !important;
            padding: 12px 15px !important;
            border-radius: 8px !important;
            border: 1px solid #444444 !important;
            margin-bottom: 15px !important;
        }

        .summary-header-inner {
            display: flex !important;
            align-items: center !important;
            gap: 15px !important;
        }

        .action-summary-text {
            font-size: 16px !important;
            font-weight: bold !important;
            color: #FF4500 !important;
            flex: 1 !important;
        }

        .action-summary-crystal {
            font-size: 14px !important;
            font-weight: bold !important;
            color: #1890ff !important;
            white-space: nowrap !important;
        }

        /* 白天模式下的行动纪要样式 */
        .light-mode .action-summary-header {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
        }

        .light-mode .action-summary-text {
            color: #2c3e50 !important;
        }

        .light-mode .action-summary-crystal {
            color: #2980b9 !important;
        }

        /* 修复记忆复现模块的文字颜色 - 白天模式 */
        .light-mode .permanent-activity .summary-header {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
        }

        .light-mode .permanent-activity .summary-text {
            color: #2c3e50 !important;
            font-weight: 600 !important;
        }

        .light-mode .permanent-activity .summary-crystal {
            color: #2980b9 !important;
            font-weight: 600 !important;
        }

        /* 修复记忆复现滑块相关文字 */
        .light-mode .permanent-activity .slider-labels {
            color: #566573 !important;
        }

        .light-mode .permanent-activity .slider-value {
            color: #2980b9 !important;
            font-weight: 600 !important;
        }

        /* 修复记忆复现标题 */
        .light-mode .permanent-activity .sub-title {
            color: #2c3e50 !important;
            font-weight: 600 !important;
        }

        /* 统一修复所有滑块按钮的白天模式 */
        .light-mode .score-slider {
            background: #f8f9f9 !important;
        }

        .light-mode .score-slider::-webkit-slider-track {
            background: #bdc3c7 !important;
        }

        .light-mode .score-slider::-moz-range-track {
            background: #bdc3c7 !important;
        }

        .light-mode .score-slider::-webkit-slider-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        .light-mode .score-slider::-moz-range-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        .light-mode .inspection-slider {
            background: #f8f9f9 !important;
        }

        .light-mode .inspection-slider::-webkit-slider-track {
            background: #bdc3c7 !important;
        }

        .light-mode .inspection-slider::-moz-range-track {
            background: #bdc3c7 !important;
        }

        .light-mode .inspection-slider::-webkit-slider-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        .light-mode .inspection-slider::-moz-range-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        /* 统一修复所有资源显示项的白天模式 */
        .light-mode .resource-input-vertical {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .skin-item.compact {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .character-development-input {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .data-gap-subsection {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .accumulation-item {
            background: #f8f9f9 !important;
            border-radius: 5px !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .nightmare-score {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .shop-section {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        /* 修复输入框在白天模式下的样式 */
        .light-mode .resource-input-vertical input,
        .light-mode .character-development-controls input,
        .light-mode input[type="number"] {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
            color: #2c3e50 !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        /* 修复按钮在白天模式下的背景 */
        .light-mode .skin-btn,
        .light-mode .character-dev-btn,
        .light-mode .certification-btn {
            background: #ecf0f1 !important;
            border: 1px solid #bdc3c7 !important;
            color: #2c3e50 !important;
        }

        .light-mode .skin-btn:hover,
        .light-mode .character-dev-btn:hover,
        .light-mode .certification-btn:hover {
            background: #d5dbdb !important;
            border-color: #95a5a6 !important;
        }

        /* 统一修复所有资源显示项的字体颜色 - 白天模式 */
        .light-mode .resource-input-vertical label,
        .light-mode .skin-item.compact .skin-price,
        .light-mode .character-development-label,
        .light-mode .character-development-value,
        .light-mode .data-gap-title,
        .light-mode .accumulation-item .item-title,
        .light-mode .accumulation-item .item-value,
        .light-mode .accumulation-item .item-subtitle,
        .light-mode .nightmare-score .score-title,
        .light-mode .shop-section .shop-title,
        .light-mode .sub-title,
        .light-mode .data-gap-title,
        .light-mode .slider-value,
        .light-mode .reward-label,
        .light-mode .reward-value {
            color: #2c3e50 !important;
        }

        /* 修复特定高亮颜色的文字 */
        .light-mode .summary-value,
        .light-mode .item-value,
        .light-mode .character-development-value,
        .light-mode .skin-count,
        .light-mode .slider-value {
            color: #2980b9 !important;
        }

        .light-mode .sub-title,
        .light-mode .data-gap-title,
        .light-mode .shop-title,
        .light-mode .score-title {
            color: #2c3e50 !important;
            font-weight: 600 !important;
        }

        /* 修复描述性文字的浅色 */
        .light-mode .item-subtitle,
        .light-mode .custom-tip,
        .light-mode .slider-labels,
        .light-mode .reward-label {
            color: #566573 !important;
        }

        /* 修复资源转换文字的颜色 */
        .light-mode .resource-conversion {
            color: #95a5a6 !important;
        }

        /* 修复开关标签的颜色 */
        .light-mode .switch-label {
            color: #566573 !important;
        }

        .light-mode .switch-label.active {
            color: #2980b9 !important;
            font-weight: bold !important;
        }

        .light-mode .switch-label.inactive {
            color: #95a5a6 !important;
        }

        /* 修复饼状图模块的白天模式 */
        .light-mode .pie-chart-section {
            background: #ffffff !important;
            border: 2px solid #d5dbdb !important;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08) !important;
        }

        .light-mode .pie-chart-section h3 {
            color: #2c3e50 !important;
        }

        .light-mode .pie-legend {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .legend-text {
            color: #2c3e50 !important;
        }

        .light-mode .legend-total {
            color: #2c3e50 !important;
            border-top-color: #d5dbdb !important;
        }

        /* 修复饼状图提示框的白天模式 */
        .light-mode .pie-tooltip {
            background: rgba(255, 255, 255, 0.95) !important;
            color: #2c3e50 !important;
            border: 1px solid #2980b9 !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }

        .light-mode .tooltip-details {
            color: #2980b9 !important;
        }

        /* 修复饼状图引导线和标签 */
        .light-mode .pie-chart-section canvas {
            filter: none !important;
        }

        /* 修复饼状图所在卡片的白天模式 */
        .light-mode .time-section.card {
            background: #ffffff !important;
            border: 2px solid #d5dbdb !important;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08) !important;
        }

        .light-mode .time-section.card::after {
            color: #2c3e50 !important;
        }

        /* 修复时间选项的白天模式 */
        .light-mode .time-option {
            background: #f8f9f9 !important;
            border: 2px solid #d5dbdb !important;
            color: #566573 !important;
        }

        .light-mode .time-option.active {
            border-color: #2980b9 !important;
            background: #e8f4fd !important;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.2) !important;
        }

        .light-mode .time-title {
            color: #2c3e50 !important;
        }

        .light-mode .time-days {
            color: #2980b9 !important;
        }

        .light-mode .time-date {
            color: #566573 !important;
        }

        /* 修复开关组的白天模式 */
        .light-mode .switch-group .switch-label {
            color: #566573 !important;
        }

        .light-mode .switch-group .switch-label.active {
            color: #2980b9 !important;
            font-weight: bold !important;
        }

        /* 修复饼状图区域的文字颜色 */
        .light-mode .section-header {
            color: #2c3e50 !important;
        }

        .light-mode .collapse-icon {
            color: #2c3e50 !important;
        }

        /* 修复异方晶修正白天模式字体颜色 */
        .light-mode .custom-adjust .resource-input label {
            color: #2c3e50 !important;
        }
        
        /* 菜单按钮激活状态 */
        .menu-btn.active {
            background: #8B0000 !important;
            border-color: #FF4500 !important;
            color: white !important;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5) !important;
        }

        /* 白天模式下的按钮激活状态 */
        .light-mode .menu-btn.active {
            background: #2980b9 !important;
            border-color: #2980b9 !important;
            color: white !important;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.5) !important;
        }

        /* 监察密令按钮样式 */
        .inspection-order-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .inspection-period-btn-wrapper {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .inspection-period-btn {
            padding: 10px 8px;
            border: 2px solid #555555;
            background: #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #CCCCCC;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .inspection-period-btn:hover {
            border-color: #FF4500;
            background: #3a3a3a;
            color: #FFFFFF;
        }

        .inspection-period-btn.active {
            border-color: #FF4500;
            background: #8B0000;
            color: white;
            box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
        }

        .inspection-slider-container {
            padding: 10px;
            background: #333333;
            border-radius: 6px;
            border: 1px solid #444444;
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .inspection-period-btn {
                font-size: 12px;
                padding: 8px 6px;
            }
        }

        /* 监察密令奖励信息样式 */
        .reward-info {
            margin-top: 10px;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 5px;
            border: 1px solid #444444;
        }

        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 12px;
        }

        .reward-label {
            color: #CCCCCC;
        }

        .reward-value {
            color: #FF4500;
            font-weight: bold;
        }

        .reward-value.claimed {
            color: #666666;
            text-decoration: line-through;
        }

        /* 监察密令滑块容器样式 */
        .inspection-slider-container {
            padding: 15px;
            background: #333333;
            border-radius: 6px;
            border: 1px solid #444444;
            margin-top: 8px;
        }

        .inspection-slider-container .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            color: #CCCCCC;
        }

        .inspection-slider-container .slider-value {
            text-align: center;
            font-size: 13px;
            color: #FF4500;
            margin-top: 8px;
            font-weight: bold;
        }

        /* 监察密令白天模式样式 */
        .light-mode .inspection-period-btn {
            background: #ecf0f1 !important;
            border: 2px solid #bdc3c7 !important;
            color: #2c3e50 !important;
            border-radius: 3px !important;
        }

        .light-mode .inspection-period-btn:hover {
            border-color: #95a5a6 !important;
            background: #d5dbdb !important;
            color: #2c3e50 !important;
        }

        .light-mode .inspection-period-btn.active {
            border-color: #2980b9 !important;
            background: #2980b9 !important;
            color: white !important;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.5) !important;
        }

        .light-mode .inspection-slider-container {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .inspection-slider-container .slider-labels {
            color: #566573 !important;
        }

        .light-mode .inspection-slider-container .slider-value {
            color: #2980b9 !important;
        }

        .light-mode .reward-info {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .light-mode .reward-label {
            color: #2c3e50 !important;
        }

        .light-mode .reward-value {
            color: #2980b9 !important;
        }

        .light-mode .reward-value.claimed {
            color: #95a5a6 !important;
        }

        /* 监察密令滑块白天模式 */
        .light-mode .inspection-slider {
            background: #f8f9f9 !important;
        }

        .light-mode .inspection-slider::-webkit-slider-track {
            background: #bdc3c7 !important;
        }

        .light-mode .inspection-slider::-moz-range-track {
            background: #bdc3c7 !important;
        }

        .light-mode .inspection-slider::-webkit-slider-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        .light-mode .inspection-slider::-moz-range-thumb {
            background: #2980b9 !important;
            border: 2px solid #3498db !important;
        }

        /* 监察密令滑块禁用状态白天模式 */
        .light-mode .inspection-slider:disabled {
            opacity: 0.5 !important;
        }

        .light-mode .inspection-slider:disabled::-webkit-slider-thumb {
            background: #95a5a6 !important;
            border: 2px solid #bdc3c7 !important;
        }

        .light-mode .inspection-slider:disabled::-moz-range-thumb {
            background: #95a5a6 !important;
            border: 2px solid #bdc3c7 !important;
        }

        /* === 新增：晶源特供按钮样式 === */

        .crystal-supply-btn.active {
        border-color: #FFD700 !important;
        background: linear-gradient(135deg, #8B0000, #FF4500) !important;
        color: white !important;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5) !important;
        }

        /* 白天模式下的晶源特供按钮 */
        .light-mode .crystal-supply-btn.active {
        border-color: #FFD700 !important;
        background: linear-gradient(135deg, #2980b9, #3498db) !important;
        color: white !important;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5) !important;
        }

        /* 白天模式下的晶源特供输入框样式 */
        .light-mode .non-first-crystal-supply-input {
            background: #ffffff !important;
            border: 1px solid #d5dbdb !important;
            color: #2c3e50 !important;
        }



        /* 说明行样式 */
        .explanation-row {
            background: #333333;
            border: 1px solid #444444;
        }

        .explanation-text {
            color: #CCCCCC;
        }

        /* 白天模式下的说明行样式 */
        .light-mode .explanation-row {
            background: #f8f9f9 !important;
            border: 1px solid #d5dbdb !important;
        }

        .light-mode .explanation-text {
            color: #2c3e50 !important;
            font-weight: 500;
        }
    </style>
</head>
<body class="light-mode">
    
    <div id="app">
        <!-- 顶部菜单栏 -->
        <div class="top-menu-bar">
            <div class="menu-title"><img :src="hlIcon" class="resource-icon" alt="海拉">海拉的钱包</div>
            <div class="menu-right">
                <button class="menu-btn" 
                        :class="{ active: showModal && currentModal === 'info' }" 
                        @click="showWebpageInfo">说明</button>
                <button class="menu-btn" 
                        :class="{ active: showModal && currentModal === 'feedback' }" 
                        @click="showFeedback">反馈</button>
                <button class="menu-btn theme-toggle" @click="toggleTheme" :title="isDarkMode ? '切换到白天模式' : '切换到夜晚模式'">
                    {{ isDarkMode ? '🌙' : '☀️' }}
                </button>
            </div>
        </div>
        
        <!-- 统一弹窗 -->
        <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">{{ currentModal === 'info' ? '📖 网页说明' : '💬 反馈与更新' }}</h3>
                    <button class="modal-close" @click="closeModal">×</button>
                </div>
                
                <div class="modal-body">
                    <!-- 说明弹窗内容 -->
                    <div v-if="currentModal === 'info'">
                        <div class="modal-section">
                            <div class="modal-section-title">📱 工具简介</div>
                            <p>这是一个<strong class="modal-highlight">无期迷途抽卡资源计算器</strong>，可以帮助你科学规划抽卡资源，避免资源浪费</p>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">🚀 使用指南</div>
                            <ol class="modal-list">
                                <li>在<strong class="modal-highlight">「当前资源」</strong>模块输入你现有的抽卡资源</li>
                                <li>根据实际情况在<strong class="modal-highlight">各个模块</strong>中设置相关参数</li>
                                <li>查看<strong class="modal-highlight">顶部总计</strong>了解可获得的总抽数</li>
                                <li>通过<strong class="modal-highlight">饼状图分析</strong>了解各模块资源占比</li>
                                <li>合理规划你的抽卡策略！</li>
                            </ol>
                        </div>

                        <div class="modal-section">
                            <div class="modal-section-title">⚡ 主要功能</div>
                            <ul class="modal-list">
                                <li>💎 <strong>当前资源管理</strong> - 记录异方晶、璀璨晶源、搜索令等</li>
                                <li>📈 <strong>日常积累计算</strong> - 自动计算日常、周常、月常奖励</li>
                                <li>🎯 <strong>活动资源估算</strong> - 估算活动可获得抽卡资源</li>
                                <li>🔮 <strong>潜在资源统计</strong> - 统计主线关卡等潜在资源</li>
                                <li>💰 <strong>氪金资源规划</strong> - 规划月卡、礼包等付费内容</li>
                            </ul>
                        </div>

                        <div class="modal-section">
                            <div class="modal-section-title">⚠️ 注意事项</div>
                            <ul class="modal-list">
                                <li>部分活动资源为<strong class="modal-highlight">估算值</strong>，实际以游戏内为准</li>
                                <li>数据会<strong class="modal-highlight">自动保存</strong>在本地浏览器中</li>
                            </ul>
                        </div>                        
                        
                    </div>

                    <!-- 反馈弹窗内容 -->
                    <div v-else-if="currentModal === 'feedback'">
                        <div class="modal-section">
                            <div class="modal-section-title">🐛 问题反馈</div>
                            <p>如果局长在使用过程中遇到<strong class="modal-highlight">任何问题或发现BUG</strong>非常欢迎局长通过以下渠道反馈：</p>
                            <ul class="modal-list">
                                <li>🖥️ 通过B站后台私信@是醉染哦</li>
                                <li>👥 加入Q群联系：1049297956</li>
                                <li>📧 邮件反馈2309141313@qq.com</li>
                            </ul>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">⚡ 更新日志</div>
                            <ul class="modal-list">
                                <li><strong class="modal-highlight">25.11.02</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;攒抽模拟器<strong class="modal-highlight">正式上线</strong>
                                </li>
                                <li><strong class="modal-highlight">25.11.03</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">监管收菜、多项合金兑换、记忆复现、梦境&人格色谱、零境系统、灰烬之潮-重塑、派遣区域声望、说明&反馈、日夜模式切换</strong>功能
                                </li>   
                                <li><strong class="modal-highlight">25.11.04</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">监察密令每期等级选择</strong>功能
                                </li>  
                                <li><strong class="modal-highlight">25.11.05</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">晶源特供</strong>模块
                                </li>  
                                <li><strong class="modal-highlight">25.11.06</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">常驻&限时礼包</strong>模块
                                </li>
                                <li><strong class="modal-highlight">25.11.07</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">旧案归档处</strong>模块<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修正<strong class="modal-highlight">大量计算BUG</strong>
                                </li>       
                                <li><strong class="modal-highlight">25.11.11</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优化<strong class="modal-highlight">用户体验</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修正<strong class="modal-highlight">少量计算BUG</strong>
                                </li>  
                                <li><strong class="modal-highlight">25.11.17</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">时尚巡回庆典（付费&非付费）、公会战、绝密行动</strong>奖励计算<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修正<strong class="modal-highlight">少量计算BUG</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;时尚巡回庆典（付费）可以正常影响皮肤预留红晶数量（正确扣减300）
                                </li> 
                                <li><strong class="modal-highlight">25.11.19</strong><br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增<strong class="modal-highlight">歧行至破晓版本</strong>限时礼包<br>
                                </li>                                                                                                                                                                                                                                                   
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <div class="modal-contact">
                        {{ currentModal === 'info' ? '祝局长十连三金！ 🎉' : '感谢局长的使用与支持！ ❤️' }}
                    </div>
                </div>
            </div>
        </div>

        <!-- 左右7大模块 -->
        <div class="gacha-calculator">
            <div class="calculator-layout">
                <!-- 左侧：总计模块 -->
                <div class="left-panel sticky-panel">
                    <div class="time-section card">
                        <h2 @click="toggleSection('pullSummary')" class="section-header">
                        📊 共计 {{ totalModulePulls }} 抽 💰 氪金 {{ totalRechargeCost }} ￥
                        <span class="collapse-icon">{{ sections.pullSummary ? '−' : '+' }}</span>
                        </h2>
                        
                        <!-- 资源信息 - 始终显示 -->
                        <div class="sub-section" style="display: flex; justify-content: space-around; align-items: center; gap: 15px;">
                            <div class="summary-item" style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
                                    <span class="summary-value">{{ totalAllCrystal }}</span>
                                    <div style="font-size: 12px; color: #666;">({{ Math.floor(totalAllCrystal / 180) }})</div>
                                </div>
                            </div>
                            <div class="summary-item" style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
                                    <span class="summary-value">{{ totalAllPremiumCrystal }}</span>
                                    <div style="font-size: 12px; color: #666;">({{ Math.floor(totalAllPremiumCrystal / 180) }})</div>
                                </div>
                            </div>
                            <div class="summary-item" style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
                                    <span class="summary-value">{{ totalAllTickets }}</span>
                                    <div style="font-size: 12px; color: #666;">({{ totalAllTickets }})</div>
                                </div>
                            </div>
                            <div class="summary-item" style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                <img :src="limitedCouponIcon" class="resource-icon" alt="限定券">
                                <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
                                    <span class="summary-value">{{ totalAllLimitedCoupons }}</span>
                                    <div style="font-size: 12px; color: #666;">({{ totalAllLimitedCoupons }})</div>
                                </div>
                            </div>
                        </div>

                        <!-- 详细内容 - 可折叠 -->
                        <div v-if="sections.pullSummary" class="section-content">
                            <!-- 卡池时间内容 -->
                            <div class="switch-group">
                                <span class="switch-label" :class="{ active: !calculateToPoolEnd, inactive: calculateToPoolEnd }">计算到卡池开放当天</span>
                                <label class="switch">
                                    <input type="checkbox" v-model="calculateToPoolEnd">
                                    <span class="slider"></span>
                                </label>
                                <span class="switch-label" :class="{ active: calculateToPoolEnd, inactive: !calculateToPoolEnd }">计算到卡池结束当天</span>
                            </div>
                            
                            <!-- 新增饼状图 -->
                            <div class="pie-chart-section">
                                <h3 style="text-align: center; margin-bottom: 15px; color: #FF6B6B;">各模块抽数占比</h3>
                                
                                <div class="pie-chart-container">
                                    <!-- 饼状图容器 -->
                                    <div class="pie-canvas-wrapper">
                                        <canvas 
                                            ref="pieChart" 
                                            @mousemove="handlePieChartMouseMove"
                                            @mouseleave="handlePieChartMouseLeave"
                                            @touchstart="handlePieChartTouchStart"
                                            @touchmove="handlePieChartTouchMove"
                                            @touchend="handlePieChartTouchEnd"
                                            class="pie-canvas"
                                        ></canvas>
                                        
                                        <!-- 悬停提示框 -->
                                        <div v-if="hoveredPieModule" class="pie-tooltip">
                                            <div>{{ hoveredPieModule.name }}</div>
                                            <div class="tooltip-details">
                                                {{ hoveredPieModule.pulls }}抽 ({{ hoveredPieModule.percentage }}%)
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 图例 - 响应式布局 -->
                                    <div class="pie-legend">
                                        <div class="legend-items">
                                            <div v-for="(module, index) in pieChartData" :key="module.name" class="legend-item">
                                                <div class="legend-color" :style="{ backgroundColor: module.color }"></div>
                                                <span class="legend-text">
                                                    {{ module.name }}: {{ module.pulls }}抽 ({{ module.percentage }}%)
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="time-options">
                                <div class="time-option" 
                                    :class="{ active: selectedTime === 'nextVersion' }"
                                    @click="selectedTime = 'nextVersion'">
                                    <div class="time-header">
                                        <div class="time-title">歧行至破晓</div>
                                        <div class="time-days">倒计时 {{ calculateDisplayDays('nextVersion') }} 天</div>
                                    </div>
                                    <div class="time-date">{{ formattedNextVersionDate }}</div>
                                </div>

                                <div class="time-option" 
                                    :class="{ active: selectedTime === 'newYear' }"
                                    @click="selectedTime = 'newYear'">
                                    <div class="time-header">
                                        <div class="time-title">新年版本</div>
                                        <div class="time-days">倒计时 {{ calculateDisplayDays('newYear') }} 天</div>
                                    </div>
                                    <div class="time-date">{{ formattedNewYearDate }}</div>
                                </div>
                            </div>                            
                        </div>                        
                    </div>
                </div>

                <!-- 右侧：明细模块 -->
                <div class="right-panel">
                    <!-- 当前资源 -->
                    <div class="input-section card">
                        <h2 @click="toggleSection('resources')" class="section-header">
                            💎 当前资源
                            <span class="collapse-icon">{{ sections.resources ? '−' : '+' }}</span>
                        </h2>
                        <!-- 子模块 -->
                        <div v-if="sections.resources" class="section-content">
                            <!-- 当前库存 -->
                            <div class="sub-section">
                                <h3 class="sub-title">当前库存</h3>
                                <!-- 使用璀璨晶源开关移入当前库存 -->
                                <div class="switch-group">
                                    <label class="switch">
                                        <input type="checkbox" v-model="usePremiumCrystal">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="switch-label">使用璀璨晶源抽卡</span>
                                </div>
                                <div class="resource-vertical">
                                    <div class="resource-input-vertical">
                                        <label>
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 异方晶：
                                        </label>
                                        <input type="number" v-model.number="resources.crystal" placeholder="" min="0" step="1" 
                                            @input="validateInputDelayed('crystal')" 
                                            @focus="clearIfZero('crystal')" 
                                            @blur="setDefaultIfEmpty('crystal')">
                                    </div>
                                    <div class="resource-input-vertical">
                                        <label>
                                            <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源"> 璀璨晶源：
                                        </label>
                                        <input type="number" v-model.number="resources.premiumCrystal" placeholder="" min="0" step="1" 
                                            @input="validateInputDelayed('premiumCrystal')" 
                                            @focus="clearIfZero('premiumCrystal')" 
                                            @blur="setDefaultIfEmpty('premiumCrystal')">
                                    </div>
                                    <div class="resource-input-vertical">
                                        <label>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> 搜索令：
                                        </label>
                                        <input type="number" v-model.number="resources.tickets" placeholder="" min="0" step="1" 
                                            @input="validateInputDelayed('tickets')" 
                                            @focus="clearIfZero('tickets')" 
                                            @blur="setDefaultIfEmpty('tickets')">
                                    </div>
                                </div>
                            </div>

                            <!-- 皮肤预留红晶 -->
                            <div class="sub-section" :class="{ 'disabled-section': !usePremiumCrystal }">
                                <h3 class="sub-title">皮肤预留红晶</h3>
                                <div class="skin-reserve-row">
                                    <div class="skin-item compact">
                                        <div class="skin-info">
                                            <span class="skin-price">✧✧880<img :src="redCrystalIcon" class="resource-icon small" alt="红晶"></span>
                                        </div>
                                        <div class="skin-controls">
                                            <button class="skin-btn" @click="adjustSkinCount(880, -1)" :disabled="!usePremiumCrystal">−</button>
                                            <span class="skin-count">{{ skinReserve.skin880 }} 个</span>
                                            <button class="skin-btn" @click="adjustSkinCount(880, 1)" :disabled="!usePremiumCrystal">+</button>
                                        </div>
                                    </div>
                                    <div class="skin-item compact">
                                        <div class="skin-info">
                                            <span class="skin-price">✧✧✧1280<img :src="redCrystalIcon" class="resource-icon small" alt="红晶"></span>
                                        </div>
                                        <div class="skin-controls">
                                            <button class="skin-btn" @click="adjustSkinCount(1280, -1)" :disabled="!usePremiumCrystal">−</button>
                                            <span class="skin-count">{{ skinReserve.skin1280 }} 个</span>
                                            <button class="skin-btn" @click="adjustSkinCount(1280, 1)" :disabled="!usePremiumCrystal">+</button>
                                        </div>
                                    </div>
                                    <div class="skin-item compact">
                                        <div class="skin-info">
                                            <span class="skin-price">✧✧✧✧2580<img :src="redCrystalIcon" class="resource-icon small" alt="红晶"></span>
                                        </div>
                                        <div class="skin-controls">
                                            <button class="skin-btn" @click="adjustSkinCount(2580, -1)" :disabled="!usePremiumCrystal">−</button>
                                            <span class="skin-count">{{ skinReserve.skin2580 }} 个</span>
                                            <button class="skin-btn" @click="adjustSkinCount(2580, 1)" :disabled="!usePremiumCrystal">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 自定义修正 -->
                            <div class="custom-adjust">
                                <div class="resource-input">
                                    <label style="min-width: 140px; flex-shrink: 0;">
                                        <img :src="crystalIcon" class="resource-icon" alt="异方晶">异方晶修正：
                                    </label>
                                    <input type="number" v-model.number="customAdjustment" placeholder="0" style="max-width: 120px;" 
                                        @input="validateCustomAdjustment"
                                        @focus="clearCustomAdjustmentIfZero" 
                                        @blur="setCustomAdjustmentDefaultIfEmpty">
                                </div>
                                <div class="custom-tip">
                                    例如关卡未打满、给复刻池预留、其它异方晶来源等，可填负数（最多扣减当前库存）
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 日常积累 -->
                    <div class="daily-section card">
                        <h2 @click="toggleSection('daily')" class="section-header">
                            📈 日常积累（更替）
                            <span class="collapse-icon">{{ sections.daily ? '−' : '+' }}</span>
                        </h2>
                        <!-- 子模块 -->
                        <div v-if="sections.daily" class="section-content">
                            <!-- 活跃奖励 -->
                            <div class="sub-section">
                                <h3 class="sub-title">活跃奖励</h3>
                                <!-- 日常活跃 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">日常{{ selectedDays }}天：</span>
                                        <span class="item-value"><img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dailyActiveTotal }} </span>
                                    </div>
                                </div>

                                <!-- 周常活跃 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">周常{{ remainingWeeklyCount }}周：</span>
                                        <span class="item-value"><img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ weeklyActiveReward }} </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="weeklyCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本周已完成</span>
                                    </div>
                                </div>

                                <!-- 每周分享 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">分享{{ remainingShareWeeks }}周：</span>
                                        <span class="item-value"> <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ remainingShareTotal }} </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="dailyShareCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本周已分享</span>
                                    </div>
                                </div>

                                <!-- 情绪检测 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">情绪检测{{ emotionDetectionCompleted ? (remainingMonths - 1) : remainingMonths }}月：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">{{ totalEmotionDetection }} <img :src="ticketIcon" class="resource-icon" alt="搜索令">{{ totalEmotionDetectionTickets }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="emotionDetectionCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本月已完成</span>
                                    </div>
                                </div>

                                <!-- 签到奖励 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">签到奖励{{ signInRewardCompleted ? (remainingMonths - 1) : remainingMonths }}月：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">{{ totalSignInReward }} <img :src="ticketIcon" class="resource-icon" alt="搜索令">{{ totalSignInRewardTickets }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="signInRewardCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本月已完成</span>
                                    </div>
                                </div>

                                <!-- 监管收菜 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">监管收菜：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">{{ supervisionHarvestCrystal }}
                                        </span>
                                    </div>
                                </div>

                                <!-- 多项合金兑换 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">多项合金兑换：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">{{ alloyExchangeCrystal }}
                                        </span>
                                    </div>
                                    <div class="certification-controls">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <input 
                                                type="number" 
                                                v-model.number="alloyCount" 
                                                placeholder="0" 
                                                min="0" 
                                                step="1" 
                                                @input="validateAlloyInput"
                                                @focus="clearAlloyIfZero()"
                                                @blur="setAlloyDefaultIfEmpty()"
                                                style="width: 80px; padding: 8px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);"
                                            >
                                            <img :src="alloyIcon" class="resource-icon" alt="多项合金">
                                        </div>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="useAlloyExchange">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">使用合金兑换</span>
                                    </div>
                                </div>

                                <!-- 基础时尚巡回庆典 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">基础时尚巡回庆典{{ fashionTourCompleted ? (fashionTourPeriods - 1) : fashionTourPeriods }}期：</span>
                                        <span class="item-value">
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ totalFashionTourTickets }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="fashionTourCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本周已领取</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 监察密令 -->
                            <div class="sub-section">
                                <h3 class="sub-title">监察密令</h3>
                                <div class="inspection-order-buttons">
                                    <div v-for="period in inspectionPeriods" :key="period.id" class="inspection-period-btn-wrapper">
                                        <button 
                                            class="inspection-period-btn" 
                                            :class="{ active: selectedInspectionPeriod === period.id }"
                                            @click="selectInspectionPeriod(period.id)">
                                            {{ period.startDate }}到{{ period.endDate }} <img :src="ticketIcon" class="resource-icon" alt="搜索令">{{ calculateCurrentPeriodTickets(inspectionLevels[period.id]) }}
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- 滑块容器-->
                                <div class="inspection-slider-container" v-if="selectedInspectionPeriod">
                                    <div class="slider-labels">
                                        <span>0级</span>
                                        <span>55级</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        v-model.number="inspectionLevels[selectedInspectionPeriod]" 
                                        @input="snapInspectionLevel(selectedInspectionPeriod)"
                                        min="0" 
                                        max="55"
                                        step="1"
                                        class="inspection-slider"
                                    >
                                    <div class="slider-value">
                                        当前等级: {{ inspectionLevels[selectedInspectionPeriod] }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 商店兑换 -->
                            <div class="sub-section">
                                <h3 class="sub-title">商店兑换</h3>

                                <!-- 追踪认证-常规 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">追踪认证-常规{{ trackingExchanged ? (remainingMonths - 1) : remainingMonths }}月：</span>
                                        <span class="item-value"> <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ totalTrackingExchange }}</span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="trackingExchanged">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本月已兑换</span>
                                    </div>
                                </div>

                                <!-- 追踪认证-机密 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">追踪认证-机密：</span>
                                        <span class="item-value"> <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ totalTrackingCertificationTickets }}</span>
                                    </div>
                                    <div class="certification-controls">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <input 
                                                type="number" 
                                                v-model.number="trackingCertificationCount" 
                                                placeholder="0" 
                                                min="0" 
                                                step="1" 
                                                @input="validateCertificationInput"
                                                @focus="clearCertificationIfZero()"
                                                @blur="setCertificationDefaultIfEmpty()"
                                                style="width: 80px; padding: 8px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);"
                                            >
                                            <img :src="yellowTicketIcon" class="resource-icon" alt="黄票">
                                        </div>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="useTrackingCertification">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">使用黄票兑换</span>
                                    </div>
                                </div>

                                <!-- 友情兑换 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">友情兑换{{ friendshipExchanged ? (remainingMonths - 1) : remainingMonths }}月：</span>
                                        <span class="item-value"> <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ totalFriendshipExchange }}</span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="friendshipExchanged">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本月已兑换</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 破碎防线 -->
                            <div class="sub-section">
                                <h3 class="sub-title">破碎防线-暗域</h3>
                                <div class="dark-zone-section">
                                    <!-- 暗域-更替 -->
                                    <div class="accumulation-item">
                                        <div class="item-info">
                                            <span class="item-title">暗域{{ remainingDarkZoneWeeks }}周：</span>
                                            <span class="item-value"> <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ totalDarkZone }}</span>
                                        </div>
                                        <div class="dark-zone-switches">
                                            <div class="switch-group small">
                                                <label class="switch">
                                                    <input type="checkbox" v-model="darkZoneSweepOnly">
                                                    <span class="slider"></span>
                                                </label>
                                                <span class="switch-label">仅扫荡</span>
                                            </div>
                                            <div class="switch-group small">
                                                <label class="switch">
                                                    <input type="checkbox" v-model="darkZoneCompleted">
                                                    <span class="slider"></span>
                                                </label>
                                                <span class="switch-label">本周已完成</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 暗域-首通 -->
                                    <div class="accumulation-item">
                                        <div class="item-info">
                                            <span class="item-title">首通奖励{{ darkZoneFirstCompleted ? (darkZoneFirstPeriods - 1) : darkZoneFirstPeriods }}期：</span>
                                            <span class="item-value"> <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ totalDarkZoneFirst }}</span>
                                        </div>
                                        <div class="switch-group small">
                                            <label class="switch">
                                                <input type="checkbox" v-model="darkZoneFirstCompleted">
                                                <span class="slider"></span>
                                            </label>
                                            <span class="switch-label">本期已完成</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 数据间隙 -->
                            <div class="sub-section">
                                <h3 class="sub-title">数据间隙</h3>
                                <div style="font-size: 12px; color: #666; margin-top: 5px; font-style: italic;">
                                    &nbsp;&nbsp;每赛季分上下半赛季，分别为1期<br>
                                </div>
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">数据间隙{{ dataGapCompleted ? (dataGapPeriods - 1) : dataGapPeriods }}期：</span>
                                        <span class="item-value"> <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ totalDataGapCrystal }}</span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="dataGapCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 狂厄特训 -->
                            <div class="sub-section">
                                <h3 class="sub-title">狂厄特训</h3>
                                <div style="font-size: 12px; color: #666; margin-top: 5px; font-style: italic;">
                                    &nbsp;&nbsp;无准确排期，仅显示本期<br>
                                    &nbsp;
                                </div>
                                <div class="training-buttons">
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: trainingModes.steady }"
                                        @click="toggleTrainingMode('steady')">
                                        平稳<img :src="crystalIcon" class="resource-icon" alt="异方晶">100<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                    </button>
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: trainingModes.fluctuating }"
                                        @click="toggleTrainingMode('fluctuating')">
                                        波动<img :src="crystalIcon" class="resource-icon" alt="异方晶">200<img :src="ticketIcon" class="resource-icon" alt="搜索令">2
                                    </button>
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: trainingModes.outOfControl }"
                                        @click="toggleTrainingMode('outOfControl')">
                                        失控<img :src="crystalIcon" class="resource-icon" alt="异方晶">200
                                    </button>
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: trainingModes.crazy }"
                                        @click="toggleTrainingMode('crazy')">
                                        疯狂<img :src="crystalIcon" class="resource-icon" alt="异方晶">60
                                    </button>
                                </div>
                            </div>

                            <!-- 无尽梦魇-更替 -->
                            <div class="sub-section">
                                <h3 class="sub-title">无尽梦魇-更替</h3>
                                <div style="font-size: 12px; color: #666; margin-top: 5px; font-style: italic;">
                                    &nbsp;&nbsp;无准确排期，仅显示本期<br>
                                </div>
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">祸海之厄：</span>
                                        <span class="item-value"> <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ nightmareSeaReward }}</span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="nightmareSeaCompleted">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 潜在资源 -->
                    <div class="potential-section card">
                        <h2 @click="toggleSection('potential')" class="section-header">
                            🔮 潜在资源（常驻）
                            <span class="collapse-icon">{{ sections.potential ? '−' : '+' }}</span>
                        </h2>
                        <!-- 子模块 -->
                        <div v-if="sections.potential" class="section-content">
                            <!-- 狄斯城（主线） -->
                            <div class="sub-section">
                                <h3 class="sub-title">狄斯城（主线）</h3>
                                <div class="main-story-buttons">
                                    <div class="main-story-columns">
                                        <!-- 主线左侧按钮 -->
                                        <div class="main-story-column">
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.chaosBeyondA }"
                                                @click="toggleMainStory('chaosBeyondA')">
                                                01混沌彼岸A<img :src="crystalIcon" class="resource-icon" alt="异方晶">995<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.chaosBeyondB }"
                                                @click="toggleMainStory('chaosBeyondB')">
                                                02混沌彼岸B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1230<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.unownedCavernA }"
                                                @click="toggleMainStory('unownedCavernA')">
                                                03无主地窟A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1175<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.unownedCavernB }"
                                                @click="toggleMainStory('unownedCavernB')">
                                                04无主地窟B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1280<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.kiranSquareA }"
                                                @click="toggleMainStory('kiranSquareA')">
                                                05奇兰广场A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1265<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.kiranSquareB }"
                                                @click="toggleMainStory('kiranSquareB')">
                                                06奇兰广场B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1230<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.carnivalA }"
                                                @click="toggleMainStory('carnivalA')">
                                                07嘉年华A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1230<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.carnivalB }"
                                                @click="toggleMainStory('carnivalB')">
                                                08嘉年华B<img :src="crystalIcon" class="resource-icon" alt="异方晶">935<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.refugeeCampA }"
                                                @click="toggleMainStory('refugeeCampA')">
                                                09流民寨A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1125<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                        </div>
                                        <!-- 主线右侧按钮 -->
                                        <div class="main-story-column">
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.refugeeCampB }"
                                                @click="toggleMainStory('refugeeCampB')">
                                                10流民寨B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1195<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.muddyDarkTrapA }"
                                                @click="toggleMainStory('muddyDarkTrapA')">
                                                11沉浊暗阱A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1230<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.muddyDarkTrapB }"
                                                @click="toggleMainStory('muddyDarkTrapB')">
                                                12沉浊暗阱B<img :src="crystalIcon" class="resource-icon" alt="异方晶">605<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.highTowerBlackRing }"
                                                @click="toggleMainStory('highTowerBlackRing')">
                                                13高塔黑环<img :src="crystalIcon" class="resource-icon" alt="异方晶">1980<img :src="ticketIcon" class="resource-icon" alt="搜索令">2
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.darkSurgeA }"
                                                @click="toggleMainStory('darkSurgeA')">
                                                N1暗涌A<img :src="crystalIcon" class="resource-icon" alt="异方晶">1005<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.darkSurgeB }"
                                                @click="toggleMainStory('darkSurgeB')">
                                                N2暗涌B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1005<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.goldFeastA }"
                                                @click="toggleMainStory('goldFeastA')">
                                                N3碎金盛宴A<img :src="crystalIcon" class="resource-icon" alt="异方晶">900<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.goldFeastB }"
                                                @click="toggleMainStory('goldFeastB')">
                                                N4碎金盛宴B<img :src="crystalIcon" class="resource-icon" alt="异方晶">1180<img :src="ticketIcon" class="resource-icon" alt="搜索令">1
                                            </button>
                                            <button 
                                                class="main-story-btn" 
                                                :class="{ active: mainStory.canFeng }"
                                                @click="toggleMainStory('canFeng')">
                                                残锋<img :src="crystalIcon" class="resource-icon" alt="异方晶">960
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 行动纪要 -->
                            <div class="sub-section">
                                <h3 class="sub-title">行动纪要</h3>
                                <div class="action-summary">
                                    <div class="summary-header action-summary-header">
                                        <div class="summary-header-inner">
                                            <span class="summary-text action-summary-text">
                                                {{ actionSummaryText }}
                                            </span>
                                            <span class="summary-crystal action-summary-crystal">
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ actionSummaryCrystal }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="slider-container">
                                        <input 
                                            type="range" 
                                            v-model.number="actionSummaryLevel" 
                                            min="0" 
                                            max="19"
                                            step="1"
                                            class="score-slider"
                                        >
                                        <div class="slider-value">
                                            当前状态: {{ actionSummaryText }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 零镜系统（世界观） -->
                            <div class="sub-section">
                                <h3 class="sub-title">零镜系统（世界观）</h3>
                                <div class="zero-mirror-buttons">
                                    <div class="zero-mirror-columns">
                                        <!-- 世界观左侧按钮 -->
                                        <div class="zero-mirror-column">
                                            <!-- 入夜纪年 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.nightChronicle }"
                                                @click="toggleZeroMirror('nightChronicle')">
                                                入夜纪年<img :src="crystalIcon" class="resource-icon" alt="异方晶">200
                                            </button>
                                            
                                            <!-- 狄斯城 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.disCity }"
                                                @click="toggleZeroMirror('disCity')">
                                                狄斯城<img :src="crystalIcon" class="resource-icon" alt="异方晶">20
                                            </button>
                                            
                                            <!-- 辛迪加 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.syndicate }"
                                                @click="toggleZeroMirror('syndicate')">
                                                辛迪加<img :src="crystalIcon" class="resource-icon" alt="异方晶">180
                                            </button>
                                            
                                            <!-- 新城 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.newCity }"
                                                @click="toggleZeroMirror('newCity')">
                                                新城<img :src="crystalIcon" class="resource-icon" alt="异方晶">80
                                            </button>
                                            
                                            <!-- 锈河 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.rustRiver }"
                                                @click="toggleZeroMirror('rustRiver')">
                                                锈河<img :src="crystalIcon" class="resource-icon" alt="异方晶">60
                                            </button>
                                        </div>
                                        <!-- 世界观右侧按钮 -->
                                        <div class="zero-mirror-column">
                                            <!-- 外邦 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.foreignLand }"
                                                @click="toggleZeroMirror('foreignLand')">
                                                外邦<img :src="crystalIcon" class="resource-icon" alt="异方晶">120
                                            </button>
                                            
                                            <!-- 内海 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.innerSea }"
                                                @click="toggleZeroMirror('innerSea')">
                                                内海<img :src="crystalIcon" class="resource-icon" alt="异方晶">80
                                            </button>
                                            
                                            <!-- 上庭 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.upperCourt }"
                                                @click="toggleZeroMirror('upperCourt')">
                                                上庭<img :src="crystalIcon" class="resource-icon" alt="异方晶">0
                                            </button>
                                            
                                            <!-- 狂厄 -->
                                            <button 
                                                class="zero-mirror-btn" 
                                                :class="{ active: zeroMirror.madEvil }"
                                                @click="toggleZeroMirror('madEvil')">
                                                狂厄<img :src="crystalIcon" class="resource-icon" alt="异方晶">320
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 常驻活动 -->
                            <div class="sub-section">
                                <h3 class="sub-title">常驻活动</h3>
                                <div class="permanent-activity">
                                    <!-- 记忆复现 -->
                                    <div class="summary-header" style="background: #2a2a2a; padding: 12px 15px; border-radius: 8px; border: 1px solid #e1e5e9; margin-bottom: 15px;">
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <span class="summary-text" style="font-size: 16px; font-weight: bold; color: #FF4500; flex: 1;">
                                                记忆复现
                                            </span>
                                            <span class="summary-crystal" style="font-size: 14px; font-weight: bold; color: #1890ff; white-space: nowrap;">
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ memoryReviewCrystal }}
                                            </span>
                                        </div>
                                    </div>                                    
                                    <!-- 弥合阈值滑块 -->
                                    <div class="slider-container" style="margin-top: 15px;">
                                        <div class="slider-labels">
                                            <span>0</span>
                                            <span>10000</span>
                                        </div>
                                        <input 
                                            type="range" 
                                            v-model.number="memoryReviewThreshold" 
                                            min="0" 
                                            max="10000"
                                            step="1000"
                                            class="score-slider"
                                        >
                                        <div class="slider-value">
                                            弥合阈值: {{ memoryReviewThreshold }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 旧案归档处 -->
                            <div class="sub-section">
                                <h3 class="sub-title">旧案归档处</h3>
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">未兑换搜索令：</span>
                                        <span class="item-value"> <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ oldCaseArchiveTickets }}</span>
                                    </div>
                                    <div class="certification-controls">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <input 
                                                type="number" 
                                                v-model.number="oldCaseArchiveCount" 
                                                placeholder="0" 
                                                min="0" 
                                                step="1" 
                                                @input="validateOldCaseArchiveInput"
                                                @focus="oldCaseArchiveCount = clearIfZero(oldCaseArchiveCount)"
                                                @blur="oldCaseArchiveCount = setDefaultIfEmpty(oldCaseArchiveCount)"
                                                style="width: 70px; padding: 8px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 狄斯暗影（EX） -->
                            <div class="sub-section">
                                <h3 class="sub-title">狄斯暗影（EX）</h3>
                                <div class="ex-buttons">
                                    <div class="ex-columns">
                                        <!-- EX左侧按钮 -->
                                        <div class="ex-column">
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.chaosBeyond }"
                                                @click="toggleDarkShadowEx('chaosBeyond')">
                                                EX01混沌彼岸·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">720
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.unownedCavern }"
                                                @click="toggleDarkShadowEx('unownedCavern')">
                                                EX02无主地窟·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">720
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.kiranSquare }"
                                                @click="toggleDarkShadowEx('kiranSquare')">
                                                EX03奇兰广场·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">590
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.carnival }"
                                                @click="toggleDarkShadowEx('carnival')">
                                                EX04嘉年华·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">650
                                            </button>
                                        </div>
                                        <!-- EX右侧按钮 -->
                                        <div class="ex-column">
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.highTowerBlackRing }"
                                                @click="toggleDarkShadowEx('highTowerBlackRing')">
                                                EX05高塔黑环·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">650
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.luxuryFeastFog }"
                                                @click="toggleDarkShadowEx('luxuryFeastFog')">
                                                EX06奢宴浓雾·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">650
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.drowningRainCity }"
                                                @click="toggleDarkShadowEx('drowningRainCity')">
                                                EX07溺雨垂城·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">650
                                            </button>
                                            <button 
                                                class="ex-btn" 
                                                :class="{ active: darkShadowEx.goldFeast }"
                                                @click="toggleDarkShadowEx('goldFeast')">
                                                EX08碎金盛宴·暗影<img :src="crystalIcon" class="resource-icon" alt="异方晶">650
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 记忆风暴 -->
                            <div class="sub-section">
                                <h3 class="sub-title">记忆风暴</h3>
                                <div class="memory-storm-buttons">
                                    <button 
                                        class="memory-storm-btn" 
                                        :class="{ active: memoryStorm.memoryAnomaly }"
                                        @click="toggleMemoryStorm('memoryAnomaly')">
                                        记忆畸点<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                    <button 
                                        class="memory-storm-btn" 
                                        :class="{ active: memoryStorm.impressionAnomaly }"
                                        @click="toggleMemoryStorm('impressionAnomaly')">
                                        印象畸点<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                    <button 
                                        class="memory-storm-btn" 
                                        :class="{ active: memoryStorm.echoAnomaly }"
                                        @click="toggleMemoryStorm('echoAnomaly')">
                                        残响畸点<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                </div>
                            </div>

                            <!-- 污染之巢 -->
                            <div class="sub-section">
                                <h3 class="sub-title">污染之巢</h3>
                                <div class="pollution-nest-buttons">
                                    <button 
                                        class="pollution-nest-btn" 
                                        :class="{ active: pollutionNest.forbiddenZoneProbe }"
                                        @click="togglePollutionNest('forbiddenZoneProbe')">
                                        禁区探查<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                    <button 
                                        class="pollution-nest-btn" 
                                        :class="{ active: pollutionNest.extremeDomainSearch }"
                                        @click="togglePollutionNest('extremeDomainSearch')">
                                        极域搜寻<img :src="crystalIcon" class="resource-icon" alt="异方晶">210
                                    </button>
                                </div>
                            </div>

                            <!-- 清剿行动 -->
                            <div class="sub-section">
                                <h3 class="sub-title">清剿行动</h3>
                                <div class="cleanup-operation-buttons">
                                    <button 
                                        class="cleanup-operation-btn" 
                                        :class="{ active: cleanupOperation.goldRush }"
                                        @click="toggleCleanupOperation('goldRush')">
                                        淘金狂热<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                    <button 
                                        class="cleanup-operation-btn" 
                                        :class="{ active: cleanupOperation.ominousSeed }"
                                        @click="toggleCleanupOperation('ominousSeed')">
                                        恶兆之种<img :src="crystalIcon" class="resource-icon" alt="异方晶">350
                                    </button>
                                </div>
                            </div>

                            <!-- 帕尔马废墟 -->
                            <div class="sub-section">
                                <h3 class="sub-title">帕尔马废墟</h3>
                                <div class="palma-ruins-buttons">
                                    <div class="palma-ruins-row">
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.tenacious }"
                                            @click="togglePalmaRuins('tenacious')">
                                            坚韧<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.berserk }"
                                            @click="togglePalmaRuins('berserk')">
                                            狂暴<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                    </div>
                                    <div class="palma-ruins-row">
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.mysterious }"
                                            @click="togglePalmaRuins('mysterious')">
                                            诡秘<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.precise }"
                                            @click="togglePalmaRuins('precise')">
                                            精准<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                    </div>
                                    <div class="palma-ruins-row">
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.supernatural }"
                                            @click="togglePalmaRuins('supernatural')">
                                            异能<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                        <button 
                                            class="palma-ruins-btn" 
                                            :class="{ active: palmaRuins.inspiration }"
                                            @click="togglePalmaRuins('inspiration')">
                                            启迪<img :src="crystalIcon" class="resource-icon" alt="异方晶">280
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 派遣声望 -->
                            <div class="sub-section">
                                <h3 class="sub-title">派遣声望</h3>
                                <div class="dispatch-reputation">
                                    <!-- 按钮区域 -->
                                    <div class="dispatch-buttons">
                                        <div class="dispatch-columns">
                                            <div class="dispatch-column">
                                                <button 
                                                    class="dispatch-btn" 
                                                    :class="{ active: selectedDispatchArea === 'syndicate' }"
                                                    @click="selectDispatchArea('syndicate')">
                                                    辛迪加<img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dispatchReputation.syndicate.crystal }}
                                                </button>
                                                <button 
                                                    class="dispatch-btn" 
                                                    :class="{ active: selectedDispatchArea === 'newCity' }"
                                                    @click="selectDispatchArea('newCity')">
                                                    新城<img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dispatchReputation.newCity.crystal }}
                                                </button>
                                            </div>
                                            <div class="dispatch-column">
                                                <button 
                                                    class="dispatch-btn" 
                                                    :class="{ active: selectedDispatchArea === 'innerBay' }"
                                                    @click="selectDispatchArea('innerBay')">
                                                    里湾<img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dispatchReputation.innerBay.crystal }}
                                                </button>
                                                <button 
                                                    class="dispatch-btn" 
                                                    :class="{ active: selectedDispatchArea === 'sandSea' }"
                                                    @click="selectDispatchArea('sandSea')">
                                                    砂海<img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dispatchReputation.sandSea.crystal }}
                                                </button>
                                            </div>
                                        </div>
                                    </div>                                    
                                    <!-- 滑块区域 -->
                                    <div class="slider-container" style="margin-top: 15px;">
                                        <div class="slider-labels">
                                            <span>0</span>
                                            <span>10000</span>
                                        </div>
                                        <input 
                                            type="range" 
                                            v-model.number="dispatchReputation[selectedDispatchArea].level" 
                                            min="0" 
                                            max="10000"
                                            step="1000"
                                            class="score-slider"
                                            list="dispatch-levels"
                                            @input="snapDispatchLevel"
                                        >
                                        <datalist id="dispatch-levels">
                                            <option value="0">0</option>
                                            <option value="1000">1000</option>
                                            <option value="3000">3000</option>
                                            <option value="6000">6000</option>
                                            <option value="10000">10000</option>
                                        </datalist>
                                        <div class="slider-value">
                                            {{ getDispatchAreaName(selectedDispatchArea) }}声望: {{ dispatchReputation[selectedDispatchArea].level }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 角色养成 -->
                            <div class="sub-section">
                                <h3 class="sub-title">角色养成</h3>
                                <!-- 3阶 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未3阶角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.tier3 * 180 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.tier3" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('tier3')" @focus="clearCharacterDevIfZero('tier3')" @blur="setCharacterDevDefaultIfEmpty('tier3')">
                                    </div>
                                </div>
                                <!-- 混响·狂 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未满混响狂级角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.maxReverbS * 210 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.maxReverbS" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('maxReverbS')" @focus="clearCharacterDevIfZero('maxReverbS')" @blur="setCharacterDevDefaultIfEmpty('maxReverbS')">
                                    </div>
                                </div>
                                <!-- 混响·危 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未满混响危级角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.maxReverbA * 60 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.maxReverbA" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('maxReverbA')" @focus="clearCharacterDevIfZero('maxReverbA')" @blur="setCharacterDevDefaultIfEmpty('maxReverbA')">
                                    </div>
                                </div>
                                <!-- 混响·普 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未满混响普级角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.maxReverbB * 20 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.maxReverbB" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('maxReverbB')" @focus="clearCharacterDevIfZero('maxReverbB')" @blur="setCharacterDevDefaultIfEmpty('maxReverbB')">
                                    </div>
                                </div>
                                <!-- 审查·狂 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未审查狂级角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.reviewS * 200 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.reviewS" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('reviewS')" @focus="clearCharacterDevIfZero('reviewS')" @blur="setCharacterDevDefaultIfEmpty('reviewS')">
                                    </div>
                                </div>
                                <!-- 审查·危 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未审查危级角色数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ characterDevelopment.reviewA * 150 }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="characterDevelopment.reviewA" placeholder="0" min="0" step="1" @input="validateCharacterDevInput('reviewA')" @focus="clearCharacterDevIfZero('reviewA')" @blur="setCharacterDevDefaultIfEmpty('reviewA')">
                                    </div>
                                </div>
                                <!-- 审查·海拉 -->                                
                                <button 
                                    class="character-development-btn" 
                                    :class="{ active: characterDevelopment.haylaReviewed }"
                                    @click="toggleHaylaReview">
                                    {{ characterDevelopment.haylaReviewed ? '已审查海拉！' : '未审查海拉！' }}
                                </button>
                            </div>

                            <!-- 梦境&人格色谱 -->
                            <div class="sub-section">
                                <h3 class="sub-title">梦境&人格色谱</h3>                                
                                <!-- 窥心 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未完成窥心数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dreamInsightCrystal }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="dreamInsightCount" placeholder="0" min="0" step="1" @input="validateDreamInput('dreamInsightCount')" @focus="clearDreamIfZero('dreamInsightCount')" @blur="setDreamDefaultIfEmpty('dreamInsightCount')">
                                    </div>
                                </div>
                                <!-- 溯时 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未完成溯时数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ dreamRetrospectCrystal }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="dreamRetrospectCount" placeholder="0" min="0" step="1" @input="validateDreamInput('dreamRetrospectCount')" @focus="clearDreamIfZero('dreamRetrospectCount')" @blur="setDreamDefaultIfEmpty('dreamRetrospectCount')">
                                    </div>
                                </div>
                                <!-- 人格色谱 -->
                                <div class="character-development-input">
                                    <span class="character-development-label">
                                        未完成人格色谱数量：
                                        <span class="character-development-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ personalitySpectrumCrystal }}
                                        </span>
                                    </span>
                                    <div class="character-development-controls">
                                        <input type="number" v-model.number="personalitySpectrumCount" placeholder="0" min="0" step="1" @input="validateDreamInput('personalitySpectrumCount')" @focus="clearDreamIfZero('personalitySpectrumCount')" @blur="setDreamDefaultIfEmpty('personalitySpectrumCount')">
                                    </div>
                                </div>
                            </div>

                            <!-- 无尽梦魇-常驻 -->
                            <div class="sub-section">
                                <h3 class="sub-title">无尽梦魇-常驻</h3>                                
                                <!-- 积分奖励 -->
                                <div class="nightmare-score">
                                    <h4 class="score-title">
                                        积分奖励 
                                        <span style="font-size: 14px; font-weight: normal; margin-left: 10px;">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ nightmareRemainingCrystal }} 
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ nightmareRemainingTickets }}
                                        </span>
                                    </h4>
                                    <div class="slider-container">
                                        <div class="slider-labels">
                                            <span>0</span>
                                            <span>60000</span>
                                        </div>
                                        <input 
                                            type="range" 
                                            v-model.number="nightmareScore" 
                                            min="0" 
                                            max="60000" 
                                            step="1000"
                                            class="score-slider"
                                        >
                                        <div class="slider-value">
                                            当前积分: {{ nightmareScore }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 灰烬之潮-重塑 -->
                            <div class="sub-section">
                                <h3 class="sub-title">灰烬之潮-重塑</h3>
                                <div class="training-buttons">
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: ashTide.ashApostle }"
                                        @click="toggleAshTide('ashApostle')">
                                        灰烬使徒<img :src="crystalIcon" class="resource-icon" alt="异方晶">180
                                    </button>
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: ashTide.disasterLocust }"
                                        @click="toggleAshTide('disasterLocust')">
                                        灾蝗使徒<img :src="crystalIcon" class="resource-icon" alt="异方晶">180
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 活动（估算） -->
                    <div class="potential-section card">
                        <h2 @click="toggleSection('activities')" class="section-header">
                            🎯 活动资源（⚠️估算）
                            <span class="collapse-icon">{{ sections.activities ? '−' : '+' }}</span>
                        </h2>
                        <div v-if="sections.activities" class="section-content">
                            <!-- 活动说明 -->
                            <div style="font-size: 12px; color: #666; margin-top: 5px; font-style: italic;">
                                &nbsp;&nbsp;无准确排期，仅估算活动与复刻奖励，可自行增减<br>
                            </div>

                            <!-- 动态活动模块 -->
                            <div v-for="activity in displayActivities" :key="activity.title" class="sub-section">
                                <h3 class="sub-title">{{ activity.title }}</h3>
                                <!-- 本期活动 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">活动奖励：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ activityCompleted[activity.title] ? 0 : (activity.title === '妄夜迷章' ? 1070 : (activity.title === '歧行至破晓（⚠️估算）' ? 2000 : 1000)) }}
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> 
                                            {{ activityCompleted[activity.title] ? 0 : (activity.title === '歧行至破晓（⚠️估算）' ? 5 : 3) }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activityCompleted[activity.title]"
                                                @change="toggleActivityCompletion(activity.title)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>
                                
                                <!-- 绝密行动奖励（仅限歧行至破晓） -->
                                <div class="accumulation-item" v-if="activity.title === '歧行至破晓（⚠️估算）'">
                                    <div class="item-info">
                                        <span class="item-title">绝密行动：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ activitySecretOperationCompleted[activity.title] ? 0 : 300 }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activitySecretOperationCompleted[activity.title]"
                                                @change="toggleActivitySecretOperationCompletion(activity.title)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>

                                <!-- 公会战奖励（仅限歧行至破晓） -->
                                <div class="accumulation-item" v-if="activity.title === '歧行至破晓（⚠️估算）'">
                                    <div class="item-info">
                                        <span class="item-title">公会战奖励：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ activityGuildWarCompleted[activity.title] ? 0 : 1100 }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activityGuildWarCompleted[activity.title]"
                                                @change="toggleActivityGuildWarCompletion(activity.title)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>

                                <!-- 复刻活动 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">{{ activity.title === '妄夜迷章' ? '无匪之地' : '复刻活动' }}：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ !activityRerunMode[activity.title] ? (activity.title === '妄夜迷章' ? 660 : 600) : 0 }}
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> 
                                            {{ !activityRerunMode[activity.title] ? 1 : 0 }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activityRerunMode[activity.title]">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>

                                <!-- 诡境余音 -->
                                <div class="accumulation-item" v-if="activity.title === '妄夜迷章'">
                                    <div class="item-info">
                                        <span class="item-title">诡境余音：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ !remainingEchoActive ? 900 : 0 }}
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ !remainingEchoActive ? 1 : 0 }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="remainingEchoActive">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>

                                <!-- 碎晶之梦 -->
                                <div class="accumulation-item" v-if="activity.title === '妄夜迷章'">
                                    <div class="item-info">
                                        <span class="item-title">碎晶之梦：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ !crystalDreamActive ? 360 : 0 }}
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ !crystalDreamActive ? 1 : 0 }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="crystalDreamActive">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>

                                <!-- 审查奖励 -->
                                <div class="accumulation-item">                            
                                    <div class="item-info">
                                        <span class="item-title">审查奖励：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ activityReviewCompleted[activity.title] ? 0 : (activity.title === '新年活动（⚠️估算）' ? 550 : 350) }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activityReviewCompleted[activity.title]"
                                                @change="toggleActivityReviewCompletion(activity.title)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>
                                <!-- 试用奖励 -->
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">角色试用：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶"> 
                                            {{ activityTrialCompleted[activity.title] ? 0 : (activity.title === '歧行至破晓（⚠️估算）' || activity.title === '新年活动（⚠️估算）' ? 70 : 40) }}
                                        </span>
                                    </div>
                                    <div class="switch-group small">
                                        <label class="switch">
                                            <input type="checkbox" v-model="activityTrialCompleted[activity.title]"
                                                @change="toggleActivityTrialCompletion(activity.title)">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label">本期已完成</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 氪金资源 -->
                    <div class="potential-section card">
                        <h2 @click="toggleSection('recharge')" class="section-header">
                            💰 氪金资源
                            <span class="collapse-icon">{{ sections.recharge ? '−' : '+' }}</span>
                        </h2>
                        <div v-if="sections.recharge" class="section-content">
                            <!-- 氪金说明 -->
                            <div class="explanation-row" style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px; padding: 10px; border-radius: 6px; border: 1px solid #444444;">
                                <span class="explanation-text" style="font-size: 13px;">标签内数字为每抽价格，例：
                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                    2.57
                                </span>
                                    &nbsp;&nbsp;表示为每抽2.57元</span>
                            </div>

                            <!-- 黑钥贵宾 -->
                            <div class="sub-section">
                                <h3 class="sub-title" style="display: flex; align-items: center; gap: 10px;">
                                    <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                        2.57
                                    </span>
                                    黑钥贵宾（小月卡）
                                </h3>
                                
                                <div class="resource-input-vertical" style="margin-bottom: 15px;">
                                    <label style="min-width: 200px; display: flex; align-items: center; gap: 5px;">
                                        额外购买
                                        <button class="skin-btn" @click="adjustMonthlyCard(-1)">−</button>
                                        <span class="skin-count" style="min-width: 40px; text-align: center;">{{ monthlyCardCount }}</span>
                                        <button class="skin-btn" @click="adjustMonthlyCard(1)">+</button>
                                        张月卡(负数代表已提前购买)：
                                    </label>
                                </div>
                                
                                <div style="font-size: 12px; color: #666; margin-bottom: 15px;">
                                    额外购买一张月卡可提前拿到300璀璨晶源，已提前购买则只能拿到每日60异方晶，不计算30RMB
                                </div>
                                
                                <!-- 月卡奖励按钮 -->
                                <button 
                                    class="training-btn" 
                                    :class="{ active: monthlyCardActive }"
                                    @click="toggleMonthlyCard"
                                    style="width: calc(100% - 30px); margin: 0 auto 15px; display: block;">
                                    黑钥贵宾 
                                    <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源"> {{ monthlyCardPremiumCrystal }} 
                                    <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ monthlyCardCrystal }}
                                </button>
                            </div>

                            <!-- 高级监察密令 -->
                            <div class="sub-section">
                                <h3 class="sub-title" style="display: flex; align-items: center; gap: 10px;">
                                    <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                        6.24
                                    </span>
                                    高级监察密令（大月卡）
                                </h3>
                                <!-- 高级监察密令期数 -->
                                <div class="inspection-order-buttons">
                                    <div v-for="period in inspectionPeriods" :key="period.id" class="inspection-period-btn-wrapper">
                                        <button 
                                            class="inspection-period-btn" 
                                            :class="{ active: (rechargeInspectionLevels[period.id] || 0) > 0 }"
                                            @click="selectRechargeInspectionPeriod(period.id)">
                                            {{ period.startDate }}到{{ period.endDate }} 
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">{{ calculateRechargePeriodCrystal(rechargeInspectionLevels[period.id] || 0) }}
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">{{ calculateRechargePeriodTickets(rechargeInspectionLevels[period.id] || 0) }}
                                        </button>
                                    </div>
                                </div>                                
                                <!-- 高级监察密令滑块容器 -->
                                <div class="inspection-slider-container" v-if="selectedRechargeInspectionPeriod">
                                    <div class="slider-labels">
                                        <span>0级</span>
                                        <span>55级</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        v-model.number="rechargeInspectionLevels[selectedRechargeInspectionPeriod]" 
                                        min="0" 
                                        max="55"
                                        step="1"
                                        class="inspection-slider"
                                        @input="snapRechargeInspectionLevel(selectedRechargeInspectionPeriod)"
                                    >
                                    <div class="slider-value">
                                        {{ getSelectedRechargePeriodText() }} 当前等级: {{ rechargeInspectionLevels[selectedRechargeInspectionPeriod] || 0 }}
                                    </div>
                                </div>
                            </div>

                            <!-- 狄斯盈满钵 -->
                            <div class="sub-section">
                                <h3 class="sub-title" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                            1.64
                                        </span>
                                        <span>狄斯盈满钵</span>
                                    </div>
                                    <div class="switch-group" style="margin: 0;">
                                        <span class="switch-label" :class="{ active: !disiPrePurchased, inactive: disiPrePurchased }">未预先购买</span>
                                        <label class="switch">
                                            <input type="checkbox" v-model="disiPrePurchased" :disabled="!disiActive">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label" :class="{ active: disiPrePurchased, inactive: !disiPrePurchased }">已预先购买</span>
                                    </div>
                                </h3>
                                
                                <button 
                                    class="training-btn" 
                                    :class="{ active: disiActive }"
                                    @click="toggleDisi"
                                    style="width: calc(100% - 30px); margin: 0 auto 15px; display: block;">
                                    狄斯盈满钵
                                    <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源"> {{ disiPremiumCrystal }} 
                                    <img :src="crystalIcon" class="resource-icon" alt="异方晶"> {{ disiRewardTotal }}
                                </button>
                                
                                <div class="slider-container">
                                    <div class="slider-labels">
                                        <span>0级</span>
                                        <span>50级</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        v-model.number="disiLevel" 
                                        min="0" 
                                        max="50"
                                        step="1"
                                        class="inspection-slider"
                                        list="disi-levels"
                                        @input="snapDisiLevel"
                                        :disabled="!disiActive"
                                    >
                                    <datalist id="disi-levels">
                                        <option value="0">0</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                        <option value="15">15</option>
                                        <option value="20">20</option>
                                        <option value="25">25</option>
                                        <option value="30">30</option>
                                        <option value="35">35</option>
                                        <option value="40">40</option>
                                        <option value="42">42</option>
                                        <option value="44">44</option>
                                        <option value="46">46</option>
                                        <option value="48">48</option>
                                        <option value="50">50</option>
                                    </datalist>
                                    <div class="slider-value">
                                        当前等级: {{ disiLevel }}
                                    </div>
                                </div>
                            </div>

                            <!-- 诡珑珍宝馆 -->
                            <div class="sub-section">
                                <h3 class="sub-title" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                            8.8
                                        </span>
                                        <span>诡珑珍宝馆</span>
                                    </div>
                                    <div class="switch-group" style="margin: 0;">
                                        <span class="switch-label" :class="{ active: !treasurePrePurchased, inactive: treasurePrePurchased }">未预先购买</span>
                                        <label class="switch">
                                            <input type="checkbox" v-model="treasurePrePurchased" :disabled="!treasureActive">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label" :class="{ active: treasurePrePurchased, inactive: !treasurePrePurchased }">已预先购买</span>
                                    </div>
                                </h3>
                                
                                <button 
                                    class="training-btn" 
                                    :class="{ active: treasureActive }"
                                    @click="toggleTreasure"
                                    style="width: calc(100% - 30px); margin: 0 auto 15px; display: block;">
                                    诡珑珍宝馆 
                                    <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ treasureTickets }}
                                </button>
                            </div>

                            <!-- 特惠时尚巡回庆典 -->
                            <div class="sub-section">
                                <h3 class="sub-title" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                            6.21
                                        </span>
                                        <span>特惠时尚巡回庆典</span>
                                    </div>
                                    <!-- 新增预购买开关 -->
                                    <div class="switch-group" style="margin: 0;">
                                        <label class="switch">
                                            <input type="checkbox" v-model="specialFashionTour.prePurchased" :disabled="!specialFashionTour.active">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label" :class="{ active: specialFashionTour.prePurchased, inactive: !specialFashionTour.prePurchased }">已预先购买</span>
                                    </div>
                                </h3>
                                
                                <!-- 按钮和优惠次数调节在同一行 -->
                                <div style="display: flex; align-items: center; gap: 15px; width: 100%; margin: 0 0 15px 0;">
                                    <button 
                                        class="training-btn" 
                                        :class="{ active: specialFashionTour.active }"
                                        @click="toggleSpecialFashionTour"
                                        style="flex: 1; min-width: 0;">
                                        时尚巡回庆典 
                                        <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源"> {{ specialFashionTourPremiumCrystal }} 
                                        <img :src="ticketIcon" class="resource-icon" alt="搜索令"> {{ specialFashionTourTickets }}
                                    </button>
                                    
                                    <!-- 优惠次数调节在按钮右侧 -->
                                    <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
                                        <span style="font-size: 12px; color: #CCCCCC; white-space: nowrap;">优惠:</span>
                                        <input 
                                            type="number" 
                                            v-model.number="specialFashionTour.maxDiscounts" 
                                            @input="validateDiscountCount"
                                            @focus="clearDiscountIfZero"
                                            @blur="setDiscountDefaultIfEmpty"
                                            min="0" 
                                            max="4"
                                            style="width: 35px; padding: 4px; border: 1px solid #555555; border-radius: 4px; text-align: center; background: #333333; color: #FFFFFF; font-size: 14px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);">
                                        <span style="font-size: 11px; color: #999; white-space: nowrap;">次</span>
                                    </div>
                                </div>

                                <!-- 优惠使用情况和搜索令开关在同一行 -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; width: 100%;">
                                    <!-- 左侧：优惠使用情况（与按钮左对齐） -->
                                    <div style="font-size: 12px; color: #666;">
                                        优惠最多4次，已用{{ specialFashionTour.usedDiscounts }}次，剩余{{ remainingDiscounts }}次
                                    </div>
                                    
                                    <!-- 右侧：搜索令本周已领取开关 -->
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <label class="switch">
                                            <input type="checkbox" v-model="specialFashionTour.completed" :disabled="!specialFashionTour.active">
                                            <span class="slider"></span>
                                        </label>
                                        <span class="switch-label" :class="{ active: specialFashionTour.completed, inactive: !specialFashionTour.completed }">
                                            搜索令本周已领取
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- 晶源特供（首充） -->
                            <div class="sub-section">
                                <h3 class="sub-title">晶源特供（首充）</h3>
                                <div class="crystal-supply-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div v-for="(button, index) in crystalSupplyButtons" :key="index" 
                                        class="crystal-supply-btn-wrapper">
                                        <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                            <button 
                                                class="training-btn crystal-supply-btn" 
                                                :class="{ active: button.purchased }"
                                                @click="toggleCrystalSupplyButton(index)"
                                                style="display: flex; justify-content: space-between; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                                <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 0;">
                                                    <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                        {{ crystalSupplyUnitPrices[index] }}
                                                    </span>
                                                </div>
                                                <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0;">
                                                    <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                    <span style="margin-right: 5px; font-weight: bold; white-space: nowrap;">{{ button.premiumCrystal }}</span>
                                                </div>
                                            </button>
                                            <!-- 价格显示 -->
                                            <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                                <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                    ￥{{ button.price }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 晶源特供（非首充） -->
                            <div class="sub-section">
                                <h3 class="sub-title">晶源特供（非首充）</h3>
                                <div class="crystal-supply-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div v-for="(button, index) in nonFirstCrystalSupplyButtons" :key="index" 
                                        class="crystal-supply-btn-wrapper">
                                        <div style="display: flex; align-items: center; gap: 8px;max-width: 100%;box-sizing: border-box;">
                                            <button 
                                                class="training-btn crystal-supply-btn" 
                                                :class="{ active: (button.count !== null && button.count !== '' && button.count > 0) }"
                                                style="display: flex; justify-content: space-between; align-items: center; padding: 12px 8px; flex: 1;">
                                                <div class="crystal-supply-left" style="display: flex; align-items: center;">
                                                    <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                                                        {{ nonFirstCrystalSupplyUnitPrices[index] }}
                                                    </span>
                                                </div>
                                                <div class="crystal-supply-right" style="display: flex; align-items: center;">
                                                    <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                    <span style="margin-right: 5px; font-weight: bold;">{{ button.premiumCrystal }}</span>
                                                </div>
                                            </button>
                                            <!-- 输入框 -->
                                            <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                                <input 
                                                    type="number" 
                                                    v-model.number="button.count" 
                                                    placeholder="0" 
                                                    min="0" 
                                                    step="1" 
                                                    @input="validateNonFirstCrystalSupplyInput(index)"
                                                    @focus="clearNonFirstCrystalSupplyIfZero(index)"
                                                    @blur="setNonFirstCrystalSupplyDefaultIfEmpty(index)"
                                                    style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                                <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px;">
                                                    ￥{{ button.price }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 常驻礼包 -->
                            <div class="sub-section">
                                <h3 class="sub-title">常驻礼包</h3>
                                <!-- 新人追踪礼包 === -->                                
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: permanentPackage.active && permanentPackage.price > 0 }"
                                        @click="togglePermanentPackage"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ (permanentPackage.price / ((permanentPackage.premiumCrystal + permanentPackage.tickets * 180) / 180)).toFixed(2) }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">新人追踪礼包</span>
                                            <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ permanentPackage.premiumCrystal }}</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ permanentPackage.tickets }}</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ permanentPackage.price }}
                                        </div>
                                    </div>
                                </div>
                                <!-- 每周追踪礼包 === -->  
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: weeklyTrackingPackage.count > 0 && weeklyTrackingPackage.count <= weeklyTrackingPackageMaxCount }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (weeklyTrackingPackage.price / ((weeklyTrackingPackage.crystal + weeklyTrackingPackage.tickets * 180) / 180)).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">每周追踪礼包</span>
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ weeklyTrackingPackage.crystal }}</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ weeklyTrackingPackage.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="weeklyTrackingPackage.count" 
                                                placeholder="0" 
                                                min="0" 
                                                :max="weeklyTrackingPackageMaxCount"
                                                step="1" 
                                                @input="validateWeeklyTrackingPackageInput"
                                                @focus="clearWeeklyTrackingPackageIfZero"
                                                @blur="setWeeklyTrackingPackageDefaultIfEmpty"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ weeklyTrackingPackage.price }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 月度追踪礼包Ⅰ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: monthlyTrackingPackage1.count > 0 && monthlyTrackingPackage1.count <= monthlyTrackingPackageMaxCount }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (monthlyTrackingPackage1.price / (monthlyTrackingPackage1.tickets)).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">月度追踪礼包Ⅰ</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ monthlyTrackingPackage1.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="monthlyTrackingPackage1.count" 
                                                placeholder="0" 
                                                min="0" 
                                                :max="monthlyTrackingPackageMaxCount"
                                                step="1" 
                                                @input="validateMonthlyTrackingPackage1Input"
                                                @focus="clearMonthlyTrackingPackage1IfZero"
                                                @blur="setMonthlyTrackingPackage1DefaultIfEmpty"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ monthlyTrackingPackage1.price }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 月度追踪礼包Ⅱ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: monthlyTrackingPackage2.count > 0 && monthlyTrackingPackage2.count <= monthlyTrackingPackageMaxCount }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (monthlyTrackingPackage2.price / (monthlyTrackingPackage2.tickets)).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">月度追踪礼包Ⅱ</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ monthlyTrackingPackage2.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="monthlyTrackingPackage2.count" 
                                                placeholder="0" 
                                                min="0" 
                                                :max="monthlyTrackingPackageMaxCount"
                                                step="1" 
                                                @input="validateMonthlyTrackingPackage2Input"
                                                @focus="clearMonthlyTrackingPackage2IfZero"
                                                @blur="setMonthlyTrackingPackage2DefaultIfEmpty"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ monthlyTrackingPackage2.price }}
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                                <!-- 局长就任特供 -->
                                <div style="display: flex; flex-direction: column; gap: 0px;">
                                    <div v-for="(pkg, index) in directorSupplyPackages" :key="pkg.id" 
                                        class="crystal-supply-btn-wrapper">
                                        <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;margin-bottom: 10px;">
                                            <button 
                                                class="training-btn crystal-supply-btn" 
                                                :class="{ active: pkg.active && pkg.price > 0 }"
                                                @click="toggleDirectorSupplyPackage(index)"
                                                :disabled="!directorSupplyPackageEnabled[index]"
                                                style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0; opacity: directorSupplyPackageEnabled[index] ? 1 : 0.5;">
                                                <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                    <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                        {{ (pkg.price / ((pkg.crystal + pkg.tickets * 180) / 180)).toFixed(2) }}
                                                    </span>
                                                </div>
                                                <div class="crystal-supply-right" style="display: flex; align-items: center; flex: 1; justify-content: flex-start;">
                                                    <span style="font-weight: bold; white-space: nowrap;">局长就任特供{{ getRomanNumeral(pkg.id) }}</span>
                                                    <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ pkg.crystal }}</span>
                                                    <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ pkg.tickets }}</span>
                                                </div>
                                            </button>
                                            <!-- 价格显示 -->
                                            <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                                <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                    ￥{{ pkg.price }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 限时礼包 -->
                            <div class="sub-section">
                                <h3 class="sub-title">限时礼包</h3>  
                                <div style="font-size: 12px; color: #666; margin-bottom: 15px;">
                                    注意：此模块不统计“统合十连搜索令”以及“都市搜索令”<br>
                                    “双轨搜索令”统一显示为“通用搜索令”
                                </div>                                  
                                <!-- 荒旅追踪补给Ⅰ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: limitedPackageCycle1.count > 0 && limitedPackageCycle1.count <= 2 }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (limitedPackageCycle1.price / ((limitedPackageCycle1.crystal + limitedPackageCycle1.tickets * 180) / 180)).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">荒旅追踪补给Ⅰ</span>
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageCycle1.crystal }}</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageCycle1.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="limitedPackageCycle1.count" 
                                                placeholder="0" 
                                                min="0" 
                                                max="2"
                                                step="1" 
                                                @input="validateLimitedPackageInput('limitedPackageCycle1')"
                                                @focus="clearLimitedPackageIfZero('limitedPackageCycle1')"
                                                @blur="setLimitedPackageDefaultIfEmpty('limitedPackageCycle1')"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ limitedPackageCycle1.price }}
                                            </div>
                                        </div>
                                    </div>    
                                </div>

                                <!-- 荒旅追踪补给Ⅱ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: limitedPackageCycle2.count > 0 && limitedPackageCycle2.count <= 2 }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (limitedPackageCycle2.price / limitedPackageCycle2.tickets).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">荒旅追踪补给Ⅱ</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageCycle2.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="limitedPackageCycle2.count" 
                                                placeholder="0" 
                                                min="0" 
                                                max="2"
                                                step="1" 
                                                @input="validateLimitedPackageInput('limitedPackageCycle2')"
                                                @focus="clearLimitedPackageIfZero('limitedPackageCycle2')"
                                                @blur="setLimitedPackageDefaultIfEmpty('limitedPackageCycle2')"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ limitedPackageCycle2.price }}
                                            </div>
                                        </div>
                                    </div>    
                                </div>

                                <!-- 荒旅追踪补给Ⅲ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: limitedPackageCycle3.count > 0 && limitedPackageCycle3.count <= 2 }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (limitedPackageCycle3.price / limitedPackageCycle3.tickets).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">荒旅追踪补给Ⅲ</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageCycle3.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="limitedPackageCycle3.count" 
                                                placeholder="0" 
                                                min="0" 
                                                max="2"
                                                step="1" 
                                                @input="validateLimitedPackageInput('limitedPackageCycle3')"
                                                @focus="clearLimitedPackageIfZero('limitedPackageCycle3')"
                                                @blur="setLimitedPackageDefaultIfEmpty('limitedPackageCycle3')"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ limitedPackageCycle3.price }}
                                            </div>
                                        </div>
                                    </div>    
                                </div>

                                <!-- 荒旅追踪补给Ⅳ -->
                                <div class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: limitedPackageCycle4.count > 0 && limitedPackageCycle4.count <= 2 }"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ (limitedPackageCycle4.price / limitedPackageCycle4.tickets).toFixed(2) }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">荒旅追踪补给Ⅳ</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageCycle4.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 -->
                                        <div style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="limitedPackageCycle4.count" 
                                                placeholder="0" 
                                                min="0" 
                                                max="2"
                                                step="1" 
                                                @input="validateLimitedPackageInput('limitedPackageCycle4')"
                                                @focus="clearLimitedPackageIfZero('limitedPackageCycle4')"
                                                @blur="setLimitedPackageDefaultIfEmpty('limitedPackageCycle4')"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ limitedPackageCycle4.price }}
                                            </div>
                                        </div>
                                    </div>    
                                </div>

                                <!-- 绰影夜话Ⅰ -->
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: limitedPackageShadow1.active }"
                                        @click="toggleLimitedPackage('limitedPackageShadow1')"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ (limitedPackageShadow1.price / limitedPackageShadow1.tickets).toFixed(2) }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">绰影夜话Ⅰ</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageShadow1.tickets }}</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ limitedPackageShadow1.price }}
                                        </div>
                                    </div>
                                </div>

                                <!-- 绰影夜话Ⅱ -->
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: limitedPackageShadow2.active }"
                                        @click="toggleLimitedPackage('limitedPackageShadow2')"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ (limitedPackageShadow2.price / limitedPackageShadow2.tickets).toFixed(2) }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">绰影夜话Ⅱ</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageShadow2.tickets }}</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ limitedPackageShadow2.price }}
                                        </div>
                                    </div>
                                </div>

                                <!-- 绰影夜话Ⅲ -->
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: limitedPackageShadow3.active }"
                                        @click="toggleLimitedPackage('limitedPackageShadow3')"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ (limitedPackageShadow3.price / limitedPackageShadow3.tickets).toFixed(2) }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">绰影夜话Ⅲ</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageShadow3.tickets }}</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ limitedPackageShadow3.price }}
                                        </div>
                                    </div>
                                </div>

                                <!-- 诡事断章 -->
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: limitedPackageMystery.active }"
                                        @click="toggleLimitedPackage('limitedPackageMystery')"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ (limitedPackageMystery.price / 50).toFixed(2) }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">诡事断章</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ limitedPackageMystery.tickets }}</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ limitedPackageMystery.price }}
                                        </div>
                                    </div>
                                </div>

                                <!-- 荒旅资源补给 -->
                                <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: limitedPackageTravelSupply.active }"
                                        @click="toggleLimitedPackage('limitedPackageTravelSupply')"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                9
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">荒旅资源补给</span>
                                            <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                            <span style="font-weight: bold; white-space: nowrap;">5</span>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥45
                                        </div>
                                    </div>
                                </div>
    
                                <!-- 盟约序章系列 -->
                                <div v-for="(item, index) in covenantPackages" :key="'covenant' + index" 
                                    class="crystal-supply-btn-wrapper" style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: item.count > 0 && item.count <= item.maxCount }"
                                            @click="toggleCovenantPackage(item.id, index)"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ item.tag }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.name }}</span>
                                                <img :src="limitedCouponIcon" class="resource-icon" alt="限定券">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.limitedCoupons }}</span>
                                            </div>
                                        </button>
                                        <!-- 输入框 - 只有盟约序章Ⅵ需要 -->
                                        <div v-if="item.name === '盟约序章Ⅵ'" style="display: flex; flex-direction: column; align-items: center; min-width: 60px; flex-shrink: 0;">
                                            <input 
                                                type="number" 
                                                v-model.number="item.count" 
                                                placeholder="0" 
                                                min="0" 
                                                max="2"
                                                step="1" 
                                                @input="validateLimitedPackageInput('limitedPackageCovenant6')"
                                                @focus="clearLimitedPackageIfZero('limitedPackageCovenant6')"
                                                @blur="setLimitedPackageDefaultIfEmpty('limitedPackageCovenant6')"
                                                style="width: 50px; padding: 6px 4px; border: 1px solid #555555; border-radius: 5px; text-align: center; background: #333333; color: #FFFFFF; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); font-size: 14px;">
                                            <div style="text-align: center; font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap;">
                                                ￥{{ item.price }}
                                            </div>
                                        </div>
                                        <div v-else style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                            <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                ￥{{ item.price }}
                                            </div>
                                        </div>
                                    </div>    
                                </div>

                                <!-- 白鸽巡礼系列（互斥选择） -->
                                <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;">
                                    <div v-for="(item, index) in dovePackages" :key="'dove' + index" 
                                        style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: item.active }"
                                            @click="toggleLimitedPackage(item.id)"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ item.tag }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.name }}</span>
                                                <template v-if="item.tickets > 0">
                                                    <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ item.tickets }}</span>
                                                </template>
                                                <template v-if="item.limitedCoupons > 0">
                                                    <img :src="limitedCouponIcon" class="resource-icon" alt="限定券">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ item.limitedCoupons }}</span>
                                                </template>
                                            </div>
                                        </button>
                                        <!-- 价格显示 -->
                                        <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                            <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                ￥{{ item.price }}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 单个礼包 -->
                                <div v-for="(item, index) in singlePackages" :key="'single' + index" 
                                    style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box; margin-bottom: 10px;">
                                    <button 
                                        class="training-btn crystal-supply-btn" 
                                        :class="{ active: item.active }"
                                        @click="toggleLimitedPackage(item.id)"
                                        style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                        <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                            <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                {{ item.tag }}
                                            </span>
                                        </div>
                                        <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                            <span style="font-weight: bold; white-space: nowrap;">{{ item.name }}</span>
                                            <template v-if="item.crystal > 0">
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.crystal }}</span>
                                            </template>
                                            <template v-if="item.premiumCrystal > 0">
                                                <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.premiumCrystal }}</span>
                                            </template>
                                            <template v-if="item.tickets > 0">
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.tickets }}</span>
                                            </template>
                                            <template v-if="item.limitedCoupons > 0">
                                                <img :src="limitedCouponIcon" class="resource-icon" alt="限定券">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.limitedCoupons }}</span>
                                            </template>
                                        </div>
                                    </button>
                                    <!-- 价格显示 -->
                                    <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                        <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                            ￥{{ item.price }}
                                        </div>
                                    </div>
                                </div>

                                <!-- 特供系列和组合购买 -->
                                <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;">
                                    <!-- 组合购买 -->
                                    <div style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: limitedPackageCombo.active }"
                                            @click="toggleComboPackage()"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    5.06
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">组合购买</span>
                                                <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                <span style="font-weight: bold; white-space: nowrap;">180</span>
                                                <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                <span style="font-weight: bold; white-space: nowrap;">100</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">2</span>
                                            </div>
                                        </button>
                                        <!-- 价格显示 -->
                                        <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                            <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                ￥18
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 特供系列 -->
                                    <div v-for="(item, index) in supplyPackages" :key="'supply' + index" 
                                        style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: item.active && !limitedPackageCombo.active }"
                                            @click="toggleLimitedPackage(item.id)"
                                            :disabled="limitedPackageCombo.active"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0; opacity: limitedPackageCombo.active ? 0.5 : 1;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ item.tag }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.name }}</span>
                                                <template v-if="item.crystal > 0">
                                                    <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ item.crystal }}</span>
                                                </template>
                                                <template v-if="item.premiumCrystal > 0">
                                                    <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ item.premiumCrystal }}</span>
                                                </template>
                                                <template v-if="item.tickets > 0">
                                                    <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                    <span style="font-weight: bold; white-space: nowrap;">{{ item.tickets }}</span>
                                                </template>
                                            </div>
                                        </button>
                                        <!-- 价格显示 -->
                                        <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                            <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                ￥{{ item.price }}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 跃升补给系列 -->
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <div v-for="(item, index) in upgradePackages" :key="'upgrade' + index" 
                                        style="display: flex; align-items: center; gap: 8px; max-width: 100%; box-sizing: border-box;">
                                        <button 
                                            class="training-btn crystal-supply-btn" 
                                            :class="{ active: item.active }"
                                            @click="toggleLimitedPackage(item.id)"
                                            style="display: flex; gap: 15px; align-items: center; padding: 12px 8px; flex: 1; min-width: 0;">
                                            <div class="crystal-supply-left" style="display: flex; align-items: center; min-width: 50px;justify-content: flex-start;">
                                                <span class="price-tag" style="background: #8B0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; white-space: nowrap;">
                                                    {{ item.tag }}
                                                </span>
                                            </div>
                                            <div class="crystal-supply-right" style="display: flex; align-items: center; min-width: 0; gap: 8px;flex: 1; justify-content: flex-start;">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.name }}</span>
                                                <img :src="premiumCrystalIcon" class="resource-icon" alt="璀璨晶源">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.premiumCrystal }}</span>
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                <span style="font-weight: bold; white-space: nowrap;">{{ item.tickets }}</span>
                                            </div>
                                        </button>
                                        <!-- 价格显示 -->
                                        <div style="display: flex; align-items: center; min-width: 60px; flex-shrink: 0; height: 100%;">
                                            <div style="text-align: center; font-size: 12px; color: #666; white-space: nowrap;">
                                                ￥{{ item.price }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 其他（⚠️估算） -->
                    <div class="potential-section card">
                        <h2 @click="toggleSection('otherEstimate')" class="section-header">
                            📝 其他资源
                            <span class="collapse-icon">{{ sections.otherEstimate ? '−' : '+' }}</span>
                        </h2>
                        <div v-if="sections.otherEstimate" class="section-content">
                            <!-- 前瞻兑换码 -->
                            <div class="sub-section">
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">前瞻兑换码：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                            {{ previewCodeCrystal }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!-- 版本福利签到奖励 -->
                            <div class="sub-section">
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">签到奖励：</span>
                                        <span class="item-value">
                                            <template v-if="signInRewardBaseData.tickets > 0">
                                                <img :src="ticketIcon" class="resource-icon" alt="搜索令">
                                                {{ signInRewardBaseData.tickets }}
                                            </template>
                                            <template v-if="signInRewardBaseData.limitedCoupons > 0">
                                                <img :src="limitedCouponIcon" class="resource-icon" alt="限定券" style="margin-left: 8px;">
                                                {{ signInRewardBaseData.limitedCoupons }}
                                            </template>
                                            <template v-if="signInRewardBaseData.tickets === 0 && signInRewardBaseData.limitedCoupons === 0">
                                                0
                                            </template>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!-- 停服更新 -->
                            <div class="sub-section">
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">停服更新：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                            {{ maintenanceCrystal }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!-- 停服维护 -->
                            <div class="sub-section">
                                <div class="accumulation-item">
                                    <div class="item-info">
                                        <span class="item-title">停服维护：</span>
                                        <span class="item-value">
                                            <img :src="crystalIcon" class="resource-icon" alt="异方晶">
                                            {{ maintenanceRepairCrystal }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>       

    <script>
        const { createApp } = Vue;
        const app = createApp({
            name: 'GachaCalculator',
            data() {
                // 数据初始化与本地存储恢复
                let savedData = {};
                try {
                    const saved = localStorage.getItem('gachaCalculatorData');
                    if (saved) {
                        savedData = JSON.parse(saved);
                        if (typeof savedData !== 'object') {
                            throw new Error('Invalid data format');
                        }
                    }
                } catch (e) {
                    console.error('解析localStorage失败，清除损坏数据并使用默认数据', e);
                    localStorage.removeItem('gachaCalculatorData');
                    savedData = {};
                }

                return {
                    // 主题模式-false为浅色模式ture为深色模式
                    isDarkMode: savedData.isDarkMode !== undefined ? savedData.isDarkMode : false,

                    // 菜单栏弹窗管理系统
                    showModal: false,
                    currentModal: null,

                    // 图片路径 - 使用绝对路径
                    crystalIcon: 'icons/crystal.png',
                    ticketIcon: 'icons/ticket.png',
                    redCrystalIcon: 'icons/red_crystal.png',
                    premiumCrystalIcon: 'icons/premium_crystal.png',
                    yellowTicketIcon: 'icons/yellow_ticket.png',
                    hlIcon:'icons/hl.gif',
                    limitedCouponIcon: 'icons/Limitedcoupon.png',
                    alloyIcon: 'icons/Multiplealloys.png',

                    // 各模块的展开/折叠状态
                    sections: savedData.sections || {
                        resources: false,
                        daily: false,
                        potential: false,
                        activities: false,
                        pullSummary: false,
                        recharge: false,
                        otherEstimate: false
                    },

                    // 卡池按钮
                    poolDates: {
                        nextVersion: new Date(2025, 10, 20),  // 2025年11月20日
                        newYear: new Date(2026, 1, 12)        // 2026年2月12日
                    },
                    selectedTime: savedData?.selectedTime || 'nextVersion', // 默认选择左边
                    calculateToPoolEnd: savedData?.calculateToPoolEnd || false, // 默认计算到卡池开放当天
                    versionWeeks: 4, // 版本卡池持续周数（固定4周）

                    // 饼状图悬停状态
                    hoveredPieModule: null,
                    hoveredPieIndex: -1,
                    // 饼状图数据
                    pieChartColors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'],
                    pieChartData: [],

                    // 当前库存数据
                    resources: savedData.resources || {
                        crystal: 0,
                        premiumCrystal: 0,
                        tickets: 0
                    },

                    // 皮肤预留红晶数量
                    skinReserve: savedData?.skinReserve || {
                        skin880: 0,
                        skin1280: 0,
                        skin2580: 0
                    },

                    usePremiumCrystal: savedData?.usePremiumCrystal || false, // 是否使用璀璨晶源抽卡开关数据
                    customAdjustment: savedData?.customAdjustment || 0, // 自定义异方晶修正值数据
                    weeklyCompleted: savedData?.weeklyCompleted || false, // 本周周常开关数据
                    dailyShareCompleted: savedData?.dailyShareCompleted || false, // 本周分享开关数据
                    emotionDetectionCompleted: savedData?.emotionDetectionCompleted || false, // 本月情绪检测开关数据
                    signInRewardCompleted: savedData?.signInRewardCompleted || false, // 本月签到开关数据
                    alloyCount: savedData.alloyCount || 0, // 多项合金兑换输入框数据
                    useAlloyExchange: savedData.useAlloyExchange || false, // 多项合金兑换开关数据
                    fashionTourCompleted: savedData?.fashionTourCompleted || false,
                    trackingExchanged: savedData?.trackingExchanged || false, // 本月追踪认证开关数据
                    trackingCertificationCount: savedData?.trackingCertificationCount || 0, // 拥有的黄票数量
                    useTrackingCertification: savedData?.useTrackingCertification || false, // 是否使用黄票兑换
                    friendshipExchanged: savedData?.friendshipExchanged || false, // 本月友情兑换开关数据
                    darkZoneSweepOnly: savedData?.darkZoneSweepOnly || false, // 暗域仅扫荡开关数据
                    darkZoneCompleted: savedData?.darkZoneCompleted || false, // 本周暗域开关数据
                    darkZoneFirstCompleted: savedData?.darkZoneFirstCompleted || false, // 本期暗域首通开关数据
                    dataGapCompleted: savedData?.dataGapCompleted || false, // 数据间隙开关数据

                    // 狂厄特训难度选择
                    trainingModes: savedData?.trainingModes || {
                        steady: false,
                        fluctuating: false,
                        outOfControl: false,
                        crazy: false
                    },

                    // 监察密令数据
                    selectedInspectionPeriod: savedData?.selectedInspectionPeriod || 1,
                    inspectionLevels: (() => {
                        const savedLevels = savedData?.inspectionLevels || {};
                        // 确保所有期数都有默认值0
                        const defaultLevels = {};
                        // 预定义可能的期数ID
                        for (let i = 1; i <= 10; i++) {
                            defaultLevels[i] = savedLevels[i] !== undefined ? savedLevels[i] : 0;
                        }
                        return defaultLevels;
                    })(),

                    // 高级监察密令数据
                    selectedRechargeInspectionPeriod: savedData?.selectedRechargeInspectionPeriod || 1,
                    rechargeInspectionLevels: (() => {
                        const savedLevels = savedData?.rechargeInspectionLevels || {};
                        // 确保所有期数都有默认值0
                        const defaultLevels = {};
                        // 预定义可能的期数ID
                        for (let i = 1; i <= 10; i++) {
                            defaultLevels[i] = savedLevels[i] !== undefined ? savedLevels[i] : 0;
                        }
                        return defaultLevels;
                    })(),  

                    // 无尽梦魇
                    nightmareScore: savedData?.nightmareScore || 60000,
                    nightmareSeaCompleted: savedData?.nightmareSeaCompleted || false,
                    nightMazeCompleted: savedData?.nightMazeCompleted || false,
                    // 无尽梦魇积分奖励数据
                    nightmareRewards: [
                        { score: 1000, crystal: 100, tickets: 0 },
                        { score: 1500, crystal: 120, tickets: 0 },
                        { score: 2000, crystal: 0, tickets: 1 },
                        { score: 3000, crystal: 150, tickets: 0 },
                        { score: 4000, crystal: 0, tickets: 1 },
                        { score: 5000, crystal: 150, tickets: 0 },
                        { score: 6000, crystal: 200, tickets: 0 },
                        { score: 7000, crystal: 200, tickets: 0 },
                        { score: 8000, crystal: 0, tickets: 1 },
                        { score: 10000, crystal: 100, tickets: 0 },
                        { score: 12000, crystal: 100, tickets: 0 },
                        { score: 14000, crystal: 100, tickets: 0 },
                        { score: 16000, crystal: 100, tickets: 0 },
                        { score: 18000, crystal: 100, tickets: 0 },
                        { score: 20000, crystal: 100, tickets: 0 },
                        { score: 22000, crystal: 100, tickets: 0 },
                        { score: 24000, crystal: 0, tickets: 1 },
                        { score: 26000, crystal: 100, tickets: 0 },
                        { score: 28000, crystal: 100, tickets: 0 },
                        { score: 30000, crystal: 100, tickets: 0 },
                        { score: 32000, crystal: 100, tickets: 0 },
                        { score: 34000, crystal: 100, tickets: 0 },
                        { score: 36000, crystal: 0, tickets: 1 },
                        { score: 38000, crystal: 100, tickets: 0 },
                        { score: 40000, crystal: 100, tickets: 0 },
                        { score: 42000, crystal: 100, tickets: 0 },
                        { score: 44000, crystal: 100, tickets: 0 },
                        { score: 46000, crystal: 100, tickets: 0 },
                        { score: 48000, crystal: 0, tickets: 1 },
                        { score: 50000, crystal: 100, tickets: 0 },
                        { score: 52000, crystal: 100, tickets: 0 },
                        { score: 54000, crystal: 100, tickets: 0 },
                        { score: 56000, crystal: 100, tickets: 0 },
                        { score: 58000, crystal: 100, tickets: 0 },
                        { score: 60000, crystal: 0, tickets: 1 }
                    ],

                    // 狄斯城（主线）数据
                    mainStory: savedData?.mainStory || {
                        chaosBeyondA: false,
                        chaosBeyondB: false,
                        unownedCavernA: false,
                        unownedCavernB: false,
                        kiranSquareA: false,
                        kiranSquareB: false,
                        carnivalA: false,
                        carnivalB: false,
                        refugeeCampA: false,
                        refugeeCampB: false,
                        muddyDarkTrapA: false,
                        muddyDarkTrapB: false,
                        highTowerBlackRing: false,
                        darkSurgeA: false,
                        darkSurgeB: false,
                        goldFeastA: false,
                        goldFeastB: false,
                        canFeng: false
                    },

                    // 行动纪要
                    actionSummaryLevel: savedData?.actionSummaryLevel || 19,
                    actionSummaryList: [
                        "01·混沌彼岸",
                        "02·混沌彼岸", 
                        "03·无主地窟",
                        "04·无主地窟",
                        "05·奇兰广场",
                        "06·奇兰广场",
                        "07·嘉年华",
                        "08·嘉年华",
                        "09·流民寨",
                        "10·流民寨",
                        "11·沉浊暗阱",
                        "12·沉浊暗阱",
                        "13·高塔黑环",
                        "N1·暗涌",
                        "N2·暗涌", 
                        "N3·碎金盛宴",
                        "N4·碎金盛宴",
                        "N5·残锋",
                        "N6·残锋"
                    ],

                    // 零镜系统数据
                    zeroMirror: savedData?.zeroMirror || {
                        nightChronicle: false,
                        disCity: false,
                        syndicate: false,
                        newCity: false,
                        rustRiver: false,
                        foreignLand: false,
                        innerSea: false,
                        upperCourt: false,
                        madEvil: false
                    },

                    // 记忆复现数据
                    memoryReviewThreshold: savedData?.memoryReviewThreshold || 10000,

                    // 旧案归档处数据
                    oldCaseArchiveCount: savedData?.oldCaseArchiveCount || 0,

                    // 狄斯暗影（EX）数据
                    darkShadowEx: savedData?.darkShadowEx || {
                        chaosBeyond: false,
                        unownedCavern: false,
                        kiranSquare: false,
                        carnival: false,
                        highTowerBlackRing: false,
                        luxuryFeastFog: false,
                        drowningRainCity: false,
                        goldFeast: false
                    },

                    // 记忆风暴数据
                    memoryStorm: savedData?.memoryStorm || {
                        memoryAnomaly: false,
                        impressionAnomaly: false,
                        echoAnomaly: false
                    },

                    // 污染之巢数据
                    pollutionNest: savedData?.pollutionNest || {
                        forbiddenZoneProbe: false,
                        extremeDomainSearch: false
                    },

                    // 清剿行动数据
                    cleanupOperation: savedData?.cleanupOperation || {
                        goldRush: false,
                        ominousSeed: false
                    },

                    // 帕尔马废墟数据
                    palmaRuins: savedData?.palmaRuins || {
                        tenacious: false,
                        berserk: false,
                        mysterious: false,
                        precise: false,
                        supernatural: false,
                        inspiration: false
                    },

                    // 派遣声望数据
                    selectedDispatchArea: savedData?.selectedDispatchArea || 'syndicate',
                    dispatchReputation: savedData?.dispatchReputation || {
                        syndicate: { level: 10000, crystal: 0 },
                        newCity: { level: 10000, crystal: 0 },
                        innerBay: { level: 10000, crystal: 0 },
                        sandSea: { level: 10000, crystal: 0 }
                    },

                    // 角色养成数据
                    characterDevelopment: savedData?.characterDevelopment || {
                        tier3: 0,
                        maxReverbS: 0,
                        maxReverbA: 0,
                        maxReverbB: 0,
                        reviewS: 0,
                        reviewA: 0,
                        haylaReviewed: true
                    },
                    
                    // 梦境&人格色谱数据
                    dreamInsightCount: savedData?.dreamInsightCount || 0,
                    dreamRetrospectCount: savedData?.dreamRetrospectCount || 0,
                    personalitySpectrumCount: savedData?.personalitySpectrumCount || 0,

                    // 灰烬之潮-重塑数据
                    ashTide: savedData?.ashTide || {
                        ashApostle: false,
                        disasterLocust: false
                    },

                    // 活动                    
                    // 活动排期数据
                    activitySchedule: [
                        { start: '2025-10-23', end: '2025-11-20', title: '妄夜迷章' },
                        { start: '2025-11-20', end: '2025-12-18', title: '歧行至破晓（⚠️估算）' },
                        { start: '2025-12-18', end: '2026-01-15', title: '1218-0115活动（⚠️估算）' },
                        { start: '2026-01-15', end: '2026-02-12', title: '0115-0212活动（⚠️估算）' },
                        { start: '2026-02-12', end: '2026-03-12', title: '新年活动（⚠️估算）' }
                    ],
                    // 活动完成奖励
                    activityCompleted: savedData?.activityCompleted || {},
                    // 活动审查奖励
                    activityReviewCompleted: savedData?.activityReviewCompleted || {},
                    // 活动角色试用奖励
                    activityTrialCompleted: savedData?.activityTrialCompleted || {},
                    // 活动复刻模式状态
                    activityRerunMode: savedData?.activityRerunMode || {
                        '妄夜迷章': false,
                        '歧行至破晓（⚠️估算）': false, 
                        '1218-0115活动（⚠️估算）': false,
                        '0115-0212活动（⚠️估算）': false,
                        '新年活动（⚠️估算）': false
                    },
                    // 诡境余音
                    remainingEchoActive: savedData?.remainingEchoActive !== undefined ? savedData.remainingEchoActive : false,
                    // 碎晶之梦
                    crystalDreamActive: savedData?.crystalDreamActive !== undefined ? savedData.crystalDreamActive : false,
                    // 活动公会战完成状态
                    activityGuildWarCompleted: savedData?.activityGuildWarCompleted || {},
                    // 活动绝密行动完成状态
                    activitySecretOperationCompleted: savedData?.activitySecretOperationCompleted || {},

                    monthlyCardCount: savedData?.monthlyCardCount || 0, // 额外购买月卡数量
                    monthlyCardActive: savedData?.monthlyCardActive || false, // 月卡是否激活
                    
                    // 狄斯盈满钵数据
                    disiLevel: savedData?.disiLevel || 0,
                    disiActive: savedData?.disiActive || false,
                    disiPrePurchased: savedData?.disiPrePurchased || false,
                    disiRewards: [
                        { level: 0, crystal: 0 },
                        { level: 5, crystal: 400 },
                        { level: 10, crystal: 400 },
                        { level: 15, crystal: 500 },
                        { level: 20, crystal: 500 },
                        { level: 25, crystal: 600 },
                        { level: 30, crystal: 600 },
                        { level: 35, crystal: 600 },
                        { level: 40, crystal: 800 },
                        { level: 42, crystal: 800 },
                        { level: 44, crystal: 800 },
                        { level: 46, crystal: 1000 },
                        { level: 48, crystal: 1000 },
                        { level: 50, crystal: 1800 }
                    ],

                    // 诡珑珍宝馆数据
                    treasureActive: savedData?.treasureActive || false,
                    treasurePrePurchased: savedData?.treasurePrePurchased || false,

                    // 特惠时尚巡回庆典
                    specialFashionTour: {
                        active: savedData?.specialFashionTour?.active || false,
                        completed: savedData?.specialFashionTour?.completed || false,
                        usedDiscounts: savedData?.specialFashionTour?.usedDiscounts || 0,
                        maxDiscounts: savedData?.specialFashionTour?.maxDiscounts !== undefined ? 
                                    savedData.specialFashionTour.maxDiscounts : 4,  // 默认4次，可用户调节
                        prePurchased: savedData?.specialFashionTour?.prePurchased || false  // 新增预购买状态
                    },

                    // 晶源特供（首充）
                    crystalSupplyButtons: [
                    { price: 6, premiumCrystal: 120, purchased: savedData?.crystalSupplyPurchased?.[0] || false },
                    { price: 30, premiumCrystal: 600, purchased: savedData?.crystalSupplyPurchased?.[1] || false },
                    { price: 98, premiumCrystal: 1960, purchased: savedData?.crystalSupplyPurchased?.[2] || false },
                    { price: 198, premiumCrystal: 3960, purchased: savedData?.crystalSupplyPurchased?.[3] || false },
                    { price: 328, premiumCrystal: 6560, purchased: savedData?.crystalSupplyPurchased?.[4] || false },
                    { price: 648, premiumCrystal: 12960, purchased: savedData?.crystalSupplyPurchased?.[5] || false }
                    ],

                    // 晶源特供（非首充）
                    nonFirstCrystalSupplyButtons: (() => {
                        const counts = savedData?.nonFirstCrystalSupplyCounts || [0, 0, 0, 0, 0, 0];
                        return [
                            { price: 6, premiumCrystal: 60, count: counts[0] },
                            { price: 30, premiumCrystal: 330, count: counts[1] },
                            { price: 98, premiumCrystal: 1130, count: counts[2] },
                            { price: 198, premiumCrystal: 2380, count: counts[3] },
                            { price: 328, premiumCrystal: 3980, count: counts[4] },
                            { price: 648, premiumCrystal: 8080, count: counts[5] }
                        ];
                    })(),

                    // 常驻礼包数据
                    // 新人追踪礼包
                    permanentPackage: {
                        active: savedData?.permanentPackageActive || false,
                        premiumCrystal: 1800,
                        tickets: 10,
                        price: 128
                    },
                    // 每周追踪礼包
                    weeklyTrackingPackage: {
                        count: savedData?.weeklyTrackingPackageCount || 0,
                        crystal: 60,
                        tickets: 1,
                        price: 6
                    },
                    // 月度追踪礼包Ⅰ&Ⅱ
                    monthlyTrackingPackage1: {
                        count: savedData?.monthlyTrackingPackage1Count || 0,
                        tickets: 10,
                        price: 98
                    },
                    monthlyTrackingPackage2: {
                        count: savedData?.monthlyTrackingPackage2Count || 0,
                        tickets: 20,
                        price: 168
                    },
                    // 局长就任特供
                    directorSupplyPackages: [
                        { id: 1, active: savedData?.directorSupplyActive?.[0] || false, crystal: 60, tickets: 1, price: 6 },
                        { id: 2, active: savedData?.directorSupplyActive?.[1] || false, crystal: 300, tickets: 3, price: 30 },
                        { id: 3, active: savedData?.directorSupplyActive?.[2] || false, crystal: 680, tickets: 5, price: 68 },
                        { id: 4, active: savedData?.directorSupplyActive?.[3] || false, crystal: 1980, tickets: 10, price: 198 },
                        { id: 5, active: savedData?.directorSupplyActive?.[4] || false, crystal: 3280, tickets: 15, price: 328 },
                        { id: 6, active: savedData?.directorSupplyActive?.[5] || false, crystal: 6480, tickets: 20, price: 648 }
                    ],
                    // 限时礼包数据
                    // 荒旅追踪补给系列
                    limitedPackageCycle1: {
                        count: savedData?.limitedPackageCycle1Count || 0,
                        crystal: 60,
                        tickets: 1,
                        price: 6
                    },
                    limitedPackageCycle2: {
                        count: savedData?.limitedPackageCycle2Count || 0,
                        crystal: 0,
                        tickets: 4,
                        price: 28
                    },
                    limitedPackageCycle3: {
                        count: savedData?.limitedPackageCycle3Count || 0,
                        crystal: 0,
                        tickets: 10,
                        price: 78
                    },
                    limitedPackageCycle4: {
                        count: savedData?.limitedPackageCycle4Count || 0,
                        crystal: 0,
                        tickets: 20,
                        price: 168
                    },
                    // 绰影夜话系列
                    limitedPackageShadow1: {
                        active: savedData?.limitedPackageShadow1Active || false,
                        crystal: 0,
                        tickets: 10,
                        price: 68
                    },
                    limitedPackageShadow2: {
                        active: savedData?.limitedPackageShadow2Active || false,
                        crystal: 0,
                        tickets: 15,
                        price: 128
                    },
                    limitedPackageShadow3: {
                        active: savedData?.limitedPackageShadow3Active || false,
                        crystal: 0,
                        tickets: 20,
                        price: 198
                    },
                    // 诡事断章
                    limitedPackageMystery: {
                        active: savedData?.limitedPackageMysteryActive || false,
                        crystal: 0,
                        tickets: 40,
                        price: 328
                    },
                    // 荒旅资源补给
                    limitedPackageTravelSupply: {
                        active: savedData?.limitedPackageTravelSupplyActive || false,
                        crystal: 0,
                        tickets: 5,
                        price: 45
                    },
                    // 重构的限时礼包数据结构
                    covenantPackages: [
                        { id: 'limitedPackageCovenant1', name: '盟约序章Ⅰ', tag: '3.00', limitedCoupons: 2, price: 6, count: 0, maxCount: 1 },
                        { id: 'limitedPackageCovenant2', name: '盟约序章Ⅱ', tag: '6.00', limitedCoupons: 5, price: 30, count: 0, maxCount: 1 },
                        { id: 'limitedPackageCovenant3', name: '盟约序章Ⅲ', tag: '6.80', limitedCoupons: 10, price: 68, count: 0, maxCount: 1 },
                        { id: 'limitedPackageCovenant4', name: '盟约序章Ⅳ', tag: '6.60', limitedCoupons: 30, price: 198, count: 0, maxCount: 1 },
                        { id: 'limitedPackageCovenant5', name: '盟约序章Ⅴ', tag: '6.56', limitedCoupons: 50, price: 328, count: 0, maxCount: 1 },
                        { id: 'limitedPackageCovenant6', name: '盟约序章Ⅵ', tag: '6.48', limitedCoupons: 100, price: 648, count: 0, maxCount: 2 }
                    ],
                    
                    dovePackages: [
                        { id: 'limitedPackageDove1', name: '白鸽巡礼·组合特供Ⅰ', tag: '6.80', tickets: 10, price: 68, active: false },
                        { id: 'limitedPackageDove2', name: '白鸽巡礼·组合特供Ⅱ', tag: '8.53', tickets: 15, price: 128, active: false },
                        { id: 'limitedPackageDove3', name: '白鸽巡礼·组合特供Ⅲ', tag: '9.90', tickets: 20, price: 198, active: false }
                    ],
                    
                    singlePackages: [
                        { id: 'limitedPackageGolden', name: '秘金圣铸', tag: '15.0', tickets: 3, price: 45, active: false },
                        { id: 'limitedPackageAgreement', name: '和议致函', tag: '4.50', crystal: 60, tickets: 1, price: 6, active: false },
                        { id: 'limitedPackageAlliance', name: '同盟之仪', tag: '9.80', tickets: 10, price: 98, active: false }
                    ],
                    
                    supplyPackages: [
                        { id: 'limitedPackageDis', name: '狄斯特供', tag: '5.40', crystal: 100, price: 3, active: false },
                        { id: 'limitedPackageFesa', name: '费沙特供', tag: '6.00', tickets: 1, price: 6, active: false },
                        { id: 'limitedPackageEast', name: '东洲特供', tag: '9.00', premiumCrystal: 180, tickets: 1, price: 18, active: false }
                    ],
                    
                    upgradePackages: [
                        { id: 'limitedPackageDanger', name: '高危跃升补给', tag: '21.33', premiumCrystal: 360, tickets: 4, price: 128, active: false },
                        { id: 'limitedPackageMadness', name: '狂厄跃升补给', tag: '22.00', premiumCrystal: 540, tickets: 6, price: 198, active: false }
                    ],
                    
                    // 组合购买
                    limitedPackageCombo: { active: false, premiumCrystal: 180, crystal: 100, tickets: 2, price: 18 },
                }                
            },
            computed: {
                // 总计抽数计算（套用饼状图，用于标题显示）
                totalModulePulls() {
                    // 获取各资源类型的总量
                    const totalCrystal = this.totalAllCrystal;                    // 所有异方晶总量
                    const totalPremiumCrystal = this.totalAllPremiumCrystal;      // 所有璀璨晶源总量
                    const totalTickets = this.totalAllTickets;                    // 所有搜索令总量
                    const totalLimitedCoupons = this.totalAllLimitedCoupons;      // 所有限定券总量
                    // 将各类资源转换为抽数
                    const crystalPulls = Math.floor(totalCrystal / 180);          // 异方晶抽数（180异方晶=1抽）
                    const premiumCrystalPulls = Math.floor(totalPremiumCrystal / 180); // 璀璨晶源抽数（180璀璨晶源=1抽）
                    const ticketPulls = totalTickets;                             // 搜索令抽数（1搜索令=1抽）
                    const limitedCouponPulls = totalLimitedCoupons;               // 限定券抽数（1限定券=1抽）
                    // 返回总抽数
                    return crystalPulls + premiumCrystalPulls + ticketPulls + limitedCouponPulls;
                },

                // 总计氪金费用计算（标题显示）
                totalRechargeCost() {
                    return this.monthlyCardCost +                         // 小月卡（黑钥贵宾）费用
                        this.disiCost +                                   // 狄斯盈满钵费用
                        this.treasureCost +                               // 诡珑珍宝馆费用
                        this.specialFashionTourCost +  // 特惠时尚巡回庆典费用
                        this.advancedInspectionOrderCost +                // 高级监察密令（大月卡）费用
                        this.crystalSupplyTotalCost +                     // 晶源特供（首充）费用
                        this.nonFirstCrystalSupplyTotalCost +             // 晶源特供（非首充）费用
                        this.permanentPackageTotalCost +                  // 新人追踪礼包费用
                        this.weeklyTrackingPackageTotalCost +             // 每周追踪礼包费用
                        this.monthlyTrackingPackage1TotalCost +           // 月度追踪礼包Ⅰ费用
                        this.monthlyTrackingPackage2TotalCost +           // 月度追踪礼包Ⅱ费用
                        this.directorSupplyTotalCost +                    // 局长就任特供礼包费用
                        this.limitedPackageTotalCost;                     // 限时礼包费用
                },

                // 统计所有模块的异方晶（用于顶部资源显示）
                totalAllCrystal() {
                    const baseCrystal = this.resources.crystal || 0;                          // 当前库存异方晶
                    const weeklyTrackingCrystal = this.weeklyTrackingPackageTotalCrystal;     // 每周追踪礼包异方晶
                    const directorSupplyCrystal = this.directorSupplyTotalCrystal;            // 局长就任特供礼包异方晶
                    const limitedPackageCrystal = this.limitedPackageTotalCrystal;            // 限时礼包异方晶
                    // 合并的未来收入计算
                    const totalIncome = this.dailyAccumulationCrystal +        // 日常积累模块异方晶
                        this.activityRewardsCrystal +                          // 活动奖励模块异方晶
                        this.otherSystemsCrystal +                             // 潜在资源模块异方晶
                        this.rechargeCrystal +                                 // 氪金资源模块异方晶
                        this.previewCodeCrystal +                              // 前瞻兑换码异方晶
                        this.maintenanceCrystal +                              // 停服更新异方晶
                        this.maintenanceRepairCrystal;                         // 停服维护异方晶
                    return baseCrystal + totalIncome + weeklyTrackingCrystal + directorSupplyCrystal + limitedPackageCrystal + this.customAdjustment;
                    // 总计 = 当前库存 + 未来收入 + 礼包异方晶 + 自定义修正值
                },

                // 统计所有模块的璀璨晶源（用于顶部资源显示）
                /*
                totalAllPremiumCrystal() {
                    const basePremiumCrystal = this.resources.premiumCrystal || 0;                    // 当前库存璀璨晶源
                    const monthlyCardPremium = this.monthlyCardPremiumCrystal;                        // 月卡立即获得的璀璨晶源
                    const disiPremium = this.disiPremiumCrystal;                                      // 狄斯盈满钵璀璨晶源
                    const crystalSupplyPremium = this.crystalSupplyTotalPremiumCrystal;               // 晶源特供（首充）璀璨晶源
                    const nonFirstCrystalSupplyPremium = this.nonFirstCrystalSupplyTotalPremiumCrystal; // 晶源特供（非首充）璀璨晶源
                    const permanentPackagePremium = this.permanentPackageTotalPremiumCrystal;         // 新人追踪礼包璀璨晶源
                    
                    // 只有当启用璀璨晶源抽卡时，璀璨晶源才计入总计
                    const availablePremiumCrystal = this.usePremiumCrystal ? basePremiumCrystal : 0;
                    
                    return availablePremiumCrystal + monthlyCardPremium + disiPremium + crystalSupplyPremium + nonFirstCrystalSupplyPremium + permanentPackagePremium - this.totalSkinReserve;
                    // 总计 = 所有璀璨晶源来源相加 - 皮肤预留的璀璨晶源
                },
                */

                // 统计所有模块的璀璨晶源（用于顶部资源显示，特惠时尚巡回庆典）
                totalAllPremiumCrystal() {
                    const basePremiumCrystal = this.resources.premiumCrystal || 0;                    // 当前库存璀璨晶源
                    const monthlyCardPremium = this.monthlyCardPremiumCrystal;                        // 月卡立即获得的璀璨晶源
                    const disiPremium = this.disiPremiumCrystal;                                      // 狄斯盈满钵璀璨晶源
                    const crystalSupplyPremium = this.crystalSupplyTotalPremiumCrystal;               // 晶源特供（首充）璀璨晶源
                    const nonFirstCrystalSupplyPremium = this.nonFirstCrystalSupplyTotalPremiumCrystal; // 晶源特供（非首充）璀璨晶源
                    const permanentPackagePremium = this.permanentPackageTotalPremiumCrystal;         // 新人追踪礼包璀璨晶源
                    const specialFashionTourPremium = this.specialFashionTourPremiumCrystal;          // 特惠时尚巡回庆典璀璨晶源
                    const limitedPackagePremium = this.limitedPackageTotalPremiumCrystal;  // 新增：限时礼包璀璨晶源
                    
                    // 只有当启用璀璨晶源抽卡时，璀璨晶源才计入总计
                    const availablePremiumCrystal = this.usePremiumCrystal ? basePremiumCrystal : 0;
                    
                    return availablePremiumCrystal + monthlyCardPremium + disiPremium + crystalSupplyPremium + nonFirstCrystalSupplyPremium + permanentPackagePremium + specialFashionTourPremium + limitedPackagePremium - this.totalSkinReserve;
                    // 总计 = 所有璀璨晶源来源相加 - 皮肤预留的璀璨晶源
                },

                // 统计所有模块的搜索令（用于顶部资源显示）
                totalAllTickets() {
                    return (this.resources.tickets || 0) +                    // 当前库存搜索令
                        this.dailyAccumulationTickets +                       // 日常积累模块搜索令
                        this.activityRewardsTickets +                         // 活动奖励模块搜索令
                        this.otherSystemsTickets +                            // 潜在资源模块搜索令
                        this.rechargeTickets +                                // 氪金资源模块搜索令
                        this.signInRewardTickets +                            // 其他估算模块搜索令（签到奖励）
                        this.permanentPackageTotalTickets +                   // 新人追踪礼包搜索令
                        this.weeklyTrackingPackageTotalTickets +              // 每周追踪礼包搜索令
                        this.monthlyTrackingPackage1TotalTickets +            // 月度追踪礼包Ⅰ搜索令
                        this.monthlyTrackingPackage2TotalTickets +            // 月度追踪礼包Ⅱ搜索令
                        this.directorSupplyTotalTickets;                     // 局长就任特供礼包搜索令
                },

                // 统计所有模块的限定券（用于顶部资源显示）
                totalAllLimitedCoupons() {
                    return this.signInRewardLimitedCoupons + this.limitedPackageTotalLimitedCoupons;
                },

                // 分模块抽数数据（饼状图）
                modulePullsData() {
                    // 1. 当前资源模块 - 修改扣减逻辑
                    const baseCrystal = this.resources.crystal || 0;
                    const basePremiumCrystal = this.usePremiumCrystal ? (this.resources.premiumCrystal || 0) : 0;
                    const baseTickets = this.resources.tickets || 0;

                    // 计算实际可用的异方晶（考虑扣减）
                    let availableCrystal = baseCrystal - this.totalSkinReserve;

                    // 计算实际可用的璀璨晶源（考虑皮肤预留扣减）
                    const availablePremiumCrystal = this.usePremiumCrystal ? 
                        Math.max(0, basePremiumCrystal - this.totalSkinReserve) : 0;

                    // 应用异方晶修正，但限制扣减不超过当前库存
                    if (this.customAdjustment < 0) {
                        const maxDeduction = baseCrystal; // 最大扣减量为当前库存
                        availableCrystal += Math.max(this.customAdjustment, -maxDeduction);
                    } else {
                        availableCrystal += this.customAdjustment;
                    }

                    const currentCrystalPulls = Math.floor(Math.max(0, availableCrystal) / 180);
                    const currentPremiumCrystalPulls = Math.floor(availablePremiumCrystal / 180); // 使用扣减后的值
                    const currentTicketPulls = baseTickets;
                    const currentPulls = currentCrystalPulls + currentPremiumCrystalPulls + currentTicketPulls;
                    
                    // 计算扣减部分（如果有）
                    let deductionPulls = 0;
                    if (this.customAdjustment < 0) {
                        const actualDeduction = Math.min(Math.abs(this.customAdjustment), baseCrystal);
                        deductionPulls = Math.floor(actualDeduction / 180);
                    }
                    
                    // 2. 日常积累模块
                    const dailyCrystal = this.dailyAccumulationCrystal;               // 日常积累模块的异方晶总量
                    const dailyTickets = this.dailyAccumulationTickets;               // 日常积累模块的搜索令总量
                    const dailyPulls = Math.floor(dailyCrystal / 180) + dailyTickets; // 日常积累模块总抽数 = 异方晶抽数 + 搜索令抽数
                    
                    // 3. 活动奖励模块
                    const activityCrystal = this.activityRewardsCrystal;                        // 活动奖励模块的异方晶总量
                    const activityTickets = this.activityRewardsTickets;                        // 活动奖励模块的搜索令总量
                    const activityPulls = Math.floor(activityCrystal / 180) + activityTickets;  // 活动奖励模块总抽数 = 异方晶抽数 + 搜索令抽数
                    
                    // 4. 潜在资源模块
                    const potentialCrystal = this.otherSystemsCrystal;                            // 潜在资源模块的异方晶总量
                    const potentialTickets = this.otherSystemsTickets;                            // 潜在模块的搜索令总量
                    const potentialPulls = Math.floor(potentialCrystal / 180) + potentialTickets; // 潜在资源模块总抽数 = 异方晶抽数 + 搜索令抽数
                    
                    // 5. 氪金资源模块 - 计算所有付费内容可获得的抽数
                    // 璀璨晶源部分（付费获得的璀璨晶源）
                    const rechargePremiumCrystal = this.monthlyCardPremiumCrystal +                   // 月卡立即获得的璀璨晶源
                        this.disiPremiumCrystal +                                                     // 狄斯盈满钵璀璨晶源
                        this.specialFashionTourPremiumCrystal +                                       // 特惠时尚巡回庆典璀璨晶源
                        this.crystalSupplyTotalPremiumCrystal +                                       // 晶源特供（首充）璀璨晶源
                        this.nonFirstCrystalSupplyTotalPremiumCrystal +                               // 晶源特供（非首充）璀璨晶源
                        this.permanentPackageTotalPremiumCrystal +                                    // 新人追踪礼包璀璨晶源
                        this.limitedPackageTotalPremiumCrystal;                                       // 限时礼包璀璨晶源
                    const rechargePremiumCrystalPulls = Math.floor(rechargePremiumCrystal / 180);     // 璀璨晶源抽数转换
                    // 异方晶部分（付费获得的异方晶）
                    const rechargeCrystal = this.monthlyCardCrystal +                                 // 月卡每日异方晶
                        this.advancedInspectionOrderCrystal +                                         // 高级监察密令异方晶
                        (this.disiActive ? this.disiRewardTotal : 0) +                                // 狄斯盈满钵异方晶奖励（如果激活）
                        this.weeklyTrackingPackageTotalCrystal +                                      // 每周追踪礼包异方晶
                        this.directorSupplyTotalCrystal +                                             // 局长就任特供礼包异方晶
                        this.limitedPackageTotalCrystal;                                              // 限时礼包异方晶
                    const rechargeCrystalPulls = Math.floor(rechargeCrystal / 180);                   // 异方晶抽数转换
                    // 搜索令部分（付费获得的搜索令）
                    const rechargeTicketPulls = this.advancedInspectionOrderTickets +                 // 高级监察密令搜索令
                        this.treasureTickets +                                                        // 诡珑珍宝馆搜索令
                        this.specialFashionTourTickets +                                              // 特惠时尚巡回庆典搜索令
                        this.permanentPackageTotalTickets +                                           // 新人追踪礼包搜索令
                        this.weeklyTrackingPackageTotalTickets +                                      // 每周追踪礼包搜索令
                        this.monthlyTrackingPackage1TotalTickets +                                    // 月度追踪礼包Ⅰ搜索令
                        this.monthlyTrackingPackage2TotalTickets +                                    // 月度追踪礼包Ⅱ搜索令
                        this.directorSupplyTotalTickets +                                             // 局长就任特供礼包搜索令
                        this.limitedPackageTotalTickets;                                              // 限时礼包搜索令
                    // 限定券部分（付费获得的限定券）
                    const rechargeLimitedCouponPulls = this.limitedPackageTotalLimitedCoupons;        // 限时礼包限定券
                    // 氪金资源模块总抽数
                    const rechargePulls = rechargeCrystalPulls + rechargePremiumCrystalPulls + rechargeTicketPulls + rechargeLimitedCouponPulls;
                    
                    // 6. 其他估算模块 - 计算版本更新和其他杂项可获得的抽数
                    const otherCrystal = this.previewCodeCrystal +         // 前瞻兑换码异方晶（版本更新兑换码）
                        this.maintenanceCrystal +                          // 停服更新异方晶（版本更新补偿）
                        this.maintenanceRepairCrystal;                     // 停服维护异方晶（中期维护补偿）
                    const otherTickets = this.signInRewardTickets;         // 签到奖励搜索令（版本签到活动）
                    const otherLimitedCoupons = this.signInRewardLimitedCoupons; // 签到奖励限定券（特定版本签到活动）
                    // 其他估算模块总抽数 = 异方晶抽数 + 搜索令抽数 + 限定券抽数
                    const otherPulls = Math.floor(otherCrystal / 180) +    // 异方晶转换为抽数
                        otherTickets +                                     // 搜索令直接计入抽数
                        otherLimitedCoupons;                               // 限定券直接计入抽数
                    
                    // 计算饼状图总计
                    const pieTotal = currentPulls + dailyPulls + activityPulls + potentialPulls + rechargePulls + otherPulls;
                    return [
                        { name: '现有', pulls: currentPulls, color: this.pieChartColors[0] },
                        { name: '日常', pulls: dailyPulls, color: this.pieChartColors[1] },
                        { name: '活动', pulls: activityPulls, color: this.pieChartColors[2] },
                        { name: '潜在', pulls: potentialPulls, color: this.pieChartColors[3] },
                        { name: '氪金', pulls: rechargePulls, color: this.pieChartColors[4] },
                        { name: '其他', pulls: otherPulls, color: this.pieChartColors[5] }
                    ];
                },

                // 分模块计算 - 当前资源总抽数
                currentPulls() {
                    const crystal = this.resources.crystal || 0;                    // 当前异方晶数量
                    const premiumCrystal = this.usePremiumCrystal ? (this.resources.premiumCrystal || 0) : 0; // 当前璀璨晶源（如果启用）
                    const tickets = this.resources.tickets || 0;                    // 当前搜索令数量                    
                    // 添加提前购买月卡的璀璨晶源到可用资源中
                    const monthlyCardPremiumCrystal = this.monthlyCardPremiumCrystal;                    
                    // 计算可用异方晶总量（扣除皮肤预留）
                    const availableCrystal = crystal + (premiumCrystal + monthlyCardPremiumCrystal) - this.totalSkinReserve + this.customAdjustment;                    
                    // 将异方晶转换为抽数（180异方晶=1抽）
                    const crystalPulls = Math.floor(Math.max(0, availableCrystal) / 180);                    
                    // 总抽数 = 异方晶抽数 + 搜索令数量
                    return crystalPulls + tickets;
                },

                // 分模块计算 - 日常积累异方晶
                dailyAccumulationCrystal() {
                    try {
                        return this.dailyActiveTotal +                 // 日常活跃奖励（每天40异方晶）
                            this.weeklyActiveReward +                   // 周常活跃奖励（每周150异方晶）
                            this.totalDarkZone +                       // 暗域周常奖励（每周450-510异方晶）
                            this.totalDarkZoneFirst +                  // 暗域首通奖励（每期450异方晶）
                            this.totalEmotionDetection +               // 情绪检测月度奖励（每月50异方晶）
                            this.totalSignInReward +                   // 签到月度奖励（每月100异方晶）
                            this.remainingShareTotal +                 // 每周分享奖励（每周60异方晶）
                            this.nightmareSeaReward +                  // 祸海之厄奖励（930异方晶）
                            (this.supervisionHarvestCrystal || 0) +    // 监管收菜奖励
                            (this.alloyExchangeCrystal || 0) +         // 多项合金兑换奖励
                            this.totalDataGapCrystal;                  // 数据间隙奖励（每期1260异方晶）
                    } catch (error) {
                        console.error('日常积累计算错误:', error);
                        return 0;
                    }
                },

                // 分模块计算 - 日常积累搜索令
                dailyAccumulationTickets() {
                    return this.totalTrackingExchange +                 // 追踪认证-常规兑换搜索令（每月5张）
                        this.totalFriendshipExchange +                  // 友情兑换搜索令（每月3张）
                        this.totalEmotionDetectionTickets +             // 情绪检测月度搜索令（每月1张）
                        this.totalSignInRewardTickets +                 // 签到奖励搜索令（每月1张）
                        this.totalFashionTourTickets +                  // 基础时尚巡回庆典搜索令
                        this.totalTrackingCertificationTickets +        // 追踪认证-机密兑换搜索令（黄票兑换）
                        this.inspectionOrderTotalTickets;               // 监察密令搜索令奖励
                },

                // 分模块计算 - 潜在资源异方晶
                otherSystemsCrystal() {
                    return this.trainingRewards.total +            // 狂厄特训奖励
                        this.nightmareRemainingCrystal +           // 无尽梦魇积分剩余奖励
                        this.mainStoryRewards.total +              // 狄斯城（主线）关卡奖励
                        this.darkShadowExRewards +                 // 狄斯暗影（EX）挑战奖励  
                        this.memoryStormRewards +                  // 记忆风暴副本奖励
                        this.pollutionNestRewards +                // 污染之巢副本奖励
                        this.cleanupOperationRewards +             // 清剿行动副本奖励
                        this.palmaRuinsRewards +                   // 帕尔马废墟副本奖励
                        this.characterDevelopmentRewards.total +   // 角色养成系统奖励
                        this.actionSummaryCrystal +                // 行动纪要奖励
                        this.memoryReviewCrystal +                 // 记忆复现奖励
                        this.dreamPersonalityTotalCrystal +        // 梦境&人格色谱奖励
                        this.zeroMirrorCrystal +                   // 零镜系统（世界观）奖励
                        this.dispatchReputationTotalCrystal +      // 派遣声望奖励
                        this.ashTideRewards.crystal;               // 灰烬之潮-重塑奖励
                },
                
                // 分模块计算 - 潜在资源搜索令
                otherSystemsTickets() {
                    return this.trainingRewards.tickets +               // 狂厄特训搜索令奖励
                        this.nightmareRemainingTickets +                // 无尽梦魇积分搜索令奖励
                        this.mainStoryRewards.tickets +                 // 狄斯城（主线）搜索令奖励
                        this.oldCaseArchiveTickets;                     // 旧案归档处未兑换搜索令
                },

                // 分模块计算 - 活动异方晶
                activityRewardsCrystal() {
                    let activityCrystal = 0;
                    let activityTickets = 0;
                    let activityReviewCrystal = 0;
                    let activityTrialCrystal = 0;
                    let activityGuildWarCrystal = 0;
                    let activitySecretOperationCrystal = 0;
                    
                    // 计算所有未完成活动的奖励
                    this.displayActivities.forEach(activity => {
                        if (!this.activityCompleted[activity.title]) {
                            if (activity.title === '妄夜迷章') {
                                activityCrystal += 1070;
                                activityTickets += 3;
                            } else if (activity.title === '歧行至破晓（⚠️估算）') {
                                activityCrystal += 2000;
                                activityTickets += 5;
                                
                                // 公会战奖励计算
                                if (!this.activityGuildWarCompleted[activity.title]) {
                                    activityGuildWarCrystal += 1100;
                                }
                                
                                // 新增：绝密行动奖励计算
                                if (!this.activitySecretOperationCompleted[activity.title]) {
                                    activitySecretOperationCrystal += 300;
                                }
                            } else {
                                activityCrystal += 1000;
                                activityTickets += 3;
                            }
                        }
                        // 计算审查奖励
                        if (!this.activityReviewCompleted[activity.title]) {
                            if (activity.title === '新年活动（⚠️估算）') {
                                activityReviewCrystal += 550;
                            } else {
                                activityReviewCrystal += 350;
                            }
                        }
                        // 计算角色试用奖励
                        if (!this.activityTrialCompleted[activity.title]) {
                            if (activity.title === '歧行至破晓（⚠️估算）' || activity.title === '新年活动（⚠️估算）') {
                                activityTrialCrystal += 70;
                            } else {
                                activityTrialCrystal += 40;
                            }
                        }
                    });
                    
                    return activityCrystal + 
                        activityReviewCrystal + 
                        activityTrialCrystal +
                        activityGuildWarCrystal +
                        activitySecretOperationCrystal +
                        this.activityRerunCrystal;
                },

                // 分模块计算 - 活动搜索令
                activityRewardsTickets() {
                    let activityTickets = 0;
                    let activitySignInTickets = 0;
                    // 计算所有未完成活动的搜索令
                    this.displayActivities.forEach(activity => {
                        if (!this.activityCompleted[activity.title]) {
                            if (activity.title === '歧行至破晓（⚠️估算）') {
                                activityTickets += 5;
                            } else {
                                activityTickets += 3;
                            }
                        }                        
                    });
                    return activityTickets + activitySignInTickets + this.activityRerunTickets; // 复刻活动搜索令
                },

                // 分模块计算 - 氪金资源异方晶统计
                rechargeCrystal() {
                    return this.monthlyCardCrystal +                    // 月卡每日异方晶
                        (this.disiActive ? this.disiRewardTotal : 0) +  // 狄斯盈满钵异方晶
                        this.advancedInspectionOrderCrystal;            // 高级监察密令异方晶
                },    

                // 分模块计算 - 氪金搜索令
                rechargeTickets() {
                    return this.advancedInspectionOrderTickets +        // 高级监察密令搜索令奖励
                        this.treasureTickets +                          // 诡珑珍宝馆搜索令奖励
                        this.specialFashionTourTickets +                // 特惠时尚巡回庆典搜索令奖励
                        this.limitedPackageTotalTickets;                // 限时礼包搜索令奖励
                },   

                // 皮肤预留红晶的璀璨晶源总计
                /*
                totalSkinReserve() {
                    return (this.skinReserve.skin880 * 880) + 
                           (this.skinReserve.skin1280 * 1280) + 
                           (this.skinReserve.skin2580 * 2580);
                },
                */
               
                totalSkinReserve() {
                    // 先检查库存是否足够
                    const availablePremiumCrystal = this.resources.premiumCrystal || 0;
                    
                    if (!this.specialFashionTour.active) {
                        // 原价计算逻辑
                        const calculatedReserve = (this.skinReserve.skin880 * 880) + 
                            (this.skinReserve.skin1280 * 1280) + 
                            (this.skinReserve.skin2580 * 2580);
                        
                        // 确保预留不超过库存
                        return Math.min(calculatedReserve, availablePremiumCrystal);
                    }
                    
                    // 特惠折扣计算逻辑
                    let total = 0;
                    const discountPerSkin = 300;
                    
                    // 计算总折扣次数（前4次享受折扣）
                    const totalSkinCount = this.skinReserve.skin880 + this.skinReserve.skin1280;
                    const discountCount = Math.min(totalSkinCount, this.specialFashionTour.maxDiscounts);
                    
                    // 计算享受折扣的总金额
                    let discountedTotal = 0;
                    let remainingDiscounts = discountCount;
                    
                    // 先计算880皮肤的折扣
                    const skin880Discount = Math.min(this.skinReserve.skin880, remainingDiscounts);
                    discountedTotal += skin880Discount * (880 - discountPerSkin);
                    remainingDiscounts -= skin880Discount;
                    
                    // 再计算1280皮肤的折扣
                    const skin1280Discount = Math.min(this.skinReserve.skin1280, remainingDiscounts);
                    discountedTotal += skin1280Discount * (1280 - discountPerSkin);
                    
                    // 计算原价部分
                    const fullPriceTotal = 
                        (this.skinReserve.skin880 - skin880Discount) * 880 +
                        (this.skinReserve.skin1280 - skin1280Discount) * 1280;
                    
                    // 2580皮肤不享受折扣
                    const calculatedReserve = discountedTotal + fullPriceTotal + (this.skinReserve.skin2580 * 2580);
                    
                    // 确保预留不超过库存
                    return Math.min(calculatedReserve, availablePremiumCrystal);
                },

                // 计算到"歧行至破晓"还有多少天
                daysToNextVersion() {
                    const today = new Date();
                    const targetDate = this.poolDates.nextVersion;
                    const diffTime = targetDate - today;
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                },
                
                // 计算到"新年版本"还有多少天
                daysToNewYear() {
                    const today = new Date();
                    const targetDate = this.poolDates.newYear;
                    const diffTime = targetDate - today;
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                },

                // 计算实际用于资源统计的总天数
                selectedDays() {
                    const baseDays = this.selectedTime === 'nextVersion' 
                        ? this.daysToNextVersion 
                        : this.daysToNewYear;
                    return this.calculateToPoolEnd ? baseDays + (this.versionWeeks * 7) : baseDays;
                },
                
                // 日常活跃总奖励：每天40异方晶 × 总天数
                dailyActiveTotal() {
                    return 40 * this.selectedDays;
                },

                // 计算周常任务的总周数
                weeklyCount() {
                    const today = new Date();
                    let targetDate = this.selectedTime === 'nextVersion' 
                        ? this.poolDates.nextVersion 
                        : this.poolDates.newYear;
                    // 如果计算到卡池结束，则加上版本周数
                    if (this.calculateToPoolEnd) {
                        targetDate = new Date(targetDate.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000));
                    }
                    // 计算从当前周一到目标日期之间的完整周数
                    const currentMonday = new Date(today);
                    const dayOfWeek = today.getDay(); // 0是周日，1是周一，...6是周六
                    const daysToMonday = dayOfWeek === 0 ? 1 : (dayOfWeek === 1 ? 0 : 8 - dayOfWeek);
                    currentMonday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
                    // 计算周数（包含当前周）
                    const diffTime = targetDate - currentMonday;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const diffWeeks = Math.ceil(diffDays / 7);
                    return Math.max(1, diffWeeks); // 至少1周
                },

                // 计算剩余的周常任务周数
                remainingWeeklyCount() {
                    // 如果本周已完成，则从下周开始计算
                    if (this.weeklyCompleted) {
                        return Math.max(0, this.weeklyCount - 1);
                    } else {
                        return this.weeklyCount;
                    }
                },

                // 周常活跃奖励
                weeklyActiveReward() {
                    // 使用剩余周数计算逻辑
                    return 150 * this.remainingWeeklyCount;
                },

                // 计算剩余的每周分享任务周数
                remainingShareWeeks() {
                    // 分享周数计算逻辑与周常相同
                    if (this.dailyShareCompleted) {
                        return Math.max(0, this.weeklyCount - 1);
                    } else {
                        return this.weeklyCount;
                    }
                },
                // 计算每周分享任务总奖励（每周60异方晶）
                remainingShareTotal() {
                    // 使用剩余分享周数计算逻辑
                    return 60 * this.remainingShareWeeks;
                },

                // 计算剩余的暗域挑战周数
                remainingDarkZoneWeeks() {
                    // 暗域周数计算逻辑与周常相同
                    if (this.darkZoneCompleted) {
                        return Math.max(0, this.weeklyCount - 1);
                    } else {
                        return this.weeklyCount;
                    }
                },

                // 暗域挑战奖励计算
                totalDarkZone() {
                    // 使用剩余暗域周数计算逻辑
                    return this.darkZonePerWeek * this.remainingDarkZoneWeeks;
                },

                // 计算每周暗域奖励（根据是否仅扫荡）
                darkZonePerWeek() {
                    return this.darkZoneSweepOnly ? 450 : 510;
                },

                // 首通奖励期数计算
                darkZoneFirstPeriods() {
                    const firstPeriodStart = new Date(2025, 9, 20); // 2025年10月20日
                    const periodDuration = 6 * 7 * 24 * 60 * 60 * 1000; // 6周的毫秒数
                    // 计算目标日期
                    let targetDate;
                    if (this.selectedTime === 'nextVersion') {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.nextVersion;
                    } else {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.newYear;
                    }
                    let currentPeriodStart = new Date(firstPeriodStart);
                    let periodCount = 0;
                    // 计算在当前日期和目标日期之间的期数
                    while (currentPeriodStart <= targetDate) {
                        const periodEnd = new Date(currentPeriodStart.getTime() + periodDuration);
                        // 只统计在当前日期之后结束的期数
                        if (periodEnd > new Date()) {
                            periodCount++;
                        } 
                        currentPeriodStart = new Date(currentPeriodStart.getTime() + periodDuration);
                    }
                    return Math.max(1, periodCount); // 至少1期
                },

                // 暗域首通奖励计算
                totalDarkZoneFirst() {
                    const crystalPerPeriod = 450;
                    if (this.darkZoneFirstCompleted) {
                        return Math.max(0, (this.darkZoneFirstPeriods - 1)) * crystalPerPeriod;
                    } else {
                        return this.darkZoneFirstPeriods * crystalPerPeriod;
                    }
                },
                
                // 计算从现在到目标日期之间的月份数(情绪检测、签到奖励、商店兑换)
                remainingMonths() {
                    const today = new Date();
                    let targetDate = this.selectedTime === 'nextVersion' 
                        ? this.poolDates.nextVersion
                        : this.poolDates.newYear;
                    
                    // 如果计算到卡池结束，则加上版本周数
                    if (this.calculateToPoolEnd) {
                        targetDate = new Date(targetDate.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000));
                    }
                    
                    // 正确的计算方法：计算跨越的月份数（包含起始月和结束月）
                    let months = (targetDate.getFullYear() - today.getFullYear()) * 12;
                    months += targetDate.getMonth() - today.getMonth();
                    
                    // 如果目标日期的日期大于等于今天的日期，则加1个月（包含当前月）
                    if (targetDate.getDate() >= today.getDate()) {
                        months++;
                    } else {
                        // 如果目标日期的日期小于今天的日期，但还在同一个月内，也要包含当前月
                        months++;
                    }
                    
                    // 确保至少为1个月
                    return Math.max(1, months);
                },

                // 情绪检测月度任务
                totalEmotionDetection() {
                    return this.calculateMonthlyReward(90, this.emotionDetectionCompleted);
                },
                totalEmotionDetectionTickets() {
                    return this.calculateMonthlyReward(1, this.emotionDetectionCompleted);
                },
                
                // 签到月度任务
                totalSignInReward() {
                    return this.calculateMonthlyReward(100, this.signInRewardCompleted);
                },                
                totalSignInRewardTickets() {
                    return this.calculateMonthlyReward(1, this.signInRewardCompleted);
                },
                
                // 监管收菜异方晶计算
                supervisionHarvestCrystal() {
                    try {
                        const secondsPerCrystal = 3456;
                        const now = new Date();
                        
                        // 计算到目标日期（卡池结束或开放）
                        let targetDate;
                        if (this.selectedTime === 'nextVersion') {
                            targetDate = this.calculateToPoolEnd ? 
                                new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                                this.poolDates.nextVersion;
                        } else {
                            targetDate = this.calculateToPoolEnd ? 
                                new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                                this.poolDates.newYear;
                        }
                        
                        const timeDiff = Math.max(0, (targetDate - now) / 1000);
                        const crystals = Math.floor(timeDiff / secondsPerCrystal);
                        
                        return crystals;
                    } catch (error) {
                        console.error('监管收菜计算错误:', error);
                        return 0;
                    }
                },

                // 多项合金兑换异方晶计算
                alloyExchangeCrystal() {
                    if (!this.useAlloyExchange) {
                        return 0;
                    }
                    
                    // 检查alloyCount是否为有效数字
                    if (isNaN(this.alloyCount) || this.alloyCount === null || this.alloyCount === '') {
                        return 0;
                    }
                    
                    const alloyPerCrystal = 231;
                    const crystalsPerExchange = 4;
                    
                    // 计算可兑换的异方晶数量（每231个合金兑换4个异方晶）
                    const exchanges = Math.floor(this.alloyCount / alloyPerCrystal);
                    const crystals = exchanges * crystalsPerExchange;
                    
                    return crystals;
                },

                // 基础时尚巡回庆典期数计算
                fashionTourPeriods() {
                    const tourPeriods = [
                        { start: new Date(2025, 10, 20), end: new Date(2025, 10, 23) },   // 11月20-11月23
                        { start: new Date(2025, 10, 24), end: new Date(2025, 10, 30) },   // 11月24-11月30
                        { start: new Date(2025, 11, 1), end: new Date(2025, 11, 7) },     // 12月1-12月7
                        { start: new Date(2025, 11, 8), end: new Date(2025, 11, 14) },    // 12月8-12月14
                        { start: new Date(2025, 11, 15), end: new Date(2025, 11, 21) },   // 12月15-12月21
                        { start: new Date(2025, 11, 22), end: new Date(2025, 11, 28) },   // 12月22-12月28
                        { start: new Date(2025, 11, 29), end: new Date(2026, 0, 4) },     // 12月29-1月4
                        { start: new Date(2026, 0, 5), end: new Date(2026, 0, 11) }       // 1月5-1月11
                    ];
                    
                    const today = new Date();
                    let targetDate;
                    if (this.selectedTime === 'nextVersion') {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.nextVersion;
                    } else {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.newYear;
                    }
                    
                    let periodCount = 0;
                    for (const period of tourPeriods) {
                        // 只统计在当前日期和目标日期之间的期数，且开始时间在当前日期之后或正在进行中
                        if (period.end > today && period.start <= targetDate) {
                            periodCount++;
                        }
                    }
                    
                    return Math.max(0, periodCount);
                },
                // 基础时尚巡回庆典总搜索令计算
                totalFashionTourTickets() {
                    if (this.fashionTourCompleted) {
                        return Math.max(0, (this.fashionTourPeriods - 1));
                    } else {
                        return this.fashionTourPeriods;
                    }
                },

                // 监察密令期数计算
                inspectionPeriods() {
                    const periods = [];
                    const firstPeriodStart = new Date(2025, 9, 6, 10); // 2025年10月6日10:00
                    const periodDuration = 6 * 7 * 24 * 60 * 60 * 1000; // 6周的毫秒数
                    // 根据选定的时间计算需要显示的期数
                    let targetDate;
                    if (this.selectedTime === 'nextVersion') {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.nextVersion;
                    } else {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.newYear;
                    }
                    let currentPeriodStart = new Date(firstPeriodStart);
                    let periodId = 1;
                    // 生成所有在当前日期和目标日期之间的密令期数
                    while (currentPeriodStart <= targetDate) {
                        const periodEnd = new Date(currentPeriodStart.getTime() + periodDuration);
                        // 只显示结束时间在当前日期之后的期数
                        if (periodEnd > new Date()) {
                            const startStr = this.formatDateToMMDD(currentPeriodStart);
                            const endStr = this.formatDateToMMDD(periodEnd);
                            periods.push({
                                id: periodId,
                                startDate: startStr,
                                endDate: endStr,
                                startTime: new Date(currentPeriodStart),
                                endTime: new Date(periodEnd)
                            });
                        }
                        currentPeriodStart = new Date(currentPeriodStart.getTime() + periodDuration);
                        periodId++;
                    }
                    return periods;
                },

                // 监察密令总搜索令计算
                inspectionOrderTotalTickets() {
                    let totalTickets = 0;
                    
                    for (const period of this.inspectionPeriods) {
                        const level = this.inspectionLevels[period.id] || 0;
                        totalTickets += this.calculateCurrentPeriodTickets(level);
                    }
                    
                    return totalTickets;
                },

                // 高级监察密令异方晶计算
                advancedInspectionOrderCrystal() {
                    let totalCrystal = 0;
                    
                    for (const period of this.inspectionPeriods) {
                        const level = this.rechargeInspectionLevels[period.id] || 0;
                        totalCrystal += this.calculateRechargePeriodCrystal(level);
                    }
                    
                    return totalCrystal;
                },
                // 高级监察密令搜索令计算
                advancedInspectionOrderTickets() {
                    let totalTickets = 0;
                    
                    for (const period of this.inspectionPeriods) {
                        const level = this.rechargeInspectionLevels[period.id] || 0;
                        totalTickets += this.calculateRechargePeriodTickets(level);
                    }
                    
                    return totalTickets;
                },
                // 高级监察密令费用计算
                advancedInspectionOrderCost() {
                    let totalCost = 0;                    
                    // 遍历所有监察密令期数，统计等级>0的期数
                    for (const period of this.inspectionPeriods) {
                        const level = this.rechargeInspectionLevels[period.id] || 0;
                        // 只有当滑块等级>0时才计入68RMB
                        if (level > 0) {
                            totalCost += 68;
                        }
                    }                   
                    return totalCost;
                },

                // 追踪认证-常规月度兑换
                totalTrackingExchange() {
                    return this.calculateMonthlyReward(5, this.trackingExchanged); // 每月5张搜索令
                },

                // 追踪认证-机密黄票兑换
                totalTrackingCertification() {
                    return 0; // 黄票兑换不产生异方晶，只产生搜索令
                },

                // 黄票兑换搜索令数量：每8张黄票换1张搜索令
                totalTrackingCertificationTickets() {
                    if (!this.useTrackingCertification) {
                        return 0;
                    }
                    
                    // 检查trackingCertificationCount是否为有效数字
                    if (isNaN(this.trackingCertificationCount) || this.trackingCertificationCount === null || this.trackingCertificationCount === '') {
                        return 0;
                    }
                    
                    return Math.floor(this.trackingCertificationCount / 8);
                },

                // 友情兑换月度任务  
                totalFriendshipExchange() {
                    return this.calculateMonthlyReward(3, this.friendshipExchanged); // 每月3张搜索令
                },

                // 数据间隙期数计算
                dataGapPeriods() {
                    const firstPeriodStart = new Date(2025, 10, 6); // 2025年11月6日
                    const periodDuration = 4 * 7 * 24 * 60 * 60 * 1000; // 4周的毫秒数                    
                    // 计算目标日期
                    let targetDate;
                    if (this.selectedTime === 'nextVersion') {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.nextVersion;
                    } else {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.newYear;
                    }
                    let currentPeriodStart = new Date(firstPeriodStart);
                    let periodCount = 0;                    
                    // 计算在当前日期和目标日期之间的期数
                    while (currentPeriodStart <= targetDate) {
                        const periodEnd = new Date(currentPeriodStart.getTime() + periodDuration);                        
                        // 只统计在当前日期之后结束的期数
                        if (periodEnd > new Date()) {
                            periodCount++;
                        }
                        currentPeriodStart = new Date(currentPeriodStart.getTime() + periodDuration);
                    }                    
                    return Math.max(1, periodCount); // 至少1期
                },

                // 数据间隙总异方晶计算
                totalDataGapCrystal() {
                    const crystalPerPeriod = 1260;
                    if (this.dataGapCompleted) {
                        return Math.max(0, (this.dataGapPeriods - 1)) * crystalPerPeriod;
                    } else {
                        return this.dataGapPeriods * crystalPerPeriod;
                    }
                },

                // 狂厄特训奖励计算
                trainingRewards() {
                    let crystal = 0;
                    let tickets = 0;
                    if (this.trainingModes.steady) {
                        crystal += 100;
                        tickets += 1;
                    }
                    if (this.trainingModes.fluctuating) {
                        crystal += 200;
                        tickets += 2;
                    }
                    if (this.trainingModes.outOfControl) {
                        crystal += 200;
                    }
                    if (this.trainingModes.crazy) {
                        crystal += 60;
                    }
                    return {
                        crystal,
                        tickets,
                        total: crystal + (tickets * 180)
                    };
                },

                // 祸海之厄奖励：如果已完成则为0，否则为930异方晶
                nightmareSeaReward() {
                    return this.nightmareSeaCompleted ? 0 : 930;
                },

                // 狄斯城（主线）奖励计算
                mainStoryRewards() {
                    let crystal = 0;
                    let tickets = 0;
                    
                    if (this.mainStory.chaosBeyondA) { crystal += 995; tickets += 1; }
                    if (this.mainStory.chaosBeyondB) { crystal += 1230; tickets += 1; }
                    if (this.mainStory.unownedCavernA) { crystal += 1175; tickets += 1; }
                    if (this.mainStory.unownedCavernB) { crystal += 1280; tickets += 1; }
                    if (this.mainStory.kiranSquareA) { crystal += 1265; tickets += 1; }
                    if (this.mainStory.kiranSquareB) { crystal += 1230; tickets += 1; }
                    if (this.mainStory.carnivalA) { crystal += 1230; tickets += 1; }
                    if (this.mainStory.carnivalB) { crystal += 935; tickets += 1; }
                    if (this.mainStory.refugeeCampA) { crystal += 1125; tickets += 1; }
                    if (this.mainStory.refugeeCampB) { crystal += 1195; tickets += 1; }
                    if (this.mainStory.muddyDarkTrapA) { crystal += 1230; tickets += 1; }
                    if (this.mainStory.muddyDarkTrapB) { crystal += 605; tickets += 1; }
                    if (this.mainStory.highTowerBlackRing) { crystal += 1980; tickets += 2; }
                    if (this.mainStory.darkSurgeA) { crystal += 1005; tickets += 1; }
                    if (this.mainStory.darkSurgeB) { crystal += 1005; tickets += 1; }
                    if (this.mainStory.goldFeastA) { crystal += 900; tickets += 1; }
                    if (this.mainStory.goldFeastB) { crystal += 1180; tickets += 1; }
                    if (this.mainStory.canFeng) { crystal += 960; }
                    
                    return {
                        crystal,
                        tickets,
                        total: crystal + (tickets * 180)
                    };
                },

                // 行动纪要奖励计算
                actionSummaryText() {
                    if (this.actionSummaryLevel >= 19) {
                        return "已完成全部行动纪要";
                    }
                    return this.actionSummaryList[this.actionSummaryLevel] || "01·混沌彼岸";
                },

                // 行动纪要异方晶计算
                actionSummaryCrystal() {
                    // 总异方晶3800，滑块从0到18，每滑动一格减少200
                    const totalCrystal = 3800;
                    const crystalPerStep = 200;
                    return totalCrystal - (this.actionSummaryLevel * crystalPerStep);
                },

                // 零镜系统计算属性
                zeroMirrorCrystal() {
                    let totalCrystal = 0;
                    // 定义每个区域的异方晶奖励
                    const rewards = {
                        nightChronicle: 200,
                        disCity: 20,
                        syndicate: 180,
                        newCity: 80,
                        rustRiver: 60,
                        foreignLand: 120,
                        innerSea: 80,
                        upperCourt: 0,  // 上庭为0异方晶
                        madEvil: 320
                    };
                    // 计算所有激活区域的异方晶总和
                    for (const [key, value] of Object.entries(this.zeroMirror)) {
                        if (value) { // 如果按钮是激活状态（已打开）
                            totalCrystal += rewards[key];
                        }
                    }
                    return totalCrystal;
                },

                // 记忆复现异方晶计算
                memoryReviewCrystal() {
                    // 弥合阈值奖励配置
                    const thresholdRewards = [
                        { threshold: 1000, crystal: 100 },
                        { threshold: 2000, crystal: 100 },
                        { threshold: 3000, crystal: 100 },
                        { threshold: 4000, crystal: 100 },
                        { threshold: 5000, crystal: 100 },
                        { threshold: 6000, crystal: 100 },
                        { threshold: 7000, crystal: 100 },
                        { threshold: 8000, crystal: 100 },
                        { threshold: 9000, crystal: 100 },
                        { threshold: 10000, crystal: 100 }
                    ];
                    let totalCrystal = 0;
                    // 计算大于当前阈值的所有奖励
                    for (const reward of thresholdRewards) {
                        if (this.memoryReviewThreshold < reward.threshold) {
                            totalCrystal += reward.crystal;
                        }
                    }
                    return totalCrystal;
                },

                // 旧案归档处搜索令计算
                oldCaseArchiveTickets() {
                    return this.oldCaseArchiveCount || 0;
                },

                // 狄斯暗影（EX）奖励计算
                darkShadowExRewards() {
                    let crystal = 0;
                    
                    if (this.darkShadowEx.chaosBeyond) crystal += 720;
                    if (this.darkShadowEx.unownedCavern) crystal += 720;
                    if (this.darkShadowEx.kiranSquare) crystal += 590;
                    if (this.darkShadowEx.carnival) crystal += 650;
                    if (this.darkShadowEx.highTowerBlackRing) crystal += 650;
                    if (this.darkShadowEx.luxuryFeastFog) crystal += 650;
                    if (this.darkShadowEx.drowningRainCity) crystal += 650;
                    if (this.darkShadowEx.goldFeast) crystal += 650;
                    
                    return crystal;
                },

                // 记忆风暴奖励计算
                memoryStormRewards() {
                    let crystal = 0;
                    
                    if (this.memoryStorm.memoryAnomaly) crystal += 350;
                    if (this.memoryStorm.impressionAnomaly) crystal += 350;
                    if (this.memoryStorm.echoAnomaly) crystal += 350;
                    
                    return crystal;
                },

                // 污染之巢奖励计算
                pollutionNestRewards() {
                    let crystal = 0;
                    
                    if (this.pollutionNest.forbiddenZoneProbe) crystal += 350;
                    if (this.pollutionNest.extremeDomainSearch) crystal += 210;
                    
                    return crystal;
                },

                // 清剿行动奖励计算
                cleanupOperationRewards() {
                    let crystal = 0;
                    
                    if (this.cleanupOperation.goldRush) crystal += 350;
                    if (this.cleanupOperation.ominousSeed) crystal += 350;
                    
                    return crystal;
                },

                // 帕尔马废墟奖励计算
                palmaRuinsRewards() {
                    let crystal = 0;
                    
                    if (this.palmaRuins.tenacious) crystal += 280;
                    if (this.palmaRuins.berserk) crystal += 280;
                    if (this.palmaRuins.mysterious) crystal += 280;
                    if (this.palmaRuins.precise) crystal += 280;
                    if (this.palmaRuins.supernatural) crystal += 280;
                    if (this.palmaRuins.inspiration) crystal += 280;
                    
                    return crystal;
                },

                // 派遣声望奖励计算
                dispatchReputationTotalCrystal() {
                    let totalCrystal = 0;
                    
                    // 计算所有区域的异方晶总和
                    for (const area of Object.values(this.dispatchReputation)) {
                        totalCrystal += area.crystal;
                    }
                    
                    return totalCrystal;
                },

                // 角色养成奖励计算
                characterDevelopmentRewards() {
                    let crystal = 0;
                    
                    crystal += this.characterDevelopment.tier3 * 180;
                    crystal += this.characterDevelopment.maxReverbS * 210;
                    crystal += this.characterDevelopment.maxReverbA * 60;
                    crystal += this.characterDevelopment.maxReverbB * 20;
                    crystal += this.characterDevelopment.reviewS * 200;
                    crystal += this.characterDevelopment.reviewA * 150;
                    
                    if (!this.characterDevelopment.haylaReviewed) {
                        crystal += 100;
                    }
                    
                    return {
                        crystal,
                        total: crystal
                    };
                },

                // 梦境&人格色谱奖励计算
                dreamInsightCrystal() {
                    return this.dreamInsightCount * 100;
                },                
                dreamRetrospectCrystal() {
                    return this.dreamRetrospectCount * 400;
                },                
                personalitySpectrumCrystal() {
                    return this.personalitySpectrumCount * 400;
                },
                // 梦境&人格色谱总计
                dreamPersonalityTotalCrystal() {
                    return this.dreamInsightCrystal + this.dreamRetrospectCrystal + this.personalitySpectrumCrystal;
                },

                // 无尽梦魇积分奖励异方晶计算(显示和计算)
                nightmareRemainingCrystal() {
                    let totalCrystal = 0;
                    for (const reward of this.nightmareRewards) {
                        if (this.nightmareScore < reward.score) {
                            totalCrystal += reward.crystal;
                        }
                    }
                    return totalCrystal;
                },

                // 无尽梦魇积分奖励搜索令计算(显示和计算)
                nightmareRemainingTickets() {
                    let totalTickets = 0;
                    for (const reward of this.nightmareRewards) {
                        if (this.nightmareScore < reward.score) {
                            totalTickets += reward.tickets;
                        }
                    }
                    return totalTickets;
                },

                // 灰烬之潮-重塑奖励计算
                ashTideRewards() {
                    let crystal = 0;
                    
                    if (this.ashTide.ashApostle) crystal += 180;
                    if (this.ashTide.disasterLocust) crystal += 180;
                    
                    return {
                        crystal,
                        total: crystal
                    };
                },

                // 计算需要显示的活动模块
                displayActivities() {
                    const activities = [];
                    const today = new Date();
                    
                    // 根据选定的卡池时间确定目标日期 - 使用 poolDates 中的数据
                    let targetDate;
                    if (this.selectedTime === 'nextVersion') {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.nextVersion.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.nextVersion;
                    } else {
                        targetDate = this.calculateToPoolEnd ? 
                            new Date(this.poolDates.newYear.getTime() + (this.versionWeeks * 7 * 24 * 60 * 60 * 1000)) :
                            this.poolDates.newYear;
                    }
                    
                    // 遍历活动排期，只显示在当前日期和目标日期之间的活动
                    for (let i = 0; i < this.activitySchedule.length; i++) {
                        const activity = this.activitySchedule[i];
                        const activityStartDate = new Date(activity.start);
                        const activityEndDate = new Date(activity.end);
                        
                        // 显示条件：活动在当前日期之后开始，且在目标日期之前结束
                        // 或者活动正在进行中（今天在活动期间内）
                        if (activityEndDate > today && activityStartDate <= targetDate) {
                            activities.push(activity);
                        }
                    }
                    
                    return activities;
                },

                // 格式化日期
                formattedNewYearDate() {
                    const date = this.poolDates.newYear;
                    return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                },

                formattedNextVersionDate() {
                    const date = this.poolDates.nextVersion;
                    return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                },

                dailyInspectionOrderTickets() {
                    let totalTickets = 0;
                    
                    // 计算所有期数的搜索令总和，使用各自的等级数据
                    for (let period = 1; period <= this.calculateInspectionPeriods; period++) {
                        const level = this.inspectionLevels[period] || 0;
                        totalTickets += this.calculateCurrentPeriodTickets(level);
                    }
                    
                    return totalTickets;
                },

                // 复刻活动异方晶奖励
                activityRerunCrystal() {
                    let totalCrystal = 0;
                    this.displayActivities.forEach(activity => {
                        if (!this.activityRerunMode[activity.title]) {
                            totalCrystal += activity.title === '妄夜迷章' ? 660 : 600;
                        }
                    });
                    // 诡境余音和碎晶之梦
                    if (!this.remainingEchoActive) {
                        totalCrystal += 900;
                    }
                    if (!this.crystalDreamActive) {
                        totalCrystal += 360;
                    }
                    return totalCrystal;
                },

                // 复刻活动搜索令奖励
                activityRerunTickets() {
                    let totalTickets = 0;
                    this.displayActivities.forEach(activity => {
                        if (!this.activityRerunMode[activity.title]) {
                            totalTickets += 1;
                        }
                    });
                    // 诡境余音和碎晶之梦
                    if (!this.remainingEchoActive) {
                        totalTickets += 1;
                    }
                    if (!this.crystalDreamActive) {
                        totalTickets += 1;
                    }
                    return totalTickets;
                },

                // 月卡璀璨晶源计算
                monthlyCardPremiumCrystal() {
                    if (!this.monthlyCardActive) return 0;
                    // -1表示提前购买，璀璨晶源为0；0及以上按正常计算
                    if (this.monthlyCardCount === -1) return 0;
                    // 基础月卡给300，每额外购买1张月卡额外给300
                    const baseCard = 1; // 基础月卡
                    const additionalCards = Math.max(0, this.monthlyCardCount); // 额外购买的月卡数量
                    return (baseCard + additionalCards) * 300;
                },
                // 月卡每日异方晶计算
                monthlyCardCrystal() {
                    if (!this.monthlyCardActive) return 0;
                    const days = this.selectedDays;
                    const crystalPerDay = 60; 
                    // 计算总月卡天数
                    let totalCardDays = 0;
                    if (this.monthlyCardCount === -1) {
                        // -1：提前购买，使用日常x天的计算方式
                        totalCardDays = this.selectedDays;
                    } else if (this.monthlyCardCount >= 0) {
                        // 0：购买1张月卡30天，1：购买2张月卡60天，以此类推
                        totalCardDays = 30 * (this.monthlyCardCount + 1);
                    }
                    // 实际可用的月卡天数不能超过剩余天数
                    const actualCardDays = Math.min(totalCardDays, days);
                    return actualCardDays * crystalPerDay;
                },
                // 月卡费用计算
                monthlyCardCost() {
                    if (!this.monthlyCardActive) return 0;
                    // -1表示提前购买，不算入氪金金额
                    if (this.monthlyCardCount === -1) return 0;
                    // 0表示购买1张，1表示购买2张，以此类推
                    const totalCards = this.monthlyCardCount + 1;
                    return totalCards * 30; // 每张月卡30RMB
                },

                // 狄斯盈满钵异方晶奖励计算
                disiRewardTotal() {
                    // 计算大于当前等级的所有奖励总和
                    let total = 0;
                    for (const reward of this.disiRewards) {
                        if (reward.level <= this.disiLevel) {
                            total += reward.crystal;
                        }
                    }
                    return total;
                },
                // 狄斯盈满钵璀璨晶源计算
                disiPremiumCrystal() {
                    // 如果按钮未激活，显示0计入0
                    if (!this.disiActive) {
                        return 0;
                    }
                    // 如果已预先购买，显示0计入0
                    if (this.disiPrePurchased) {
                        return 0;
                    }
                    // 否则显示980计入980
                    return 980;
                },     

                // 狄斯盈满钵费用计算
                disiCost() {
                    // 只有当按钮激活且未预先购买时才计入98RMB
                    if (this.disiActive && !this.disiPrePurchased) {
                        return 98;
                    }
                    return 0;
                },

                // 诡珑珍宝馆搜索令计算
                treasureTickets() {
                    // 只有当按钮激活时才显示10搜索令
                    if (this.treasureActive) {
                        return 10;
                    }
                    return 0;
                },

                // 诡珑珍宝馆费用计算
                treasureCost() {
                    // 只有当按钮激活且未预先购买时才计入88RMB
                    if (this.treasureActive && !this.treasurePrePurchased) {
                        return 88;
                    }
                    return 0;
                },  

                // 特惠时尚巡回庆典期数（复用基础时尚巡回庆典的期数计算）
                specialFashionTourPeriods() {
                    return this.fashionTourPeriods;
                },
                // 特惠时尚巡回庆典搜索令计算
                specialFashionTourTickets() {
                    if (!this.specialFashionTour.active) {
                        return 0;
                    }
                    if (this.specialFashionTour.completed) {
                        return Math.max(0, (this.specialFashionTourPeriods - 1));
                    } else {
                        return this.specialFashionTourPeriods;
                    }
                },
                // 特惠时尚巡回庆典璀璨晶源计算
                specialFashionTourPremiumCrystal() {
                    // 只有当按钮激活且未预购买时才计入300璀璨晶源
                    return (this.specialFashionTour.active && !this.specialFashionTour.prePurchased) ? 300 : 0;
                },
                // 剩余优惠次数计算
                remainingDiscounts() {
                    if (!this.specialFashionTour.active) {
                        return 0;
                    }
                    return Math.max(0, this.specialFashionTour.maxDiscounts - this.specialFashionTour.usedDiscounts);
                },
                // 特惠时尚巡回庆典费用计算
                specialFashionTourCost() {
                    // 只有当按钮激活且未预购买时才计入60RMB
                    return (this.specialFashionTour.active && !this.specialFashionTour.prePurchased) ? 60 : 0;
                },

                // 晶源特供（首充）计算
                // 计算每个按钮的单价（x = 价格 / (璀璨晶源数量 / 180)）
                crystalSupplyUnitPrices() {
                return this.crystalSupplyButtons.map(button => {
                    const unitPrice = button.price / (button.premiumCrystal / 180);
                    return unitPrice.toFixed(0); // 保留2位小数
                });
                },
                // 晶源特供总璀璨晶源
                crystalSupplyTotalPremiumCrystal() {
                return this.crystalSupplyButtons.reduce((total, button, index) => {
                    return total + (button.purchased ? button.premiumCrystal : 0);
                }, 0);
                },
                // 晶源特供总费用
                crystalSupplyTotalCost() {
                return this.crystalSupplyButtons.reduce((total, button, index) => {
                    return total + (button.purchased ? button.price : 0);
                }, 0);
                },

                // 源特供（非首充）计算
                // 计算每个按钮的单价（x = 价格 / (璀璨晶源数量 / 180)）
                nonFirstCrystalSupplyUnitPrices() {
                return this.nonFirstCrystalSupplyButtons.map(button => {
                    const unitPrice = button.price / (button.premiumCrystal / 180);
                    return unitPrice.toFixed(2); // 保留2位小数
                });
                },
                // 晶源特供（非首充）总璀璨晶源
                nonFirstCrystalSupplyTotalPremiumCrystal() {
                    return this.nonFirstCrystalSupplyButtons.reduce((total, button) => {
                        const count = button.count === null || button.count === '' ? 0 : button.count;
                        return total + (button.premiumCrystal * count);
                    }, 0);
                },
                // 晶源特供（非首充）总费用
                nonFirstCrystalSupplyTotalCost() {
                    return this.nonFirstCrystalSupplyButtons.reduce((total, button) => {
                        const count = button.count === null || button.count === '' ? 0 : button.count;
                        return total + (button.price * count);
                    }, 0);
                },

                // 新人追踪礼包计算
                // 新人追踪礼包总璀璨晶源
                permanentPackageTotalPremiumCrystal() {
                    return this.permanentPackage.active ? this.permanentPackage.premiumCrystal : 0;
                },
                // 新人追踪礼包总搜索令
                permanentPackageTotalTickets() {
                    return this.permanentPackage.active ? this.permanentPackage.tickets : 0;
                },
                // 新人追踪礼包总费用
                permanentPackageTotalCost() {
                    return this.permanentPackage.active ? this.permanentPackage.price : 0;
                },

                // 每周追踪礼包计算
                // 每周追踪礼包最大购买数量（基于周数）
                weeklyTrackingPackageMaxCount() {
                    // 直接使用总周数，不受暗域完成状态影响
                    return this.weeklyCount;
                },
                // 每周追踪礼包总异方晶
                weeklyTrackingPackageTotalCrystal() {
                    return this.weeklyTrackingPackage.crystal * this.weeklyTrackingPackage.count;
                },
                // 每周追踪礼包总搜索令
                weeklyTrackingPackageTotalTickets() {
                    return this.weeklyTrackingPackage.tickets * this.weeklyTrackingPackage.count;
                },

                // 每周追踪礼包总费用
                weeklyTrackingPackageTotalCost() {
                    return this.weeklyTrackingPackage.price * this.weeklyTrackingPackage.count;
                },

                // 月度追踪礼包计算
                // 月度追踪礼包最大购买数量（基于月数）
                monthlyTrackingPackageMaxCount() {
                    // 使用与情绪检测相同的月数计算逻辑
                    return this.remainingMonths;
                },
                // 月度追踪礼包Ⅰ总搜索令
                monthlyTrackingPackage1TotalTickets() {
                    return this.monthlyTrackingPackage1.tickets * this.monthlyTrackingPackage1.count;
                },
                // 月度追踪礼包Ⅰ总费用
                monthlyTrackingPackage1TotalCost() {
                    return this.monthlyTrackingPackage1.price * this.monthlyTrackingPackage1.count;
                },
                // 月度追踪礼包Ⅱ总搜索令
                monthlyTrackingPackage2TotalTickets() {
                    return this.monthlyTrackingPackage2.tickets * this.monthlyTrackingPackage2.count;
                },
                // 月度追踪礼包Ⅱ总费用
                monthlyTrackingPackage2TotalCost() {
                    return this.monthlyTrackingPackage2.price * this.monthlyTrackingPackage2.count;
                },

                // 局长就任特供计算
                // 检查按钮是否可交互
                directorSupplyPackageEnabled() {
                    return this.directorSupplyPackages.map((pkg, index) => {
                        // 第一个按钮总是可交互
                        if (index === 0) return true;
                        // 其他按钮只有在前一个按钮激活时才可交互
                        return this.directorSupplyPackages[index - 1].active;
                    });
                },
                // 局长就任特供总异方晶
                directorSupplyTotalCrystal() {
                    return this.directorSupplyPackages.reduce((total, pkg) => {
                        return total + (pkg.active ? pkg.crystal : 0);
                    }, 0);
                },
                // 局长就任特供总搜索令
                directorSupplyTotalTickets() {
                    return this.directorSupplyPackages.reduce((total, pkg) => {
                        return total + (pkg.active ? pkg.tickets : 0);
                    }, 0);
                },
                // 局长就任特供总费用
                directorSupplyTotalCost() {
                    return this.directorSupplyPackages.reduce((total, pkg) => {
                        return total + (pkg.active ? pkg.price : 0);
                    }, 0);
                },

                // 限时礼包计算
                // 限时礼包总异方晶计算 - 统一版本
                limitedPackageTotalCrystal() {
                    let totalCrystal = 0;
                    
                    // 原有的礼包
                    totalCrystal += (this.limitedPackageCycle1.crystal * this.limitedPackageCycle1.count);
                    
                    // 新增礼包统一计算
                    const allNewPackages = [
                        ...this.singlePackages,
                        ...this.supplyPackages,
                        ...this.upgradePackages
                    ];
                    
                    totalCrystal += allNewPackages.reduce((sum, item) => {
                        return sum + (item.active ? (item.crystal || 0) : 0);
                    }, 0);
                    
                    // 组合购买
                    totalCrystal += this.limitedPackageCombo.active ? (this.limitedPackageCombo.crystal || 0) : 0;
                    
                    return totalCrystal;
                },
                // 限时礼包总璀璨晶源计算
                limitedPackageTotalPremiumCrystal() {
                    let totalPremiumCrystal = 0;
                    
                    // 新增：特供系列中的璀璨晶源
                    totalPremiumCrystal += this.supplyPackages.reduce((sum, item) => {
                        return sum + (item.active ? (item.premiumCrystal || 0) : 0);
                    }, 0);
                    
                    // 新增：跃升补给系列中的璀璨晶源
                    totalPremiumCrystal += this.upgradePackages.reduce((sum, item) => {
                        return sum + (item.active ? (item.premiumCrystal || 0) : 0);
                    }, 0);
                    
                    // 新增：组合购买中的璀璨晶源
                    totalPremiumCrystal += this.limitedPackageCombo.active ? (this.limitedPackageCombo.premiumCrystal || 0) : 0;
                    
                    return totalPremiumCrystal;
                },
                // 限时礼包总搜索令计算 - 统一版本
                limitedPackageTotalTickets() {
                    let totalTickets = 0;
                    
                    // 原有的礼包
                    totalTickets += (this.limitedPackageCycle1.tickets * this.limitedPackageCycle1.count) +
                                (this.limitedPackageCycle2.tickets * this.limitedPackageCycle2.count) +
                                (this.limitedPackageCycle3.tickets * this.limitedPackageCycle3.count) +
                                (this.limitedPackageCycle4.tickets * this.limitedPackageCycle4.count) +
                                (this.limitedPackageShadow1.active ? this.limitedPackageShadow1.tickets : 0) +
                                (this.limitedPackageShadow2.active ? this.limitedPackageShadow2.tickets : 0) +
                                (this.limitedPackageShadow3.active ? this.limitedPackageShadow3.tickets : 0) +
                                (this.limitedPackageMystery.active ? this.limitedPackageMystery.tickets : 0) +
                                (this.limitedPackageTravelSupply.active ? this.limitedPackageTravelSupply.tickets : 0);
                    
                    // 新增礼包统一计算 - 只计算新增的礼包，避免重复
                    const allNewPackages = [
                        ...this.covenantPackages,
                        ...this.dovePackages,
                        ...this.singlePackages,
                        ...this.supplyPackages,
                        ...this.upgradePackages
                    ];
                    
                    totalTickets += allNewPackages.reduce((sum, item) => {
                        // 盟约序章系列使用 count
                        if (item.count !== undefined) {
                            return sum + ((item.tickets || 0) * item.count);
                        }
                        // 其他系列使用 active
                        else {
                            return sum + (item.active ? (item.tickets || 0) : 0);
                        }
                    }, 0);
                    
                    // 组合购买
                    totalTickets += this.limitedPackageCombo.active ? this.limitedPackageCombo.tickets : 0;
                    
                    return totalTickets;
                },
                // 限时礼包总限定券计算
                limitedPackageTotalLimitedCoupons() {
                    let totalLimitedCoupons = 0;
                    
                    // 新增：盟约序章系列
                    totalLimitedCoupons += this.covenantPackages.reduce((sum, item) => {
                        return sum + (item.limitedCoupons * item.count);
                    }, 0);
                    
                    // 新增：白鸽巡礼系列
                    totalLimitedCoupons += this.dovePackages.reduce((sum, item) => {
                        return sum + (item.active ? (item.limitedCoupons || 0) : 0);
                    }, 0);
                    
                    return totalLimitedCoupons;
                },
                // 限时礼包总费用
                limitedPackageTotalCost() {
                    let total = 0;
                    
                    // 原有的其他礼包费用
                    total += (this.limitedPackageCycle1.price * this.limitedPackageCycle1.count) +
                            (this.limitedPackageCycle2.price * this.limitedPackageCycle2.count) +
                            (this.limitedPackageCycle3.price * this.limitedPackageCycle3.count) +
                            (this.limitedPackageCycle4.price * this.limitedPackageCycle4.count) +
                            (this.limitedPackageShadow1.active ? this.limitedPackageShadow1.price : 0) +
                            (this.limitedPackageShadow2.active ? this.limitedPackageShadow2.price : 0) +
                            (this.limitedPackageShadow3.active ? this.limitedPackageShadow3.price : 0) +
                            (this.limitedPackageMystery.active ? this.limitedPackageMystery.price : 0) +
                            (this.limitedPackageTravelSupply.active ? this.limitedPackageTravelSupply.price : 0);
                    
                    // 新增礼包费用
                    total += this.covenantPackages.reduce((sum, item) => sum + (item.price * item.count), 0);
                    total += this.dovePackages.reduce((sum, item) => sum + (item.active ? item.price : 0), 0);
                    total += this.singlePackages.reduce((sum, item) => sum + (item.active ? item.price : 0), 0);
                    total += this.supplyPackages.reduce((sum, item) => sum + (item.active ? item.price : 0), 0);
                    total += this.upgradePackages.reduce((sum, item) => sum + (item.active ? item.price : 0), 0);
                    total += this.limitedPackageCombo.active ? this.limitedPackageCombo.price : 0;
                    
                    return total;
                },

                // 其他模块签到奖励计算
                signInRewardBaseData() {
                    const today = new Date();
                    const nextVersionDate = this.poolDates.nextVersion;
                    const newYearDate = this.poolDates.newYear;
                    
                    // 检查是否已经超过歧行至破晓版本时间15天
                    const nextVersionExpired = new Date(nextVersionDate.getTime() + 15 * 24 * 60 * 60 * 1000) < today;
                    // 检查是否已经超过新年版本时间15天
                    const newYearExpired = new Date(newYearDate.getTime() + 15 * 24 * 60 * 60 * 1000) < today;
                    
                    // 如果已经超过新年版本15天，所有奖励都为0
                    if (newYearExpired) {
                        return {
                            tickets: 0,
                            limitedCoupons: 0
                        };
                    }
                    
                    if (this.selectedTime === 'nextVersion') {
                        // 歧行至破晓版本
                        if (nextVersionExpired) {
                            // 超过歧行至破晓版本15天，该版本奖励为0
                            return {
                                tickets: 0,
                                limitedCoupons: 0
                            };
                        }
                        
                    if (!this.calculateToPoolEnd) {
                        // 计算到卡池开放当天：13限定券
                        return {
                            tickets: 0,
                            limitedCoupons: 13
                        };
                    } else {
                        // 计算到卡池结束当天：24限定券
                        return {
                            tickets: 0,
                            limitedCoupons: 24
                        };
                    }
                    } else {
                        // 新年版本
                        let baseTickets = 0;
                        let baseCoupons = 0;
                        
                        // 只有在歧行至破晓版本未过期时，才计算其奖励
                        if (!nextVersionExpired) {
                            baseTickets += 14;  // 歧行至破晓版本固定14搜索令
                            baseCoupons += 10;  // 歧行至破晓版本固定10限定券
                        }
                        
                        // 新年版本奖励
                        if (!this.calculateToPoolEnd) {
                            // 计算到卡池开放当天：新年版本11限定券
                            return {
                                tickets: baseTickets,
                                limitedCoupons: baseCoupons + 11
                            };
                        } else {
                            // 计算到卡池结束当天：新年版本24限定券
                            return {
                                tickets: baseTickets,
                                limitedCoupons: baseCoupons + 24
                            };
                        }
                    }
                },
                // 显示文本：生成用户界面显示的签到奖励描述
                signInRewardDisplayAmount() {
                    const data = this.signInRewardBaseData;
                    if (data.tickets === 0 && data.limitedCoupons === 0) {
                        return "0 (已过期)";
                    }
                    let displayText = "";
                    if (data.tickets > 0) {
                        displayText += `${data.tickets}张搜索令`;
                    }
                    if (data.limitedCoupons > 0) {
                        if (displayText) displayText += " + ";
                        displayText += `${data.limitedCoupons}张限定券`;
                    }
                    return displayText || "0";
                },
                // 搜索令数量：返回签到奖励中的搜索令数量（用于计算总抽数）
                signInRewardTickets() {
                    return this.signInRewardBaseData.tickets;
                },
                // 限定券数量：返回签到奖励中的限定券数量（用于计算总抽数）
                signInRewardLimitedCoupons() {
                    return this.signInRewardBaseData.limitedCoupons;
                },
                // 奖励图标：根据版本返回对应的资源图标
                signInRewardIcon() {
                    const data = this.signInRewardBaseData;
                    // 如果有限定券就显示限定券图标，否则显示搜索令图标
                    return data.limitedCoupons > 0 ? this.limitedCouponIcon : this.ticketIcon;
                },

                // 前瞻兑换码异方晶
                previewCodeCrystal() {
                    if (this.selectedTime === 'nextVersion') {
                        // 歧行至破晓：600异方晶
                        return 600;
                    } else {
                        // 新年版本：1200异方晶
                        return 1200;
                    }
                },

                // 停服更新异方晶
                maintenanceCrystal() {
                    if (this.selectedTime === 'nextVersion') {
                        // 歧行至破晓：1个版本 * 300
                        return 1 * 300;
                    } else {
                        // 新年版本：2个版本 * 200 + 2个版本 * 300 = 1000
                        return (2 * 200) + (2 * 300);
                    }
                },

                // 停服维护异方晶
                maintenanceRepairCrystal() {
                    if (this.selectedTime === 'nextVersion') {
                        // 歧行至破晓
                        if (!this.calculateToPoolEnd) {
                            // 计算到卡池开放当天时，版本刚开不维护，显示0
                            return 0;
                        } else {
                            // 计算到卡池结束当天时，版本中期维护过了，显示200
                            return 200;
                        }
                    } else {
                        // 新年版本
                        if (!this.calculateToPoolEnd) {
                            // 计算到卡池开放当天时，版本刚开不维护，显示600
                            return 600;
                        } else {
                            // 计算到卡池结束当天时，版本中期维护过了，显示800
                            return 800;
                        }
                    }
                },
            },
            watch: {
                // 自动保存机制
                resources: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听各模块展开/折叠状态变化并保存数据
                sections: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听是否计算到卡池结束的变化并保存数据
                calculateToPoolEnd() {
                    this.saveToLocalStorage();
                },
                // 监听是否使用璀璨晶源抽卡设置变化并保存数据和更新饼状图
                usePremiumCrystal(newValue, oldValue) {
                    // 当关闭使用璀璨晶源抽卡时，重置皮肤预留红晶
                    if (oldValue === true && newValue === false) {
                        this.skinReserve = {
                            skin880: 0,
                            skin1280: 0,
                            skin2580: 0
                        };
                        // 同时重置特惠时尚巡回庆典的已使用折扣次数
                        if (this.specialFashionTour.active) {
                            this.specialFashionTour.usedDiscounts = 0;
                        }
                    }
                    this.saveToLocalStorage();
                    // 强制更新饼状图
                    this.$nextTick(() => {
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },
                // 深度监听皮肤预留红晶数量变化并保存数据
                /*
                skinReserve: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                */               
                // 深度监听皮肤预留红晶数量变化并保存数据和更新饼状图
                skinReserve: {
                    handler(newValue) {
                        // 重新计算已使用的折扣次数
                        this.calculateUsedDiscounts();
                        this.saveToLocalStorage();
                        
                        // 强制更新饼状图
                        this.$nextTick(() => {
                            if (this.sections.pullSummary) {
                                this.updatePieChart();
                            }
                        });
                    },
                    deep: true
                },
                // 监听自定义异方晶修正值变化并保存数据
                customAdjustment() {
                    this.saveToLocalStorage();
                },
                // 监听本周周常任务完成状态变化并保存数据
                weeklyCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听本周分享任务完成状态变化并保存数据
                dailyShareCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听本月情绪检测完成状态变化并保存数据
                emotionDetectionCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听本月签到奖励完成状态变化并保存数据
                signInRewardCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听多项合金数量变化并保存数据
                alloyCount() {
                    this.saveToLocalStorage();
                },
                // 监听是否使用合金兑换设置变化并保存数据
                useAlloyExchange() {
                    this.saveToLocalStorage();
                },
                // 监听基础时尚巡回庆典完成状态变化并保存数据
                fashionTourCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听监察密令期数选择变化并保存数据
                selectedInspectionPeriod(newValue) {
                    this.saveToLocalStorage();
                },
                // 深度监听监察密令等级变化并保存数据
                inspectionLevels: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听本月追踪认证兑换状态变化并保存数据
                trackingExchanged() {
                    this.saveToLocalStorage();
                },
                // 监听本月友情兑换状态变化并保存数据
                friendshipExchanged() {
                    this.saveToLocalStorage();
                },
                // 监听追踪认证黄票数量变化并保存数据
                trackingCertificationCount() {
                    this.saveToLocalStorage();
                },
                // 监听是否使用黄票兑换搜索令设置变化并保存数据
                useTrackingCertification() {
                    this.saveToLocalStorage();
                },
                // 监听暗域是否仅扫荡模式变化并保存数据
                darkZoneSweepOnly() {
                    this.saveToLocalStorage();
                },
                // 监听本周暗域挑战完成状态变化并保存数据
                darkZoneCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听暗域首通奖励完成状态变化并保存数据
                darkZoneFirstCompleted() {
                    this.saveToLocalStorage();
                },
                // 监听数据间隙完成状态变化并保存数据
                dataGapCompleted() {
                    this.saveToLocalStorage();
                },
                // 深度监听狂厄特训难度选择变化并保存数据
                trainingModes: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听祸海之厄完成状态变化并保存数据
                nightmareSeaCompleted() {
                    this.saveToLocalStorage();
                },
                // 深度监听狄斯城（主线）完成状态变化并保存数据
                mainStory: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听行动纪要进度滑块变化并保存数据
                actionSummaryLevel() {
                    this.saveToLocalStorage();
                },
                // 深度监听零镜系统世界观完成状态变化并保存数据
                zeroMirror: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听记忆复现弥合阈值滑块变化并保存数据
                memoryReviewThreshold() {
                    this.saveToLocalStorage();
                },
                // 监听旧案归档处未兑换搜索令数量变化并保存数据
                oldCaseArchiveCount() {
                    this.saveToLocalStorage();
                },
                // 深度监听狄斯暗影（EX）完成状态变化并保存数据
                darkShadowEx: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听记忆风暴副本完成状态变化并保存数据
                memoryStorm: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听污染之巢副本完成状态变化并保存数据
                pollutionNest: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听清剿行动副本完成状态变化并保存数据
                cleanupOperation: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听帕尔马废墟副本完成状态变化并保存数据
                palmaRuins: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听派遣声望区域选择变化并保存数据
                selectedDispatchArea() {
                    this.saveToLocalStorage();
                },
                // 深度监听派遣声望等级变化，重新计算异方晶奖励并保存数据
                dispatchReputation: {
                    handler(newValue) {
                        // 当声望等级变化时，重新计算异方晶
                        this.calculateDispatchCrystal();
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听角色养成进度变化并保存数据
                characterDevelopment: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听未完成窥心数量变化并保存数据
                dreamInsightCount() {
                    this.saveToLocalStorage();
                },
                // 监听未完成溯时数量变化并保存数据
                dreamRetrospectCount() {
                    this.saveToLocalStorage();
                },
                // 监听未完成人格色谱数量变化并保存数据
                personalitySpectrumCount() {
                    this.saveToLocalStorage();
                },
                // 监听无尽梦魇积分滑块值变化并保存数据
                nightmareScore() {
                    this.saveToLocalStorage();
                },
                // 深度监听灰烬之潮重塑完成状态变化并保存数据
                ashTide: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动完成状态变化并保存数据
                activityCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动审查奖励完成状态变化并保存数据
                activityReviewCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动角色试用奖励完成状态变化并保存数据
                activityTrialCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动复刻模式选择变化并保存数据
                activityRerunMode: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听诡境余音活动状态变化并保存数据
                activityCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听碎晶之梦活动状态变化并保存数据
                crystalDreamActive: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动公会战奖励完成状态变化并保存数据
                activityGuildWarCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听活动绝密行动奖励完成状态变化并保存数据
                activitySecretOperationCompleted: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听额外购买月卡数量变化并保存数据
                monthlyCardCount() {
                    this.saveToLocalStorage();
                },
                // 监听月卡激活状态变化并保存数据
                monthlyCardActive() {
                    this.saveToLocalStorage();
                },
                // 监听卡池时间选择变化，调整监察密令购买数量限制并保存数据
                selectedTime() {
                    // 当切换时间时，检查并调整高级监察密令购买数量
                    const maxLimit = this.calculateInspectionPeriods - 1;
                    if (this.inspectionOrderCount > maxLimit) {
                        this.inspectionOrderCount = maxLimit;
                    }
                    this.saveToLocalStorage();
                },                
                // 监听高级监察密令期数选择变化并保存数据
                selectedRechargeInspectionPeriod(newValue) {
                    this.saveToLocalStorage();
                },
                // 深度监听高级监察密令等级变化，强制更新总计计算并保存数据
                rechargeInspectionLevels: {
                    handler(newValue) {
                        // 当等级变化时，强制更新总计计算
                        this.$forceUpdate();
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 监听狄斯盈满钵等级变化并保存数据
                disiLevel() {
                    this.saveToLocalStorage();
                },
                // 监听狄斯盈满钵激活状态变化并保存数据
                disiActive() {
                    this.saveToLocalStorage();
                },
                // 监听狄斯盈满钵预购买状态变化并保存数据
                disiPrePurchased() {
                    this.saveToLocalStorage();
                },
                // 监听诡珑珍宝馆激活状态变化并保存数据
                treasureActive() {
                    this.saveToLocalStorage();
                },
                // 监听诡珑珍宝馆预购买状态变化并保存数据
                treasurePrePurchased() {
                    this.saveToLocalStorage();
                },
                // 深度监听特惠时尚巡回庆典状态变化并保存数据
                specialFashionTour: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听晶源特供(首充)购买状态变化并保存数据
                crystalSupplyButtons: {
                handler(newValue) {
                    this.saveToLocalStorage();
                },
                deep: true
                },
                // 深度监听(非首充)晶源特供购买数量变化，强制更新总计计算并保存数据
                nonFirstCrystalSupplyButtons: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                        // 强制触发总计更新
                        this.$forceUpdate();
                    },
                    deep: true
                },
                // 深度监听荒旅追踪补给Ⅰ购买数量变化并保存数据
                limitedPackageCycle1: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听荒旅追踪补给Ⅱ购买数量变化并保存数据
                limitedPackageCycle2: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听荒旅追踪补给Ⅲ购买数量变化并保存数据
                limitedPackageCycle3: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听荒旅追踪补给Ⅳ购买数量变化并保存数据
                limitedPackageCycle4: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听绰影夜话Ⅰ购买状态变化并保存数据
                limitedPackageShadow1: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听绰影夜话Ⅱ购买状态变化并保存数据
                limitedPackageShadow2: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听绰影夜话Ⅲ购买状态变化并保存数据
                limitedPackageShadow3: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听诡事断章购买状态变化并保存数据
                limitedPackageMystery: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听荒旅资源补给购买状态变化并保存数据
                limitedPackageTravelSupply: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                // 深度监听其他限时礼包数据
                covenantPackages: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                
                dovePackages: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                
                singlePackages: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                
                supplyPackages: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                
                upgradePackages: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
                
                limitedPackageCombo: {
                    handler(newValue) {
                        this.saveToLocalStorage();
                    },
                    deep: true
                },
            },
            methods: {
                saveToLocalStorage() {
                    const dataToSave = {
                        isDarkMode: this.isDarkMode, // 主题模式状态：false为浅色模式，true为深色模式
                        ections: this.sections, // 各模块的展开/折叠状态
                        selectedTime: this.selectedTime, // 选择的卡池时间：'nextVersion'或'newYear'
                        calculateToPoolEnd: this.calculateToPoolEnd, // 是否计算到卡池结束当天

                        resources: this.resources, // 当前资源数据：异方晶、璀璨晶源、搜索令库存                        
                        usePremiumCrystal: this.usePremiumCrystal, // 是否使用璀璨晶源抽卡
                        skinReserve: this.skinReserve, // 皮肤预留红晶数量：880、1280、2580档位
                        customAdjustment: this.customAdjustment, // 自定义异方晶修正值   

                        weeklyCompleted: this.weeklyCompleted, // 本周周常任务完成状态
                        dailyShareCompleted: this.dailyShareCompleted, // 本周分享任务完成状态
                        emotionDetectionCompleted: this.emotionDetectionCompleted, // 本月情绪检测完成状态
                        signInRewardCompleted: this.signInRewardCompleted, // 本月签到奖励完成状态
                        alloyCount: this.alloyCount, // 多项合金数量
                        useAlloyExchange: this.useAlloyExchange, // 是否使用合金兑换异方晶
                        fashionTourCompleted: this.fashionTourCompleted, // 基础时尚巡回庆典完成状态
                        inspectionLevels: this.inspectionLevels, // 监察密令各期数等级
                        selectedInspectionPeriod: this.selectedInspectionPeriod, // 选择的监察密令期数
                        trackingExchanged: this.trackingExchanged, // 本月追踪认证常规兑换状态
                        friendshipExchanged: this.friendshipExchanged, // 本月友情兑换状态
                        trackingCertificationCount: this.trackingCertificationCount, // 追踪认证黄票数量
                        useTrackingCertification: this.useTrackingCertification, // 是否使用黄票兑换搜索令
                        darkZoneSweepOnly: this.darkZoneSweepOnly, // 暗域是否仅扫荡模式
                        darkZoneCompleted: this.darkZoneCompleted, // 本周暗域挑战完成状态
                        darkZoneFirstCompleted: this.darkZoneFirstCompleted, // 暗域首通奖励完成状态
                        dataGapCompleted: this.dataGapCompleted, // 数据间隙完成状态                        
                        trainingModes: this.trainingModes, // 狂厄特训难度选择状态
                        nightmareSeaCompleted: this.nightmareSeaCompleted, // 祸海之厄完成状态

                        mainStory: this.mainStory, // 狄斯城主线关卡完成状态
                        actionSummaryLevel: this.actionSummaryLevel, // 行动纪要进度等级
                        zeroMirror: this.zeroMirror, // 零镜系统世界观完成状态
                        memoryReviewThreshold: this.memoryReviewThreshold, // 记忆复现弥合阈值
                        oldCaseArchiveCount: this.oldCaseArchiveCount, // 旧案归档处未兑换搜索令数量                                                
                        darkShadowEx: this.darkShadowEx, // 狄斯暗影EX关卡完成状态
                        memoryStorm: this.memoryStorm, // 记忆风暴副本完成状态
                        pollutionNest: this.pollutionNest, // 污染之巢副本完成状态
                        cleanupOperation: this.cleanupOperation, // 清剿行动副本完成状态
                        palmaRuins: this.palmaRuins, // 帕尔马废墟副本完成状态
                        selectedDispatchArea: this.selectedDispatchArea, // 选择的派遣声望区域
                        dispatchReputation: this.dispatchReputation, // 派遣声望等级和异方晶数据
                        characterDevelopment: this.characterDevelopment, // 角色养成进度数据
                        dreamInsightCount: this.dreamInsightCount, // 未完成窥心数量
                        dreamRetrospectCount: this.dreamRetrospectCount, // 未完成溯时数量
                        personalitySpectrumCount: this.personalitySpectrumCount, // 未完成人格色谱数量
                        nightmareScore: this.nightmareScore, // 无尽梦魇积分滑块值
                        ashTide: this.ashTide, // 灰烬之潮重塑完成状态                        

                        activityCompleted: this.activityCompleted, // 各活动主线奖励完成状态
                        activityReviewCompleted: this.activityReviewCompleted, // 各活动审查奖励完成状态
                        activityTrialCompleted: this.activityTrialCompleted, // 各活动角色试用奖励完成状态
                        activityRerunMode: this.activityRerunMode, // 各活动复刻模式选择状态
                        remainingEchoActive: this.remainingEchoActive, // 诡境余音活动状态
                        crystalDreamActive: this.crystalDreamActive, // 碎晶之梦活动状态 
                        activityGuildWarCompleted: this.activityGuildWarCompleted, // 活动公会战完成状态 
                        activitySecretOperationCompleted: this.activitySecretOperationCompleted, // 活动绝密行动完成状态                      

                        monthlyCardCount: this.monthlyCardCount, // 额外购买月卡数量
                        monthlyCardActive: this.monthlyCardActive, // 月卡激活状态
                        rechargeInspectionLevels: this.rechargeInspectionLevels, // 高级监察密令各期数等级
                        selectedRechargeInspectionPeriod: this.selectedRechargeInspectionPeriod, // 选择的高级监察密令期数
                        disiLevel: this.disiLevel, // 狄斯盈满钵当前等级
                        disiActive: this.disiActive, // 狄斯盈满钵激活状态
                        disiPrePurchased: this.disiPrePurchased, // 狄斯盈满钵预购买状态
                        treasureActive: this.treasureActive, // 诡珑珍宝馆激活状态
                        treasurePrePurchased: this.treasurePrePurchased, // 诡珑珍宝馆预购买状态
                        specialFashionTour: this.specialFashionTour, // 特惠时尚巡回庆典状态
                        crystalSupplyPurchased: this.crystalSupplyButtons.map(button => button.purchased), // 晶源特供（首充）各档位购买状态
                        nonFirstCrystalSupplyCounts: this.nonFirstCrystalSupplyButtons.map(button => button.count), // 晶源特供（非首充）各档位购买数量
                        permanentPackageActive: this.permanentPackage.active, // 新人追踪礼包购买状态
                        weeklyTrackingPackageCount: this.weeklyTrackingPackage.count, // 每周追踪礼包购买数量
                        monthlyTrackingPackage1Count: this.monthlyTrackingPackage1.count, // 月度追踪礼包Ⅰ购买数量
                        monthlyTrackingPackage2Count: this.monthlyTrackingPackage2.count, // 月度追踪礼包Ⅱ购买数量
                        directorSupplyActive: this.directorSupplyPackages.map(pkg => pkg.active), // 局长就任特供各档位购买状态
                        limitedPackageCycle1Count: this.limitedPackageCycle1.count, // 荒旅追踪补给Ⅰ购买数量
                        limitedPackageCycle2Count: this.limitedPackageCycle2.count, // 荒旅追踪补给Ⅱ购买数量
                        limitedPackageCycle3Count: this.limitedPackageCycle3.count, // 荒旅追踪补给Ⅲ购买数量
                        limitedPackageCycle4Count: this.limitedPackageCycle4.count, // 荒旅追踪补给Ⅳ购买数量
                        limitedPackageShadow1Active: this.limitedPackageShadow1.active, // 绰影夜话Ⅰ购买状态
                        limitedPackageShadow2Active: this.limitedPackageShadow2.active, // 绰影夜话Ⅱ购买状态
                        limitedPackageShadow3Active: this.limitedPackageShadow3.active, // 绰影夜话Ⅲ购买状态
                        limitedPackageMysteryActive: this.limitedPackageMystery.active, // 诡事断章购买状态
                        limitedPackageTravelSupplyActive: this.limitedPackageTravelSupply.active, // 荒旅资源补给购买状态
                        covenantPackages: this.covenantPackages,
                        dovePackages: this.dovePackages,
                        singlePackages: this.singlePackages,
                        supplyPackages: this.supplyPackages,
                        upgradePackages: this.upgradePackages,
                        limitedPackageCombo: this.limitedPackageCombo,
                    };
                    
                    try {
                        localStorage.setItem('gachaCalculatorData', JSON.stringify(dataToSave));
                    } catch (e) {
                        console.error('保存数据失败:', e);
                    }
                },

                // 切换主题模式
                toggleTheme() {
                    this.isDarkMode = !this.isDarkMode;
                    this.applyTheme();
                    this.saveToLocalStorage();
                },

                // 应用主题样式
                applyTheme() {
                    // 使用nextTick确保DOM更新后再应用样式
                    this.$nextTick(() => {
                        document.body.classList.remove('light-mode', 'dark-mode');
                        document.body.classList.add(this.isDarkMode ? 'dark-mode' : 'light-mode');
                    });
                },

                // 顶部菜单栏方法
                showWebpageInfo() {
                    this.currentModal = 'info';
                    this.showModal = true;
                },

                showFeedback() {
                    this.currentModal = 'feedback';
                    this.showModal = true;
                },

                closeModal() {
                    this.showModal = false;
                    this.currentModal = null;
                },

                // 饼状图交互系统

                /**
                 * 获取模块名称的缩写（用于移动端显示）
                 */
                getShortModuleName(fullName) {
                    const nameMap = {
                        '现有': '现',
                        '日常': '日', 
                        '活动': '活',
                        '潜在': '潜',
                        '氪金': '氪',
                        '其他': '其'
                    };
                    return nameMap[fullName] || fullName.charAt(0);
                },

                /**
                 * 统一的悬停检测逻辑 - 根据坐标计算当前悬停的模块
                 * @param {number} clientX - 客户端X坐标
                 * @param {number} clientY - 客户端Y坐标
                 * @returns {Object|null} 悬停的模块信息和索引
                 */
                getHoveredModule(clientX, clientY) {
                    const canvas = this.$refs.pieChart;
                    if (!canvas) return null;
                    
                    // 高DPI适配的坐标转换
                    const rect = canvas.getBoundingClientRect();
                    const dpr = window.devicePixelRatio || 1;
                    const x = (clientX - rect.left) * (canvas.width / rect.width / dpr);
                    const y = (clientY - rect.top) * (canvas.height / rect.height / dpr);
                    
                    const width = rect.width;
                    const height = rect.height;
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const baseRadius = Math.min(width, height) / 2 - 20;
                    const separation = window.innerWidth <= 768 ? 2 : 5;
                    
                    // 计算鼠标位置相对于圆心的角度
                    const angle = Math.atan2(y - centerY, x - centerX);
                    const normalizedAngle = angle < 0 ? angle + 2 * Math.PI : angle;
                    
                    let currentAngle = 0;
                    let hoveredModule = null;
                    let hoveredIndex = -1;
                    
                    // 找出占比最大的模块（用于自动放大效果）
                    let maxPulls = 0;
                    let maxIndex = -1;
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > maxPulls) {
                            maxPulls = module.pulls;
                            maxIndex = index;
                        }
                    });
                    
                    // 查找触摸所在的扇形区域
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > 0) {
                            const sliceAngle = (module.pulls / this.totalModulePulls) * 2 * Math.PI;
                            const midAngle = currentAngle + sliceAngle / 2;
                            
                            // 计算偏移后的圆心（分离式饼图效果）
                            const offsetX = Math.cos(midAngle) * separation;
                            const offsetY = Math.sin(midAngle) * separation;
                            const offsetCenterX = centerX + offsetX;
                            const offsetCenterY = centerY + offsetY;
                            
                            // 计算该区域的最大半径（考虑自动放大和悬停效果）
                            let radius = baseRadius;
                            if (index === maxIndex) {
                                radius = baseRadius + (window.innerWidth <= 768 ? 4 : 8);
                            }
                            if (index === this.hoveredPieIndex) {
                                radius = baseRadius + (window.innerWidth <= 768 ? 6 : 12);
                            }
                            
                            // 检查是否在扇形区域内
                            if (normalizedAngle >= currentAngle && normalizedAngle <= currentAngle + sliceAngle) {
                                const distance = Math.sqrt(Math.pow(x - offsetCenterX, 2) + Math.pow(y - offsetCenterY, 2));
                                if (distance <= radius) {
                                    hoveredModule = module;
                                    hoveredIndex = index;
                                }
                            }
                            currentAngle += sliceAngle;
                        }
                    });
                    
                    return { 
                        module: hoveredModule, 
                        index: hoveredIndex 
                    };
                },

                /**
                 * 更新悬停状态并重绘图表
                 * @param {Object} result - 悬停检测结果
                 */
                updateHoverState(result) {
                    if (result) {
                        this.hoveredPieModule = result.module;
                        this.hoveredPieIndex = result.index;
                        // 重绘饼状图以显示悬停效果
                        this.drawPieChart();
                    }
                },

                /**
                 * 处理饼状图鼠标移动事件
                 */
                handlePieChartMouseMove(event) {
                    const result = this.getHoveredModule(event.clientX, event.clientY);
                    this.updateHoverState(result);
                },

                /**
                 * 处理饼状图鼠标离开事件
                 */
                handlePieChartMouseLeave() {
                    this.hoveredPieModule = null;
                    this.hoveredPieIndex = -1;
                    // 重绘饼状图以移除悬停效果
                    this.drawPieChart();
                },

                /**
                 * 处理饼状图触摸开始事件
                 */
                handlePieChartTouchStart(event) {
                    this.handlePieChartTouch(event);
                },

                /**
                 * 处理饼状图触摸移动事件
                 */
                handlePieChartTouchMove(event) {
                    this.handlePieChartTouch(event);
                },

                /**
                 * 处理饼状图触摸结束事件
                 */
                handlePieChartTouchEnd() {
                    // 触摸结束时不清除悬停状态，保持显示（更好的移动端体验）
                },

                /**
                 * 统一的触摸事件处理
                 */
                handlePieChartTouch(event) {
                    const touch = event.touches[0];
                    const result = this.getHoveredModule(touch.clientX, touch.clientY);
                    this.updateHoverState(result);
                },

                /**
                 * 绘制饼状图 - 悬停时只放大当前区块
                 */
                drawPieChart() {
                    const canvas = this.$refs.pieChart;
                    if (!canvas) return;
                    
                    // 高DPI适配
                    const dpr = window.devicePixelRatio || 1;
                    const container = canvas.parentElement;
                    const rect = container.getBoundingClientRect();
                    const width = rect.width;
                    const height = rect.height;
                    
                    // 设置canvas尺寸
                    canvas.width = width * dpr;
                    canvas.height = height * dpr;
                    canvas.style.width = width + 'px';
                    canvas.style.height = height + 'px';
                    
                    const ctx = canvas.getContext('2d');
                    
                    // 增强抗锯齿设置
                    ctx.scale(dpr, dpr);
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    
                    // 设置高质量渲染
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.globalAlpha = 1;
                    
                    // 清空画布
                    ctx.clearRect(0, 0, width, height);
                    
                    // 计算中心点和半径
                    const isMobile = window.innerWidth <= 768;
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const baseRadius = Math.min(width, height) / (isMobile ? 3 : 3.2);
                    
                    // 找出占比最大的模块
                    let maxPulls = 0;
                    let maxIndex = -1;
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > maxPulls) {
                            maxPulls = module.pulls;
                            maxIndex = index;
                        }
                    });
                    
                    let startAngle = 0;
                    const separation = isMobile ? 2 : 5;
                    
                    // 绘制阴影效果（底层）
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > 0) {
                            const sliceAngle = (module.pulls / this.totalModulePulls) * 2 * Math.PI;
                            const midAngle = startAngle + sliceAngle / 2;
                            
                            const offsetX = Math.cos(midAngle) * separation;
                            const offsetY = Math.sin(midAngle) * separation;
                            
                            let radius = baseRadius;
                            if (index === maxIndex) {
                                radius = baseRadius + (isMobile ? 2 : 4);
                            }
                            if (index === this.hoveredPieIndex) {
                                radius = baseRadius + (isMobile ? 3 : 6);
                            }
                            
                            // 绘制阴影
                            ctx.beginPath();
                            ctx.moveTo(centerX + offsetX + 1, centerY + offsetY + 1);
                            ctx.arc(centerX + offsetX + 1, centerY + offsetY + 1, radius, startAngle, startAngle + sliceAngle);
                            ctx.closePath();
                            
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                            ctx.fill();
                            
                            startAngle += sliceAngle;
                        }
                    });
                    
                    // 重置起始角度，绘制主要扇形
                    startAngle = 0;
                    
                    // 绘制主要扇形部分
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > 0) {
                            const sliceAngle = (module.pulls / this.totalModulePulls) * 2 * Math.PI;
                            const midAngle = startAngle + sliceAngle / 2;
                            
                            const offsetX = Math.cos(midAngle) * separation;
                            const offsetY = Math.sin(midAngle) * separation;
                            
                            let radius = baseRadius;
                            let lineWidth = isMobile ? 1.5 : 2;
                            if (index === maxIndex) {
                                radius = baseRadius + (isMobile ? 4 : 8);
                                lineWidth = isMobile ? 2.5 : 3;
                            }
                            if (index === this.hoveredPieIndex) {
                                radius = baseRadius + (isMobile ? 6 : 12);
                                lineWidth = isMobile ? 3 : 4;
                            }
                            
                            // 改进的扇形绘制 - 使用路径和填充分离
                            ctx.save(); // 保存状态
                            
                            // 创建圆形路径
                            ctx.beginPath();
                            ctx.moveTo(centerX + offsetX, centerY + offsetY);
                            ctx.arc(centerX + offsetX, centerY + offsetY, radius, startAngle, startAngle + sliceAngle);
                            ctx.closePath();
                            
                            // 设置阴影效果
                            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                            ctx.shadowBlur = 8;
                            ctx.shadowOffsetX = 2;
                            ctx.shadowOffsetY = 2;
                            
                            // 填充扇形
                            ctx.fillStyle = module.color;
                            ctx.fill();
                            
                            // 清除阴影
                            ctx.shadowColor = 'transparent';
                            ctx.shadowBlur = 0;
                            ctx.shadowOffsetX = 0;
                            ctx.shadowOffsetY = 0;
                            
                            // 绘制平滑边框
                            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                            ctx.lineWidth = lineWidth;
                            ctx.lineCap = 'round';
                            ctx.lineJoin = 'round';
                            ctx.stroke();
                            
                            ctx.restore(); // 恢复状态
                            
                            startAngle += sliceAngle;
                        }
                    });
                    
                    // 绘制标签和引导线
                    startAngle = 0;
                    
                    // 设置文字渲染质量
                    ctx.textRendering = 'geometricPrecision';
                    ctx.font = `bold ${isMobile ? 11 : 12}px "Microsoft YaHei", Arial, sans-serif`;
                    
                    this.pieChartData.forEach((module, index) => {
                        if (module.pulls > 0) {
                            const sliceAngle = (module.pulls / this.totalModulePulls) * 2 * Math.PI;
                            const midAngle = startAngle + sliceAngle / 2;
                            
                            const offsetX = Math.cos(midAngle) * separation;
                            const offsetY = Math.sin(midAngle) * separation;
                            
                            let radius = baseRadius;
                            if (index === maxIndex) {
                                radius = baseRadius + (isMobile ? 4 : 8);
                            }
                            if (index === this.hoveredPieIndex) {
                                radius = baseRadius + (isMobile ? 6 : 12);
                            }
                            
                            // 移动端显示完整标签
                            if (isMobile) {
                                const labelRadius = radius + 15;
                                const labelX = centerX + offsetX + Math.cos(midAngle) * labelRadius;
                                const labelY = centerY + offsetY + Math.sin(midAngle) * labelRadius;
                                
                                // 引导线
                                ctx.beginPath();
                                ctx.moveTo(
                                    centerX + offsetX + Math.cos(midAngle) * radius,
                                    centerY + offsetY + Math.sin(midAngle) * radius
                                );
                                ctx.lineTo(labelX, labelY);
                                ctx.strokeStyle = 'rgba(100, 100, 100, 0.6)';
                                ctx.lineWidth = 1;
                                ctx.stroke();
                                
                                // 文字
                                ctx.fillStyle = '#FF6B6B';
                                ctx.textAlign = Math.cos(midAngle) > 0 ? 'left' : 'right';
                                ctx.textBaseline = 'middle';
                                ctx.fillText(module.name, labelX + (Math.cos(midAngle) > 0 ? 5 : -5), labelY);
                            } else {
                                // 桌面端标签
                                const labelRadius = radius + 20;
                                const labelX = centerX + offsetX + Math.cos(midAngle) * labelRadius;
                                const labelY = centerY + offsetY + Math.sin(midAngle) * labelRadius;
                                
                                // 引导线
                                ctx.beginPath();
                                ctx.moveTo(
                                    centerX + offsetX + Math.cos(midAngle) * radius,
                                    centerY + offsetY + Math.sin(midAngle) * radius
                                );
                                ctx.lineTo(labelX, labelY);
                                ctx.strokeStyle = 'rgba(100, 100, 100, 0.6)';
                                ctx.lineWidth = 1;
                                ctx.stroke();
                                
                                // 文字
                                ctx.fillStyle = '#FF6B6B';
                                ctx.textAlign = Math.cos(midAngle) > 0 ? 'left' : 'right';
                                ctx.textBaseline = 'middle';
                                ctx.fillText(module.name, labelX + (Math.cos(midAngle) > 0 ? 5 : -5), labelY);
                            }
                            
                            startAngle += sliceAngle;
                        }
                    });
                },

                /**
                 * 更新饼状图数据
                 */
                updatePieChart() {
                    this.pieChartData = this.modulePullsData.map(module => {
                        const percentage = this.totalModulePulls > 0 ? 
                            ((module.pulls / this.totalModulePulls) * 100).toFixed(1) : '0.0';
                        return {
                            ...module,
                            percentage: percentage
                        };
                    });
                    
                    this.$nextTick(() => {
                        this.drawPieChart();
                    });
                },

                // 当前资源、黄票输入、旧案归档处输入框设置
                // 统一的清空方法（当输入框获得焦点时，如果值为0则清空）
                clearIfZero(value, type = null, key = null) {
                    if (value === 0) {
                        return '';
                    }
                    return value;
                },

                // 统一的默认值设置方法（当输入框失去焦点时，如果为空则设置为0）
                setDefaultIfEmpty(value, type = null, key = null) {
                    // 只有当输入框完全为空时才设置为0
                    if (value === '' || value === null) {
                        return 0;
                    }
                    // 如果是NaN，也设置为0
                    if (isNaN(value)) {
                        return 0;
                    }
                    return value;
                },
                
                // 异方晶修正清空方法
                clearCustomAdjustmentIfZero() {
                    if (this.customAdjustment === 0) {
                        this.customAdjustment = null;
                    }
                },

                // 多项合金清空方法
                clearAlloyIfZero() {
                    if (this.alloyCount === 0) {
                        this.alloyCount = null;
                    }
                },

                // 黄票清空方法  
                clearCertificationIfZero() {
                    if (this.trackingCertificationCount === 0) {
                        this.trackingCertificationCount = null;
                    }
                },

                // 多项合金默认值设置方法
                setAlloyDefaultIfEmpty() {
                    if (this.alloyCount === null || this.alloyCount === '') {
                        this.alloyCount = 0;
                    }
                },

                // 黄票默认值设置方法
                setCertificationDefaultIfEmpty() {
                    if (this.trackingCertificationCount === null || this.trackingCertificationCount === '') {
                        this.trackingCertificationCount = 0;
                    }
                },

                // 异方晶修正默认值设置方法
                setCustomAdjustmentDefaultIfEmpty() {
                    if (this.customAdjustment === null || this.customAdjustment === '') {
                        this.customAdjustment = 0;
                    }
                },

                // 角色养成清空方法
                clearCharacterDevIfZero(type) {
                    if (this.characterDevelopment[type] === 0) {
                        this.characterDevelopment[type] = null;
                    }
                },

                // 角色养成默认值设置方法  
                setCharacterDevDefaultIfEmpty(type) {
                    if (this.characterDevelopment[type] === null || this.characterDevelopment[type] === '') {
                        this.characterDevelopment[type] = 0;
                    }
                },

                // 梦境清空方法
                clearDreamIfZero(type) {
                    if (this[type] === 0) {
                        this[type] = null;
                    }
                },

                // 梦境默认值设置方法
                setDreamDefaultIfEmpty(type) {
                    if (this[type] === null || this[type] === '') {
                        this[type] = 0;
                    }
                },

                // 晶源特供（非首充）清空方法
                clearNonFirstCrystalSupplyIfZero(index) {
                    if (this.nonFirstCrystalSupplyButtons[index].count === 0) {
                        this.nonFirstCrystalSupplyButtons[index].count = null;
                    }
                },

                // 晶源特供（非首充）默认值设置方法
                setNonFirstCrystalSupplyDefaultIfEmpty(index) {
                    if (this.nonFirstCrystalSupplyButtons[index].count === null || this.nonFirstCrystalSupplyButtons[index].count === '') {
                        this.nonFirstCrystalSupplyButtons[index].count = 0;
                    }
                },

                // 每周追踪礼包清空方法
                clearWeeklyTrackingPackageIfZero() {
                    if (this.weeklyTrackingPackage.count === 0) {
                        this.weeklyTrackingPackage.count = null;
                    }
                },

                // 每周追踪礼包默认值设置方法
                setWeeklyTrackingPackageDefaultIfEmpty() {
                    if (this.weeklyTrackingPackage.count === null || this.weeklyTrackingPackage.count === '') {
                        this.weeklyTrackingPackage.count = 0;
                    }
                },

                // 月度追踪礼包Ⅰ清空方法
                clearMonthlyTrackingPackage1IfZero() {
                    if (this.monthlyTrackingPackage1.count === 0) {
                        this.monthlyTrackingPackage1.count = null;
                    }
                },

                // 月度追踪礼包Ⅰ默认值设置方法
                setMonthlyTrackingPackage1DefaultIfEmpty() {
                    if (this.monthlyTrackingPackage1.count === null || this.monthlyTrackingPackage1.count === '') {
                        this.monthlyTrackingPackage1.count = 0;
                    }
                },

                // 月度追踪礼包Ⅱ清空方法
                clearMonthlyTrackingPackage2IfZero() {
                    if (this.monthlyTrackingPackage2.count === 0) {
                        this.monthlyTrackingPackage2.count = null;
                    }
                },

                // 月度追踪礼包Ⅱ默认值设置方法
                setMonthlyTrackingPackage2DefaultIfEmpty() {
                    if (this.monthlyTrackingPackage2.count === null || this.monthlyTrackingPackage2.count === '') {
                        this.monthlyTrackingPackage2.count = 0;
                    }
                },

                // 限时礼包清空方法
                clearLimitedPackageIfZero(packageName) {
                    if (this[packageName].count === 0) {
                        this[packageName].count = null;
                    }
                },

                // 限时礼包默认值设置方法
                setLimitedPackageDefaultIfEmpty(packageName) {
                    if (this[packageName].count === null || this[packageName].count === '') {
                        this[packageName].count = 0;
                    }
                },

                // 当前资源的输入验证
                validateInputDelayed(type) {
                    this.$nextTick(() => {
                        if (this.resources[type] !== null && this.resources[type] !== undefined && this.resources[type] !== '') {
                            if (this.resources[type] < 0 || isNaN(this.resources[type])) {
                                this.resources[type] = 0;
                            } else {
                                this.resources[type] = Math.floor(this.resources[type]);
                            }
                        }
                        // 异方晶修正的特殊验证
                        if (type === 'crystal' && this.customAdjustment < 0) {
                            const maxDeduction = this.resources.crystal || 0;
                            if (Math.abs(this.customAdjustment) > maxDeduction) {
                                // 自动修正为最大可扣减值
                                this.customAdjustment = -maxDeduction;
                                // 显示提示
                                this.showAutoCloseAlert("已经没有可以扣减的异方晶了");
                            }
                        }
                        // 输入完成后更新饼状图
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },

                // 异方晶修正的专门验证方法
                validateCustomAdjustment() {
                    this.$nextTick(() => {
                        if (this.customAdjustment < 0) {
                            const maxDeduction = this.resources.crystal || 0;
                            if (Math.abs(this.customAdjustment) > maxDeduction) {
                                // 自动修正为最大可扣减值
                                this.customAdjustment = -maxDeduction;
                                // 显示提示
                                this.showAutoCloseAlert("已经没有可以扣减的异方晶了");
                            }
                        }
                        // 确保值为整数
                        if (this.customAdjustment !== null && this.customAdjustment !== undefined && this.customAdjustment !== '') {
                            this.customAdjustment = Math.floor(this.customAdjustment);
                        }
                    });
                },

                // 公共月度奖励计算方法
                calculateMonthlyReward(monthlyReward, isCompleted) {
                    if (isCompleted) {
                        return Math.max(0, (this.remainingMonths - 1)) * monthlyReward;
                    } else {
                        return this.remainingMonths * monthlyReward;
                    }
                },

                // 监察密令格式化日期为MM-DD
                formatDateToMMDD(date) {
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const day = date.getDate().toString().padStart(2, '0');
                    return `${month}-${day}`;
                },

                // 切换监察密令期数激活状态
                toggleInspectionPeriod(periodId) {
                    if (this.inspectionLevels[periodId] === undefined || this.inspectionLevels[periodId] === 0) {
                        this.$set(this.inspectionLevels, periodId, 1);
                    } else {
                        this.$set(this.inspectionLevels, periodId, 0);
                    }
                },

                // 选择监察密令期数
                selectInspectionPeriod(periodId) {
                    this.selectedInspectionPeriod = periodId;
                },

                // 监察密令滑块吸附到指定挡位
                snapInspectionLevel(periodId) {
                    const levels = [0, 5, 15, 25, 35, 45, 55];
                    let closestLevel = levels[0];
                    let minDiff = Math.abs(this.inspectionLevels[periodId] - levels[0]);
                    
                    for (let i = 1; i < levels.length; i++) {
                        const diff = Math.abs(this.inspectionLevels[periodId] - levels[i]);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestLevel = levels[i];
                        }
                    }
                    
                    if (this.inspectionLevels[periodId] !== closestLevel) {
                        this.$set(this.inspectionLevels, periodId, closestLevel);
                    }
                },

                // 监察密令当前期数的搜索令数量计算
                calculateCurrentPeriodTickets(level) {
                    if (!level || level === 0) return 0; // 0级时显示0张，表示还未领取任何奖励
                    
                    let tickets = 0;
                    const ticketLevels = [5, 15, 25, 35, 45, 55];
                    
                    // 计算小于等于当前等级的所有奖励
                    for (const ticketLevel of ticketLevels) {
                        if (level >= ticketLevel) {
                            tickets += 1;
                        }
                    }
                    
                    return tickets;
                },

                // 高级监察密令滑块吸附到指定挡位
                snapRechargeInspectionLevel(periodId) {
                    const levels = [0, 5, 15, 25, 30, 35, 45, 50, 55];
                    let closestLevel = levels[0];
                    let minDiff = Math.abs((this.rechargeInspectionLevels[periodId] || 0) - levels[0]);
                    
                    for (let i = 1; i < levels.length; i++) {
                        const diff = Math.abs((this.rechargeInspectionLevels[periodId] || 0) - levels[i]);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestLevel = levels[i];
                        }
                    }
                    if ((this.rechargeInspectionLevels[periodId] || 0) !== closestLevel) {
                        this.$set(this.rechargeInspectionLevels, periodId, closestLevel);
                        // 新增：强制更新费用计算
                        this.$forceUpdate();
                    }
                },

                // 获取选中的高级监察密令期数文本
                getSelectedRechargePeriodText() {
                    if (!this.selectedRechargeInspectionPeriod) return '';
                    
                    const period = this.inspectionPeriods.find(p => p.id === this.selectedRechargeInspectionPeriod);
                    if (period) {
                        return `${period.startDate}到${period.endDate}`;
                    }
                    return '';
                },

                // 高级监察密令当前期数的异方晶数量计算
                calculateRechargePeriodCrystal(level) {
                    if (!level || level === 0) return 0; // 0级时显示0，表示还未领取任何奖励
                    let crystal = 0;
                    // 计算小于等于当前等级的所有异方晶奖励
                    if (level >= 30) crystal += 200;
                    if (level >= 50) crystal += 680;
                    return crystal;
                },

                // 高级监察密令当前期数的搜索令数量计算
                calculateRechargePeriodTickets(level) {
                    if (!level || level === 0) return 0; // 0级时显示0张，表示还未领取任何奖励
                    let tickets = 0;
                    const ticketLevels = [5, 15, 25, 35, 45, 55];
                    // 计算小于等于当前等级的所有搜索令奖励
                    for (const ticketLevel of ticketLevels) {
                        if (level >= ticketLevel) {
                            tickets += 1;
                        }
                    }
                    return tickets;
                },

                // 灰烬之潮-重塑切换方法
                toggleAshTide(type) {
                    this.ashTide[type] = !this.ashTide[type];
                },

                // 多项合金输入验证
                validateAlloyInput() {
                    // 延迟验证，避免在输入过程中干扰
                    this.$nextTick(() => {
                        if (this.alloyCount !== null && this.alloyCount !== undefined && this.alloyCount !== '') {
                            if (this.alloyCount < 0 || isNaN(this.alloyCount)) {
                                this.alloyCount = 0;
                            } else {
                                this.alloyCount = Math.floor(this.alloyCount);
                            }
                        }
                    });
                },

                // 角色养成延迟验证
                validateCharacterDevInputDelayed(type) {
                    this.$nextTick(() => {
                        if (this.characterDevelopment[type] !== null && this.characterDevelopment[type] !== undefined && this.characterDevelopment[type] !== '') {
                            if (this.characterDevelopment[type] < 0 || isNaN(this.characterDevelopment[type])) {
                                this.characterDevelopment[type] = 0;
                            } else {
                                this.characterDevelopment[type] = Math.floor(this.characterDevelopment[type]);
                            }
                        }
                    });
                },

                // 梦境&人格色谱延迟验证
                validateDreamInputDelayed(type) {
                    this.$nextTick(() => {
                        if (this[type] !== null && this[type] !== undefined && this[type] !== '') {
                            if (this[type] < 0 || isNaN(this[type])) {
                                this[type] = 0;
                            } else {
                                this[type] = Math.floor(this[type]);
                            }
                        }
                    });
                },


                // 当当前资源的输入框获得焦点时，如果值为0则清空
                clearIfZero(type) {
                    if (this.resources[type] === 0) {
                        this.resources[type] = null;
                    }
                },

                // 当当前资源的输入框失去焦点时，如果为空则设置为0
                setDefaultIfEmpty(type) {
                    if (this.resources[type] === null || this.resources[type] === '') {
                        this.resources[type] = 0;
                    }
                },

                // 切换活动复刻模式
                toggleActivityRerunMode(activityTitle) {
                    // 如果开关打开，设置为'crystal'模式，否则设置为null
                    if (this.activityRerunMode[activityTitle]) {
                        this.activityRerunMode[activityTitle] = 'crystal';
                    } else {
                        this.activityRerunMode[activity.title] = null;
                    }
                    this.saveToLocalStorage();
                },

                // 活动完成状态切换方法
                toggleActivityCompletion(activityTitle) {
                    // 如果是妄夜迷章活动，同时更新 nightMazeCompleted
                    if (activityTitle === '妄夜迷章') {
                        this.nightMazeCompleted = this.activityCompleted[activityTitle];
                    }
                    this.saveToLocalStorage();
                },

                // 活动审查奖励完成状态切换方法
                toggleActivityReviewCompletion(activityTitle) {
                    this.saveToLocalStorage();
                },

                // 活动角色试用奖励完成状态切换方法
                toggleActivityTrialCompletion(activityTitle) {
                    this.saveToLocalStorage();
                },

                // 活动公会战奖励完成状态切换方法
                toggleActivityGuildWarCompletion(activityTitle) {
                    this.saveToLocalStorage();
                },

                // 活动绝密行动奖励完成状态切换方法
                toggleActivitySecretOperationCompletion(activityTitle) {
                    this.saveToLocalStorage();
                },

                // 切换模块的显示状态
                toggleSection(section) {
                    this.sections[section] = !this.sections[section];
                    // 如果展开的是包含饼状图的模块，重新绘制饼状图
                    if (section === 'pullSummary' && this.sections.pullSummary) {
                        this.$nextTick(() => {
                            this.updatePieChart();
                        });
                    }
                },
                
                // 皮肤预留红晶数量的调整功能
                /*
                adjustSkinCount(price, change) {
                    const skinKey = `skin${price}`;
                    if (this.skinReserve[skinKey] !== undefined) {
                        const newValue = this.skinReserve[skinKey] + change;
                        if (newValue >= 0) {
                            this.skinReserve[skinKey] = newValue;
                        }
                    }
                },
                */

                adjustSkinCount(price, change) {
                    const skinKey = `skin${price}`;
                    if (this.skinReserve[skinKey] !== undefined) {
                        // 计算当前已预留的总璀璨晶源
                        const currentReserved = this.totalSkinReserve;
                        // 获取当前可用的璀璨晶源库存
                        const availablePremiumCrystal = this.resources.premiumCrystal || 0;
                        
                        // 如果要增加皮肤数量，检查库存是否足够
                        if (change > 0) {
                            // 计算增加这个皮肤需要多少璀璨晶源
                            const costForThisSkin = price;
                            // 检查增加后总预留是否会超过库存
                            if (currentReserved + costForThisSkin > availablePremiumCrystal) {
                                this.showAutoCloseAlert("璀璨晶源不足，无法预留更多皮肤");
                                return; // 直接返回，不执行增加操作
                            }
                        }
                        
                        // 执行增减操作
                        const newValue = this.skinReserve[skinKey] + change;
                        if (newValue >= 0) {
                            this.skinReserve[skinKey] = newValue;
                            
                            // 自动重新计算已使用的折扣次数
                            this.calculateUsedDiscounts();
                        }
                    }
                },
                // 计算已使用的折扣次数
                calculateUsedDiscounts() {
                    if (!this.specialFashionTour.active) {
                        this.specialFashionTour.usedDiscounts = 0;
                        return;
                    }
                    
                    // 计算总皮肤数量（880和1280）
                    const totalSkinCount = this.skinReserve.skin880 + this.skinReserve.skin1280;
                    
                    // 已使用的折扣次数就是总皮肤数量，但不超过最大次数
                    this.specialFashionTour.usedDiscounts = Math.min(totalSkinCount, this.specialFashionTour.maxDiscounts);
                },
                // 验证优惠次数输入
                validateDiscountCount() {
                    this.$nextTick(() => {
                        if (this.specialFashionTour.maxDiscounts !== null && this.specialFashionTour.maxDiscounts !== undefined && this.specialFashionTour.maxDiscounts !== '') {
                            // 限制在 0-4 之间
                            if (this.specialFashionTour.maxDiscounts < 0) {
                                this.specialFashionTour.maxDiscounts = 0;
                            } else if (this.specialFashionTour.maxDiscounts > 4) {
                                this.specialFashionTour.maxDiscounts = 4;
                            } else {
                                this.specialFashionTour.maxDiscounts = Math.floor(this.specialFashionTour.maxDiscounts);
                            }
                            
                            // 如果减少了最大次数，需要调整已使用次数
                            if (this.specialFashionTour.usedDiscounts > this.specialFashionTour.maxDiscounts) {
                                this.specialFashionTour.usedDiscounts = this.specialFashionTour.maxDiscounts;
                            }
                            
                            // 重新计算皮肤折扣
                            this.calculateUsedDiscounts();
                        }
                    });
                },

                // 清空输入框（如果为0）
                clearDiscountIfZero() {
                    if (this.specialFashionTour.maxDiscounts === 0) {
                        this.specialFashionTour.maxDiscounts = null;
                    }
                },

                // 设置默认值（如果为空）
                setDiscountDefaultIfEmpty() {
                    if (this.specialFashionTour.maxDiscounts === null || this.specialFashionTour.maxDiscounts === '') {
                        this.specialFashionTour.maxDiscounts = 0;
                    }
                },

                // 追踪认证验证黄票输入验证
                validateCertificationInput() {
                    this.$nextTick(() => {
                        if (this.trackingCertificationCount !== null && this.trackingCertificationCount !== undefined && this.trackingCertificationCount !== '') {
                            if (this.trackingCertificationCount < 0 || isNaN(this.trackingCertificationCount)) {
                                this.trackingCertificationCount = 0;
                            } else {
                                this.trackingCertificationCount = Math.floor(this.trackingCertificationCount);
                            }
                        }
                    });
                },
                
                // 切换狂厄特训难度选择状态
                toggleTrainingMode(mode) {
                    this.trainingModes[mode] = !this.trainingModes[mode];
                },

                // 切换狄斯城（主线）选择状态
                toggleMainStory(type) {
                    this.mainStory[type] = !this.mainStory[type];
                },

                // 切换零镜系统（世界观）选择方法
                toggleZeroMirror(type) {
                    this.zeroMirror[type] = !this.zeroMirror[type];
                },

                // 旧案归档处延迟验证
                validateOldCaseArchiveInput() {
                    this.$nextTick(() => {
                        if (this.oldCaseArchiveCount !== null && this.oldCaseArchiveCount !== undefined && this.oldCaseArchiveCount !== '') {
                            if (this.oldCaseArchiveCount < 0 || isNaN(this.oldCaseArchiveCount)) {
                                this.oldCaseArchiveCount = 0;
                            } else {
                                this.oldCaseArchiveCount = Math.floor(this.oldCaseArchiveCount);
                            }
                        }
                    });
                },

                // 切换狄斯暗影（EX）选择方法
                toggleDarkShadowEx(type) {
                    this.darkShadowEx[type] = !this.darkShadowEx[type];
                },

                // 切换记忆风暴选择方法
                toggleMemoryStorm(type) {
                    this.memoryStorm[type] = !this.memoryStorm[type];
                },

                // 切换污染之巢选择方法
                togglePollutionNest(type) {
                    this.pollutionNest[type] = !this.pollutionNest[type];
                },

                // 切换清剿行动选择方法
                toggleCleanupOperation(type) {
                    this.cleanupOperation[type] = !this.cleanupOperation[type];
                },

                // 切换帕尔马废墟选择方法
                togglePalmaRuins(type) {
                    this.palmaRuins[type] = !this.palmaRuins[type];
                },
                
                // 切换派遣声望选择方法
                selectDispatchArea(area) {
                    this.selectedDispatchArea = area;
                },
                
                // 派遣声望滑块吸附到指定挡位
                snapDispatchLevel() {
                    const levels = [0, 1000, 3000, 6000, 10000];
                    let closestLevel = levels[0];
                    let minDiff = Math.abs(this.dispatchReputation[this.selectedDispatchArea].level - levels[0]);
                    
                    for (let i = 1; i < levels.length; i++) {
                        const diff = Math.abs(this.dispatchReputation[this.selectedDispatchArea].level - levels[i]);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestLevel = levels[i];
                        }
                    }
                    // 只有当当前值不等于最接近的挡位时才更新
                    if (this.dispatchReputation[this.selectedDispatchArea].level !== closestLevel) {
                        this.dispatchReputation[this.selectedDispatchArea].level = closestLevel;
                    }
                },
                
                // 计算派遣声望异方晶
                calculateDispatchCrystal() {
                    // 定义每个声望等级的奖励
                    const reputationRewards = [
                        { level: 1000, crystal: 100 },
                        { level: 3000, crystal: 100 },
                        { level: 6000, crystal: 100 },
                        { level: 10000, crystal: 100 }
                    ];
                    // 为每个区域计算异方晶
                    for (const areaKey in this.dispatchReputation) {
                        const currentLevel = this.dispatchReputation[areaKey].level;
                        let totalCrystal = 0;
                        // 计算大于当前等级的所有奖励总和
                        for (const reward of reputationRewards) {
                            if (currentLevel < reward.level) {
                                totalCrystal += reward.crystal;
                            }
                        }
                        this.dispatchReputation[areaKey].crystal = totalCrystal;
                    }
                },
                
                // 派遣声望获取区域名称
                getDispatchAreaName(areaKey) {
                    const names = {
                        syndicate: '辛迪加',
                        newCity: '新城',
                        innerBay: '里湾',
                        sandSea: '砂海'
                    };
                    return names[areaKey] || areaKey;
                },

                // 角色养成模块方法
                toggleHaylaReview() {
                    this.characterDevelopment.haylaReviewed = !this.characterDevelopment.haylaReviewed;
                },
                
                // 调整角色养成数量
                adjustCharacterDev(type, change) {
                    // 确保当前值是数字类型
                    const currentValue = Number(this.characterDevelopment[type]) || 0;
                    const newValue = currentValue + change;
                    // 确保新值不小于0
                    if (newValue >= 0) {
                        this.characterDevelopment[type] = newValue;
                    }
                },

                // 计算无尽梦魇（积分奖励）奖励
                calculateNightmareRewards() {
                    let totalCrystal = 0;
                    let totalTickets = 0;
                    for (const reward of this.nightmareRewards) {
                        // 只计算大于当前积分的奖励
                        if (this.nightmareScore < reward.score) {
                            totalCrystal += reward.crystal;
                            totalTickets += reward.tickets;
                        }
                    }
                    return {
                        crystal: totalCrystal,
                        tickets: totalTickets
                    };
                },

                // 当前资源异方晶、璀璨晶源和搜索令输入验证
                validateInput(type) {
                    // 确保值为整数且非负数
                    if (this.resources[type] < 0) {
                        this.resources[type] = 0;
                    }
                    if (this.resources[type] !== null && this.resources[type] !== undefined) {
                        this.resources[type] = Math.floor(this.resources[type]);
                    }
                },
                
                // 额外购买月卡数量的增减验证
                adjustMonthlyCard(change) {
                    const newValue = this.monthlyCardCount + change;
                    // 检查是否从5增加到6
                    if (this.monthlyCardCount === 5 && change === 1) {
                        this.showAutoCloseAlert("剩余有效日期>150天时将无法继续购买月卡");
                        return;
                    }
                    // 限制只能在-1到5之间（现在允许到5）
                    if (newValue >= -1 && newValue <= 5) {
                        this.monthlyCardCount = newValue;
                    }
                },

                // 月卡额外购买超数量自动显示&关闭提示
                showAutoCloseAlert(message) {
                    // 创建提示元素
                    const alertDiv = document.createElement('div');
                    alertDiv.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0, 0, 0, 0.8);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 8px;
                        z-index: 10000;
                        font-size: 14px;
                        text-align: center;
                    `;
                    alertDiv.textContent = message;
                    // 添加到页面
                    document.body.appendChild(alertDiv);
                    // 3秒后自动移除
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.parentNode.removeChild(alertDiv);
                        }
                    }, 3000);
                },

                // 切换月卡激活状态
                toggleMonthlyCard() {
                    this.monthlyCardActive = !this.monthlyCardActive;
                },

                // 计算倒计时显示天数
                calculateDisplayDays(timeType) {
                    const baseDays = timeType === 'nextVersion' ? this.daysToNextVersion : this.daysToNewYear;
                    return this.calculateToPoolEnd ? baseDays + (this.versionWeeks * 7) : baseDays;
                },

                // 选择高级监察密令期数
                selectRechargeInspectionPeriod(periodId) {
                    this.selectedRechargeInspectionPeriod = periodId;
                },

                // 狄斯盈满钵滑块吸附到指定挡位
                snapDisiLevel() {
                    const levels = [0, 5, 10, 15, 20, 25, 30, 35, 40, 42, 44, 46, 48, 50];
                    let closestLevel = levels[0];
                    let minDiff = Math.abs(this.disiLevel - levels[0]);
                    
                    for (let i = 1; i < levels.length; i++) {
                        const diff = Math.abs(this.disiLevel - levels[i]);
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestLevel = levels[i];
                        }
                    }
                    // 只有当当前值不等于最接近的挡位时才更新
                    if (this.disiLevel !== closestLevel) {
                        this.disiLevel = closestLevel;
                    }
                },

                // 切换狄斯盈满钵激活状态
                toggleDisi() {
                    this.disiActive = !this.disiActive;
                    // 如果关闭按钮，重置滑块到0级
                    if (!this.disiActive) {
                        this.disiLevel = 0;
                        this.disiPrePurchased = false;
                    }
                },

                // 切换诡珑珍宝馆激活状态
                toggleTreasure() {
                    this.treasureActive = !this.treasureActive;
                    // 如果关闭按钮，关闭预购买
                    if (!this.treasureActive) {
                        this.treasurePrePurchased = false;
                    }
                },                

                // 切换特惠时尚巡回庆典激活状态
                toggleSpecialFashionTour() {
                    this.specialFashionTour.active = !this.specialFashionTour.active;
                    if (!this.specialFashionTour.active) {
                        // 如果关闭按钮，重置所有相关状态
                        this.specialFashionTour.completed = false;
                        this.specialFashionTour.usedDiscounts = 0;
                        this.specialFashionTour.prePurchased = false;
                        this.specialFashionTour.maxDiscounts = 0;
                    } else {
                        // 如果打开按钮，设置默认优惠次数为4
                        this.specialFashionTour.maxDiscounts = 4;
                    }
                },

                // === 新增：晶源特供（首充）方法 ===
                // 切换晶源特供按钮购买状态
                toggleCrystalSupplyButton(index) {
                this.crystalSupplyButtons[index].purchased = !this.crystalSupplyButtons[index].purchased;
                },

                // === 新增：晶源特供（非首充）输入框方法 ===
                // 输入验证
                validateNonFirstCrystalSupplyInput(index) {
                    // 如果输入为空，保持为空，不进行验证
                    if (this.nonFirstCrystalSupplyButtons[index].count === '' || this.nonFirstCrystalSupplyButtons[index].count === null) {
                        return;
                    }
                    
                    // 确保值为整数且非负数
                    if (this.nonFirstCrystalSupplyButtons[index].count < 0) {
                        this.nonFirstCrystalSupplyButtons[index].count = 0;
                    }
                    if (this.nonFirstCrystalSupplyButtons[index].count !== null && this.nonFirstCrystalSupplyButtons[index].count !== undefined) {
                        this.nonFirstCrystalSupplyButtons[index].count = Math.floor(this.nonFirstCrystalSupplyButtons[index].count);
                    }
                    
                    // 确保饼状图更新
                    this.$nextTick(() => {
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },

                // === 常驻礼包方法 ===
                // 切换常驻礼包激活状态
                togglePermanentPackage() {
                    this.permanentPackage.active = !this.permanentPackage.active;
                },

                // === 每周追踪礼包方法 ===
                // 输入验证
                validateWeeklyTrackingPackageInput() {
                    // 如果输入为空，保持为空，不进行验证
                    if (this.weeklyTrackingPackage.count === '' || this.weeklyTrackingPackage.count === null) {
                        return;
                    }
                    
                    // 确保值为整数且非负数，且不超过最大周数
                    if (this.weeklyTrackingPackage.count < 0) {
                        this.weeklyTrackingPackage.count = 0;
                    }
                    if (this.weeklyTrackingPackage.count > this.weeklyTrackingPackageMaxCount) {
                        this.weeklyTrackingPackage.count = this.weeklyTrackingPackageMaxCount;
                    }
                    if (this.weeklyTrackingPackage.count !== null && this.weeklyTrackingPackage.count !== undefined) {
                        this.weeklyTrackingPackage.count = Math.floor(this.weeklyTrackingPackage.count);
                    }
                    
                    // 确保饼状图更新
                    this.$nextTick(() => {
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },

                // === 月度追踪礼包方法 ===
                // 验证月度追踪礼包Ⅰ输入
                validateMonthlyTrackingPackage1Input() {
                    this.validateMonthlyTrackingPackageInput('monthlyTrackingPackage1');
                },

                // 验证月度追踪礼包Ⅱ输入
                validateMonthlyTrackingPackage2Input() {
                    this.validateMonthlyTrackingPackageInput('monthlyTrackingPackage2');
                },

                // 通用的月度追踪礼包输入验证
                validateMonthlyTrackingPackageInput(packageName) {
                    // 如果输入为空，保持为空，不进行验证
                    if (this[packageName].count === '' || this[packageName].count === null) {
                        return;
                    }
                    
                    // 确保值为整数且非负数，且不超过最大月数
                    if (this[packageName].count < 0) {
                        this[packageName].count = 0;
                    }
                    if (this[packageName].count > this.monthlyTrackingPackageMaxCount) {
                        this[packageName].count = this.monthlyTrackingPackageMaxCount;
                    }
                    if (this[packageName].count !== null && this[packageName].count !== undefined) {
                        this[packageName].count = Math.floor(this[packageName].count);
                    }
                    
                    // 确保饼状图更新
                    this.$nextTick(() => {
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },

                // === 局长就任特供方法 ===
                // 切换局长就任特供激活状态
                toggleDirectorSupplyPackage(index) {
                    if (this.directorSupplyPackageEnabled[index]) {
                        const newState = !this.directorSupplyPackages[index].active;
                        this.directorSupplyPackages[index].active = newState;
                        
                        // 如果取消购买某个礼包，自动关闭它后面的所有礼包
                        if (!newState) {
                            for (let i = index + 1; i < this.directorSupplyPackages.length; i++) {
                                this.directorSupplyPackages[i].active = false;
                            }
                        }
                    }
                },

                // 获取罗马数字
                getRomanNumeral(num) {
                    const romanNumerals = ['', 'Ⅰ', 'Ⅱ', 'Ⅲ', 'Ⅳ', 'Ⅴ', 'Ⅵ'];
                    return romanNumerals[num] || num;
                },

                // === 限时礼包方法 ===
                // 验证限时礼包输入验证
                validateLimitedPackageInput(packageName) {
                    // 如果输入为空，保持为空，不进行验证
                    if (this[packageName].count === '' || this[packageName].count === null) {
                        return;
                    }
                    
                    // 确保值为整数且在0-2之间
                    if (this[packageName].count < 0) {
                        this[packageName].count = 0;
                    }
                    if (this[packageName].count > 2) {
                        this[packageName].count = 2;
                    }
                    if (this[packageName].count !== null && this[packageName].count !== undefined) {
                        this[packageName].count = Math.floor(this[packageName].count);
                    }
                    
                    // 确保饼状图更新
                    this.$nextTick(() => {
                        if (this.sections.pullSummary) {
                            this.updatePieChart();
                        }
                    });
                },

                // 修复版的统一限时礼包切换方法
                toggleLimitedPackage(packageName) {
                    console.log('点击了:', packageName);
                    
                    // 绰影夜话系列：互斥选择，可取消
                    if (packageName.includes('Shadow')) {
                        console.log('处理绰影夜话系列');
                        
                        // 如果点击的是当前已激活的按钮，则取消激活
                        if (this[packageName].active) {
                            this[packageName].active = false;
                        } else {
                            // 否则重置所有绰影夜话按钮并激活当前
                            this.limitedPackageShadow1.active = false;
                            this.limitedPackageShadow2.active = false;
                            this.limitedPackageShadow3.active = false;
                            this[packageName].active = true;
                        }
                    } 
                    // 白鸽巡礼系列：互斥选择，可取消
                    else if (packageName.includes('Dove')) {
                        console.log('处理白鸽巡礼系列:', packageName);
                        
                        // 查找对应的白鸽巡礼礼包
                        const dovePackage = this.dovePackages.find(item => item.id === packageName);
                        if (dovePackage) {
                            console.log('找到白鸽巡礼礼包，当前状态:', dovePackage.active);
                            
                            // 如果点击的是当前已激活的按钮，则取消激活
                            if (dovePackage.active) {
                                dovePackage.active = false;
                            } else {
                                // 否则重置所有白鸽巡礼按钮并激活当前
                                this.dovePackages.forEach(item => {
                                    item.active = false;
                                });
                                dovePackage.active = true;
                            }
                            
                            console.log('切换后状态:', dovePackage.active);
                        } else {
                            console.error('未找到白鸽巡礼礼包:', packageName);
                        }
                    }
                    // 诡事断章：正常切换
                    else if (packageName === 'limitedPackageMystery') {
                        console.log('处理诡事断章');
                        this[packageName].active = !this[packageName].active;
                    }
                    // 荒旅资源补给：正常切换
                    else if (packageName === 'limitedPackageTravelSupply') {
                        console.log('处理荒旅资源补给');
                        this[packageName].active = !this[packageName].active;
                    }
                    // 单个礼包（作为独立data属性存在的）
                    else if (this[packageName]) {
                        console.log('处理单个礼包:', packageName);
                        this[packageName].active = !this[packageName].active;
                    }
                    // 数组中的礼包（singlePackages, supplyPackages, upgradePackages）
                    else {
                        console.log('在数组中查找礼包:', packageName);
                        const allPackages = [
                            ...this.singlePackages,
                            ...this.supplyPackages,
                            ...this.upgradePackages
                        ];
                        
                        const selectedPackage = allPackages.find(item => item.id === packageName);
                        if (selectedPackage) {
                            console.log('在数组中找到礼包，切换状态');
                            selectedPackage.active = !selectedPackage.active;
                        } else {
                            console.error('❌ 礼包不存在:', packageName);
                        }
                    }
                    
                    // 保存到本地存储
                    this.saveToLocalStorage();
                },

                // 切换盟约序章礼包状态
                toggleCovenantPackage(packageId, index) {
                    console.log('切换盟约序章:', packageId, index);
                    
                    // 盟约序章Ⅵ有输入框，不需要点击切换
                    if (packageId === 'limitedPackageCovenant6') {
                        return;
                    }
                    
                    // 对于盟约序章Ⅰ-Ⅴ，切换count值（0或1）
                    const currentPackage = this.covenantPackages[index];
                    if (currentPackage) {
                        currentPackage.count = currentPackage.count === 0 ? 1 : 0;
                    }
                },

                // 白鸽巡礼系列互斥选择方法（更新版）
                toggleDovePackage(packageId) {
                    // 先重置所有白鸽巡礼按钮
                    this.dovePackages.forEach(item => {
                        item.active = false;
                    });
                    
                    // 激活当前选择的按钮
                    const selectedPackage = this.dovePackages.find(item => item.id === packageId);
                    if (selectedPackage && !selectedPackage.active) {
                        selectedPackage.active = true;
                    }
                },
                
                // 组合购买切换方法
                toggleComboPackage() {
                    this.limitedPackageCombo.active = !this.limitedPackageCombo.active;
                    
                    // 如果激活组合购买，自动关闭三个特供礼包
                    if (this.limitedPackageCombo.active) {
                        this.supplyPackages.forEach(item => {
                            item.active = false;
                        });
                    }
                },
                
                // 盟约序章输入验证
                validateCovenantInput(packageId) {
                    this.$nextTick(() => {
                        const packageItem = this.covenantPackages.find(item => item.id === packageId);
                        if (packageItem) {
                            if (packageItem.count < 0) {
                                packageItem.count = 0;
                            }
                            if (packageItem.count > packageItem.maxCount) {
                                packageItem.count = packageItem.maxCount;
                            }
                            if (packageItem.count !== null && packageItem.count !== undefined) {
                                packageItem.count = Math.floor(packageItem.count);
                            }
                        }
                    });
                },

            },
            mounted() {
                // 初始化饼状图
                this.updatePieChart();
                
                // 初始化派遣声望异方晶计算
                this.calculateDispatchCrystal();

                // 初始化主题
                this.applyTheme();

                // 确保弹窗不会自动显示
                this.$nextTick(() => {
                    this.showModal = false;
                    this.currentModal = null;
                });

                // 精简版监听 - 只监听核心总计数据
                this.$watch(() => [
                    this.totalModulePulls,           // 总抽数
                    this.totalAllCrystal,            // 总异方晶
                    this.totalAllPremiumCrystal,     // 总璀璨晶源
                    this.totalAllTickets,            // 总搜索令
                    this.totalAllLimitedCoupons,     // 总限定券
                    this.totalRechargeCost,          // 总氪金金额
                ], () => {
                    // 只有在饼状图模块展开时才更新图表
                    if (this.sections.pullSummary) {
                        this.updatePieChart();
                    }
                });

                // 监听窗口大小变化，重新绘制饼状图
                window.addEventListener('resize', this.handleResize);

                // 从本地存储恢复新礼包数据
                try {
                    const saved = localStorage.getItem('gachaCalculatorData');
                    if (saved) {
                        const savedData = JSON.parse(saved);
                        
                        // 恢复盟约序章系列数据
                        if (savedData.covenantPackages) {
                            this.covenantPackages = savedData.covenantPackages;
                        }
                        
                        // 恢复白鸽巡礼系列数据
                        if (savedData.dovePackages) {
                            this.dovePackages = savedData.dovePackages;
                        }
                        
                        // 恢复单个礼包数据
                        if (savedData.singlePackages) {
                            this.singlePackages = savedData.singlePackages;
                        }
                        
                        // 恢复特供系列数据
                        if (savedData.supplyPackages) {
                            this.supplyPackages = savedData.supplyPackages;
                        }
                        
                        // 恢复跃升补给系列数据
                        if (savedData.upgradePackages) {
                            this.upgradePackages = savedData.upgradePackages;
                        }
                        
                        // 恢复组合购买数据
                        if (savedData.limitedPackageCombo) {
                            this.limitedPackageCombo = savedData.limitedPackageCombo;
                        }
                    }
                } catch (e) {
                    console.error('恢复限时礼包数据失败:', e);
                }
            },
            
        })

        // 添加错误处理
        try {
            app.mount('#app');
        } catch (error) {
            console.error('页面加载失败:', error);
            // 显示简单错误信息
            document.getElementById('app').innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <h2>⚠️ 页面加载遇到问题</h2>
                    <p>请尝试：</p>
                    <button onclick="localStorage.removeItem('gachaCalculatorData'); location.reload();" 
                            style="padding: 10px; margin: 5px; background: #1890ff; color: white; border: none; border-radius: 5px;">
                        清除数据并刷新
                    </button>
                    <button onclick="location.reload()" 
                            style="padding: 10px; margin: 5px; background: #ccc; border: none; border-radius: 5px;">
                        直接刷新
                    </button>
                </div>
            `;
        }

    </script>
</body>
</html>